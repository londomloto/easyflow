!function(){var t=this;_.float=parseFloat,_.format=function(){var t=_.toArray(arguments),e=t.shift();return e.replace(/{(\d+)}/g,function(e,r){return"undefined"!=typeof t[r]?t[r]:e})},_.insert=function(t,e,r){return Array.prototype.splice.apply(t,[e,0].concat(r)),t},_.move=function(t,e,r){for(var n=t.length;e<0;)e+=n;for(;r<0;)r+=n;if(r>=n)for(var s=r-n;s--+1;)t.push(void 0);return t.splice(r,0,t.splice(e,1)[0]),t},_.permute=function(t,e){return _.isFunction(e)?_.reduce(t,function(t,r,n){return t[e(n,r)]=r,t},[]):_.isArray(e)?_.reduce(e,function(r,n,s){return r[s]=t[e[s]],r},[]):t},_.isIE=function(){var e=t.navigator,r=(e&&e.userAgent||"").toLowerCase(),n=r.indexOf("MSIE ");return!!(n>0||r.match(/Trident.*rv\:11\./))&&parseInt(r.substring(n+5,r.indexOf(".",n)))}}(),function(){function t(t,e,r,n,s,o,i,a,p){var h=1-p;return{x:Math.pow(h,3)*t+3*Math.pow(h,2)*p*r+3*h*p*p*s+Math.pow(p,3)*i,y:Math.pow(h,3)*e+3*Math.pow(h,2)*p*n+3*h*p*p*o+Math.pow(p,3)*a}}var e=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,r=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,n=/((matrix|translate|rotate|scale|skewX|skewY)*\((\-?\d+\.?\d*e?\-?\d*[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+\))+/g,s=/[\w\.\-]+/g,o=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,i=/,?([achlmqrstvxz]),?/gi,a=(document,
this);a.Graph=a.Graph||function(t){},Graph.VERSION="1.0.0",Graph.AUTHOR="PT. Kreasindo Cipta Teknologi",_.extend(Graph,{config:{base:"easyflow/",svg:{version:"1.1"},xmlns:{svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",html:"http://www.w3.org/1999/xhtml"},font:{family:"Segoe UI",size:"12px",line:1}}}),_.extend(Graph,{cached:{},setup:function(t,e){_.isPlainObject(t)?_.extend(Graph.config,t):Graph.config[t]=e},toString:function(){return"Graph SVG Library presented by Kreasindo Cipta Teknologi"}}),_.extend(Graph,{isHTML:function(t){return t instanceof HTMLElement},isSVG:function(t){return t instanceof SVGElement},isElement:function(t){return t instanceof Graph.dom.Element}}),_.extend(Graph,{ns:function(t){var e=Graph.lookup("Graph","ns",t);if(e.clazz)return e.clazz;var r,n,s=_.split(t,"."),o=a,i=s.length;for(n=0;n<i;n++)r=s[n],o[r]=o[r]||{},o=o[r];return _.isFunction(o)&&(e.clazz=o),o},factory:function(t,e){return e=[t].concat(e),new(Function.prototype.bind.apply(t,e));
},expand:function(t,e,r){var n=t.constructor.prototype,s=e.constructor.prototype;r=_.defaultTo(e),_.forOwn(s,function(t,e){_.isFunction(t)&&_.isUndefined(n[e])&&!function(t,e){n[t]=_.bind(e,r)}(e,t)})},mixin:function(t,e){this.extend(t,e,t)},lookup:function(){var t=_.toArray(arguments),e=t.shift(),r=_.join(t,"|"),n=Graph.cached[e]=Graph.cached[e]||{};return n[r]?n[r].credit=100:n[r]={credit:100},_.debounce(function(t){_.forOwn(n,function(e,r){r!=t&&(n[r].credit--,n[r].credit<=0&&delete n[r])})})(r),n[r]},memoize:function(t){return function e(){var r=_.toArray(arguments),n=_.join(r,"â€"),s=e.cache=e.cache||{},o=e.saved=e.saved||[];if(!_.isUndefined(s[n])){for(var i=0,a=o.length;i<a;i++)if(o[i]==n){o.push(o.splice(i,1)[0]);break}return s[n]}return o.length>=1e3&&delete s[o.shift()],o.push(n),s[n]=t.apply(this,r),s[n]}}}),Graph.ns("Graph.lang"),Graph.ns("Graph.dom"),Graph.ns("Graph.collection"),Graph.ns("Graph.svg"),Graph.ns("Graph.svg.fn"),Graph.ns("Graph.router"),Graph.ns("Graph.util"),Graph.ns("Graph.plugin"),
Graph.ns("Graph.shape"),Graph.ns("Graph.shape.common"),Graph.ns("Graph.shape.activity"),_.extend(Graph,{deg:function(t){return Math.round(180*t/Math.PI%360*1e3)/1e3},rad:function(t){return t%360*Math.PI/180},angle:function(t,e,r,n){var s=t-r,o=e-n;return s||o?(180+180*Math.atan2(-o,-s)/Math.PI+360)%360:0},theta:function(t,e,r,n){var s,o,i=-(n-e),a=r-t;return s=0==i.toFixed(10)&&0==a.toFixed(10)?0:Math.atan2(i,a),s<0&&(s=2*Math.PI+s),o=180*s/Math.PI,o=o%360+(o<0?360:0)},magnitude:function(t,e){return Math.sqrt(t*t+e*e)},sign:function(t){return t<0?-1:1},quadrant:function(t,e){return t>=0&&e>=0?1:t>=0&&e<0?4:t<0&&e<0?3:2}}),_.extend(Graph,{extend:function(t,e){return _.isPlainObject(t)&&(e=t,t=Graph.lang.Class),t.extend(e)},point:function(t,e){return new Graph.lang.Point(t,e)},bbox:function(t){return new Graph.lang.BBox(t)},path:function(t){return new Graph.lang.Path(t)},curve:function(t){return new Graph.lang.Curve(t)},matrix:function(t,e,r,n,s,o){return new Graph.lang.Matrix(t,e,r,n,s,o);
}}),_.extend(Graph,{get:function(t){return Graph.$(t).data("vector")},paper:function(){var t=_.toArray(arguments);return Graph.factory(Graph.svg.Paper,t)},page:function(){var t=_.toArray(arguments);return Graph.factory(Graph.shape.Page,t)},find:function(t,e){var r=Graph.$(t,e),n=[];return r.each(function(t,e){var r=Graph.$(e).data("vector");r&&n.push(r)}),new Graph.collection.Vector(n)},polygon2dots:function(t){var e=[];return t.replace(o,function(t,r,n){e.push([_.float(r),_.float(n)])}),e},polygon2path:function(t){var e=Graph.polygon2dots(t);if(!e.length)return"M0,0";for(var t="M"+e[0][0]+","+e[0][1],r=1,n=e.length;r<n;r++)t+="L"+e[r][0]+","+e[r][1]+",";return t=t.substring(0,t.length-1),t+="Z"},seg2cmd:function(t){return _.join(t,",").replace(i,"$1")},cmd2seg:function(t){if(!t)return null;var n=Graph.lookup("Graph","cmd2seg",t),s={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return n.segments?_.cloneDeep(n.segments):(t.replace(e,function(t,e,n){var i=[],a=e.toLowerCase();if(n.replace(r,function(t,e){
e&&i.push(+e)}),"m"==a&&i.length>2&&(o.push(_.concat([e],i.splice(0,2))),a="l",e="m"==e?"l":"L"),"r"==a)o.push(_.concat([e],i));else for(;i.length>=s[a]&&(o.push(_.concat([e],i.splice(0,s[a]))),s[a]););}),n.segments=o,o)},cmd2transform:Graph.memoize(function(t){var e={matrix:!0,translate:!0,rotate:!0,scale:!0,skewX:!0,skewY:!0};t+="";var r=[],o=t.match(n);return o&&_.forEach(o,function(t){var n=t.match(s),o=n.shift();e[o]&&(n=_.map(n,function(t){return+t}),r.push([o].concat(n)))}),r}),catmull2bezier:function(t,e){for(var r=[],n=_.defaultTo,s=0,o=t.length;o-2*!e>s;s+=2){var i=[{x:n(t[s-2],0),y:n(t[s-1],0)},{x:n(t[s],0),y:n(t[s+1],0)},{x:n(t[s+2],0),y:n(t[s+3],0)},{x:n(t[s+4],0),y:n(t[s+5],0)}];e?s?o-4==s?i[3]={x:n(t[0],0),y:n(t[1],0)}:o-2==s&&(i[2]={x:n(t[0],0),y:n(t[1],0)},i[3]={x:n(t[2],0),y:n(t[3],0)}):i[0]={x:n(t[o-2],0),y:n(t[o-1],0)}:o-4==s?i[3]=i[2]:s||(i[0]={x:n(t[s],0),y:n(t[s+1],0)}),r=[(-i[0].x+6*i[1].x+i[2].x)/6,(-i[0].y+6*i[1].y+i[2].y)/6,(i[1].x+6*i[2].x-i[3].x)/6,(i[1].y+6*i[2].y-i[3].y)/6,i[2].x,i[2].y];
}return r},line2curve:function(t,e,r,n){return[t,e,r,n,r,n]},quad2curve:function(t,e,r,n,s,o){var i=1/3,a=2/3;return[i*t+a*r,i*e+a*n,i*s+a*r,i*o+a*n,s,o]},arc2curve:function(t,e,r,n,s,o,i,a,p,h){var c,l=120*Math.PI/180,u=Math.PI/180*(+s||0),d=[],f=Graph.memoize(function(t,e,r){var n=t*Math.cos(r)-e*Math.sin(r),s=t*Math.sin(r)+e*Math.cos(r);return{x:n,y:s}});if(h)w=h[0],k=h[1],_=h[2],G=h[3];else{c=f(t,e,-u),t=c.x,e=c.y,c=f(a,p,-u),a=c.x,p=c.y;var g=(Math.cos(Math.PI/180*s),Math.sin(Math.PI/180*s),(t-a)/2),v=(e-p)/2,m=g*g/(r*r)+v*v/(n*n);m>1&&(m=Math.sqrt(m),r=m*r,n=m*n);var x=r*r,y=n*n,b=(o==i?-1:1)*Math.sqrt(Math.abs((x*y-x*v*v-y*g*g)/(x*v*v+y*g*g))),_=b*r*v/n+(t+a)/2,G=b*-n*g/r+(e+p)/2,w=Math.asin(((e-G)/n).toFixed(9)),k=Math.asin(((p-G)/n).toFixed(9));w=t<_?Math.PI-w:w,k=a<_?Math.PI-k:k,w<0&&(w=2*Math.PI+w),k<0&&(k=2*Math.PI+k),i&&w>k&&(w-=2*Math.PI),!i&&k>w&&(k-=2*Math.PI)}var C=k-w;if(Math.abs(C)>l){var M=k,T=a,z=p;k=w+l*(i&&k>w?1:-1),a=_+r*Math.cos(k),p=G+n*Math.sin(k),d=Graph.arc2curve(a,p,r,n,s,0,i,T,z,[k,M,_,G]);
}C=k-w;var S=Math.cos(w),A=Math.sin(w),E=Math.cos(k),P=Math.sin(k),$=Math.tan(C/4),D=4/3*r*$,R=4/3*n*$,L=[t,e],V=[t+D*A,e-R*S],O=[a+D*P,p-R*E],B=[a,p];if(V[0]=2*L[0]-V[0],V[1]=2*L[1]-V[1],h)return[V,O,B].concat(d);d=[V,O,B].concat(d).join().split(",");for(var I=[],q=0,U=d.length;q<U;q++)I[q]=q%2?f(d[q-1],d[q],u).y:f(d[q],d[q+1],u).x;return I},curvebox:Graph.memoize(function(e,r,n,s,o,i,a,p){var h,c=o-2*n+e-(a-2*o+n),l=2*(n-e)-2*(o-n),u=e-n,d=(-l+Math.sqrt(l*l-4*c*u))/2/c,f=(-l-Math.sqrt(l*l-4*c*u))/2/c,g=[r,p],v=[e,a];return Math.abs(d)>"1e12"&&(d=.5),Math.abs(f)>"1e12"&&(f=.5),d>0&&d<1&&(h=t(e,r,n,s,o,i,a,p,d),v.push(h.x),g.push(h.y)),f>0&&f<1&&(h=t(e,r,n,s,o,i,a,p,f),v.push(h.x),g.push(h.y)),c=i-2*s+r-(p-2*i+s),l=2*(s-r)-2*(i-s),u=r-s,d=(-l+Math.sqrt(l*l-4*c*u))/2/c,f=(-l-Math.sqrt(l*l-4*c*u))/2/c,Math.abs(d)>"1e12"&&(d=.5),Math.abs(f)>"1e12"&&(f=.5),d>0&&d<1&&(h=t(e,r,n,s,o,i,a,p,d),v.push(h.x),g.push(h.y)),f>0&&f<1&&(h=t(e,r,n,s,o,i,a,p,f),v.push(h.x),g.push(h.y)),{min:{x:_.min(v),y:_.min(g)
},max:{x:_.max(v),y:_.max(g)}}})})}(),function(){var t=!1,e=/xyz/.test(function(){xyz})?/\$super/:/.*/,r=Graph.lang.Class=function(){};r.extend=function r(n){var s,o,i,a,p;s=this.prototype,p={},t=!0,o=new this,t=!1;for(var i in n)a=n[i],_.isFunction(a)?o[i]=_.isFunction(s[i])&&e.test(a)?function(t,e){return function(){var r,n;return r=this.$super,this.$super=s[t],n=e.apply(this,_.toArray(arguments)),this.$super=r,n}}(i,a):a:o[i]=p[i]=a;var h,c;return _.isUndefined(o.constructor)||(c=o.constructor,delete o.constructor),h=function(){var e=this,r=e.constructor;e.listeners={},e.superclass.defs&&_.forOwn(e.superclass.defs,function(t,r){e[r]=_.cloneDeep(t)}),_.forOwn(r.defs,function(t,r){e[r]=_.cloneDeep(t)}),t||c&&c.apply(e,_.toArray(arguments))},h.extend=r,h.defs=p,h.version="1.0.0",h.author="londomloto",h.prototype=o,h.prototype.constructor=h,h.prototype.superclass=s.constructor,h.prototype.on=function(t,e){var r,n=this;if(_.isPlainObject(t))return _.forOwn(t,function(t,e){n.on(e,t)}),n;var s=_.split(t,"."),o=s.shift();
return n.listeners[o]=n.listeners[o]||[],r={name:t,orig:e,func:_.bind(e,this)},n.listeners[o].push(r),this},h.prototype.off=function(t,e){var r,n,s,o;if(r=_.split(t,"."),o=new RegExp(_.escapeRegExp(t),"gi"),n=r.shift(),s=n?this.listeners[n]||[]:[],s.length)for(var i=s.length-1;i>=0;i--)e?o.test(s[i].name)&&s[i].orig===e&&this.listeners[n].splice(i,1):o.test(s[i].name)&&this.listeners[n].splice(i,1);else{var a=this;for(n in a.listeners)!function(t){for(var r=t.length-1;r>=0;r--)e?o.test(t[r].name)&&t[r].orig===e&&t.splice(r,1):o.test(t[r].name)&&t.splice(r,1)}(a.listeners[n])}return o=null,this},h.prototype.fire=function(){var t=_.toArray(arguments),e=t.shift(),r=_.split(e,"."),n=r.shift(),s=this.listeners[n]||[],o=new RegExp(_.escapeRegExp(e),"gi");s.length&&_.forEach(s,function(r){n!=e?o.test(r.name)&&r.func.apply(r.func,t):r.func.apply(r.func,t)}),o=null},h.prototype.defprop=function(t){var e=this.constructor.defs||{};return e[t]},h}}(),function(){var t=Graph.lang.Matrix=Graph.extend({
props:{a:1,b:0,c:0,d:1,e:0,f:0},constructor:function(t,e,r,n,s,o){this.props.a=_.defaultTo(t,1),this.props.b=_.defaultTo(e,0),this.props.c=_.defaultTo(r,0),this.props.d=_.defaultTo(n,1),this.props.e=_.defaultTo(s,0),this.props.f=_.defaultTo(o,0)},x:function(t,e){return t*this.props.a+e*this.props.c+this.props.e},y:function(t,e){return t*this.props.b+e*this.props.d+this.props.f},get:function(t){return+this.props[t].toFixed(4)},multiply:function(e,r,n,s,o,i){var a,p,h,c,l=[[],[],[]],u=[[this.props.a,this.props.c,this.props.e],[this.props.b,this.props.d,this.props.f],[0,0,1]],d=[[e,n,o],[r,s,i],[0,0,1]];for(e instanceof t&&(d=[[e.props.a,e.props.c,e.props.e],[e.props.b,e.props.d,e.props.f],[0,0,1]]),a=0;a<3;a++)for(p=0;p<3;p++){for(c=0,h=0;h<3;h++)c+=u[a][h]*d[h][p];l[a][p]=c}return this.props.a=l[0][0],this.props.b=l[1][0],this.props.c=l[0][1],this.props.d=l[1][1],this.props.e=l[0][2],this.props.f=l[1][2],this},invert:function(t){var e,r,n,s,o,i,a=this.props.a*this.props.d-this.props.b*this.props.c;
return t=_.defaultTo(t,!1),e=this.props.d/a,r=-this.props.b/a,n=-this.props.c/a,s=this.props.a/a,o=(this.props.c*this.props.f-this.props.d*this.props.e)/a,i=(this.props.b*this.props.e-this.props.a*this.props.f)/a,t?new Graph.matrix(e,r,n,s,o,i):(this.props.a=e,this.props.b=r,this.props.c=n,this.props.d=s,this.props.e=o,this.props.f=i,this)},translate:function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.multiply(1,0,0,1,t,e),this},rotate:function(t,e,r){t=Graph.rad(t),e=_.defaultTo(e,0),r=_.defaultTo(r,0);var n=+Math.cos(t).toFixed(9),s=+Math.sin(t).toFixed(9);return this.multiply(n,s,-s,n,e,r),this.multiply(1,0,0,1,-e,-r),this},scale:function(t,e,r,n){return y=_.defaultTo(e,t),(r||n)&&(r=_.defaultTo(r,0),n=_.defaultTo(n,0)),(r||n)&&this.multiply(1,0,0,1,r,n),this.multiply(t,0,0,e,0,0),(r||n)&&this.multiply(1,0,0,1,-r,-n),this},determinant:function(){return this.props.a*this.props.d-this.props.b*this.props.c},delta:function(t,e){return{x:t*this.props.a+e*this.props.c+0,y:t*this.props.b+e*this.props.d+0
}},data:function(){var t=this.delta(0,1),e=this.delta(1,0),r=180/Math.PI*Math.atan2(t.y,t.x)-90,n=Graph.rad(r),s=Math.cos(n),o=Math.sin(n),i=Graph.magnitude(this.props.a,this.props.b),a=Graph.magnitude(this.props.c,this.props.d),p=Graph.rad(r);return this.determinant()<0&&(i=-i),{x:this.props.e,y:this.props.f,dx:(this.props.e*s+this.props.f*o)/i,dy:(this.props.f*s+this.props.e*-o)/a,skewX:-r,skewY:180/Math.PI*Math.atan2(e.y,e.x),scaleX:i,scaleY:a,rotate:r,rad:p,sin:Math.sin(p),cos:Math.cos(p),a:this.props.a,b:this.props.b,c:this.props.c,d:this.props.d,e:this.props.e,f:this.props.f}},toString:function(){var t=[this.get("a"),this.get("b"),this.get("c"),this.get("d"),this.get("e"),this.get("f")];return"matrix("+_.join(t,",")+")"},toFilter:function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get("a")+", M12="+this.get("c")+", M21="+this.get("b")+", M22="+this.get("d")+", Dx="+this.get("e")+", Dy="+this.get("f")+", sizingmethod='auto expand')"},toArray:function(){return[[this.get("a"),this.get("c"),this.get("e")],[this.get("b"),this.get("d"),this.get("f")],[0,0,1]];
},clone:function(){return new t(this.props.a,this.props.b,this.props.c,this.props.d,this.props.e,this.props.f)}})}(),function(){function t(t,e){return e*Math.round(t/e)}var e=Graph.lang.Point=Graph.extend({props:{x:0,y:0},constructor:function(t,e){if(_.isString(t)){var r=_.split(_.trim(t),",");t=_.toNumber(r[0]),e=_.toNumber(r[1])}this.props.x=t,this.props.y=e},distance:function(t){var e=this.props.x-t.props.x,r=this.props.y-t.props.y;return Math.sqrt(Math.pow(r,2)+Math.pow(e,2))},manhattan:function(t){return Math.abs(t.props.x-this.props.x)+Math.abs(t.props.y-this.props.y)},angle:function(t){return Graph.angle(this.props.x,this.props.y,t.props.x,t.props.y)},triangle:function(t,e){return this.angle(e)-t.angle(e)},theta:function(t){return Graph.theta(this.props.x,this.props.y,t.props.x,t.props.y)},difference:function(t){return new e(this.props.x-t.props.x,this.props.y-t.props.y)},snap:function(e,r){return r=_.defaultTo(r,e),this.props.x=t(this.props.x,e),this.props.y=t(this.props.y,r),this;
},expand:function(t,e){return this.props.x+=t,this.props.y+=e,this},equals:function(t){return this.props.x===t.props.x&&this.props.y===t.props.y},stringify:function(t){return t=_.defaultTo(t,","),this.props.x+t+this.props.y},toString:function(){return this.stringify()},serialize:function(){return{x:this.props.x,y:this.props.y}},clone:function(){return new e(this.props.x,this.props.y)}})}(),function(){var t=Graph.lang.Path=Graph.extend({__CLASS__:"Graph.lang.Path",paths:[],segments:[],constructor:function(e){var r=[];r=e instanceof t?_.cloneDeep(e.segments):_.isArray(e)?_.clone(e):Graph.cmd2seg(e),this.segments=r,this.paths=this.segments},absolute:function(){if(!this.segments.length)return new t([["M",0,0]]);var e=Graph.lookup(this.__CLASS__,"absolute",this.toString()),r=this.segments;if(e.absolute)return e.absolute;var n=[],s=0,o=0,i=0,a=0,p=0;"M"==r[0][0]&&(s=+r[0][1],o=+r[0][2],i=s,a=o,p++,n[0]=["M",s,o]);for(var h,c,l,u=3==r.length&&"M"==r[0][0]&&"R"==r[1][0].toUpperCase()&&"Z"==r[2][0].toUpperCase(),d=p,f=r.length;d<f;d++){
if(n.push(c=[]),l=r[d],l[0]!=_.toUpper(l[0]))switch(c[0]=_.toUpper(l[0]),c[0]){case"A":c[1]=l[1],c[2]=l[2],c[3]=l[3],c[4]=l[4],c[5]=l[5],c[6]=+(l[6]+s),c[7]=+(l[7]+o);break;case"V":c[1]=+l[1]+o;break;case"H":c[1]=+l[1]+s;break;case"R":h=_.concat([s,o],l.slice(1));for(var g=2,v=h.length;g<v;g++)h[g]=+h[g]+s,h[++g]=+h[g]+o;n.pop(),n=_.concat(n,[["C"].concat(Graph.catmull2bezier(h,u))]);break;case"M":i=+l[1]+s,a=+l[2]+o;default:for(var m=1,x=l.length;m<x;m++)c[m]=+l[m]+(m%2?s:o)}else if("R"==l[0])h=_.concat([s,o],l.slice(1)),n.pop(),n=_.concat(n,[["C"].concat(Graph.catmull2bezier(h,u))]),c=_.concat(["R"],l.slice(-2));else for(var y=0,b=l.length;y<b;y++)c[y]=l[y];switch(c[0]){case"Z":s=i,o=a;break;case"H":s=c[1];break;case"V":o=c[1];break;case"M":i=c[c.length-2],a=c[c.length-1];default:s=c[c.length-2],o=c[c.length-1]}}return e.absolute=n=new t(n),n},start:function(){return this.pointAt(0)},end:function(){return this.pointAt(this.length())},relative:function(){var e=Graph.lookup(this.__CLASS__,"relative",this.toString()),r=this.segments;
if(e.relative)return e.relative;var n=[],s=0,o=0,i=0,a=0,p=0;"M"==r[0][0]&&(s=r[0][1],o=r[0][2],i=s,a=o,p++,n.push(["M",s,o]));for(var h=p,c=r.length;h<c;h++){var l=n[h]=[],u=r[h];if(u[0]!=_.toLower(u[0]))switch(l[0]=_.toLower(u[0]),l[0]){case"a":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]-s).toFixed(3),l[7]=+(u[7]-o).toFixed(3);break;case"v":l[1]=+(u[1]-o).toFixed(3);break;case"m":i=u[1],a=u[2];default:for(var d=1,f=u.length;d<f;d++)l[d]=+(u[d]-(d%2?s:o)).toFixed(3)}else{l=res[h]=[],"m"==u[0]&&(i=u[1]+s,a=u[2]+o);for(var g=0,v=u.length;g<v;g++)res[h][g]=u[g]}var m=n[h].length;switch(n[h][0]){case"z":s=i,o=a;break;case"h":s+=+n[h][m-1];break;case"v":o+=+n[h][m-1];break;default:s+=+n[h][m-2],o+=+n[h][m-1]}}return e.relative=n=new t(n),n},curve:function(e){function r(t,e,r){var n,s,o={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in o)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(Graph.arc2curve.apply(0,[e.x,e.y].concat(t.slice(1))));
break;case"S":"C"==r||"S"==r?(n=2*e.x-e.bx,s=2*e.y-e.by):(n=e.x,s=e.y),t=["C",n,s].concat(t.slice(1));break;case"T":"Q"==r||"T"==r?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),path=["C"].concat(Graph.quad2curve(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],path=["C"].concat(Graph.quad2curve(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(Graph.line2curve(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(Graph.line2curve(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(Graph.line2curve(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(Graph.line2curve(e.x,e.y,e.X,e.Y))}return t}function n(t,e){if(t[e].length>7){t[e].shift();for(var r=t[e];r.length;)c[e]="A",a&&(l[e]="A"),t.splice(e++,0,["C"].concat(r.splice(0,6)));t.splice(e,1),g=_.max([i.length,a&&a.length||0])}}function s(t,e,r,n,s){t&&e&&"M"==t[s][0]&&"M"!=e[s][0]&&(e.splice(s,0,["M",n.x,n.y]),r.bx=0,r.by=0,r.x=t[s][1],r.y=t[s][2],g=_.max([i.length,a&&a.length||0]))}var o=e?{}:Graph.lookup(this.__CLASS__,"curve",this.toString());
if(o.curve)return o.curve;for(var i=_.cloneDeep(this.absolute().segments),a=e&&_.cloneDeep(new t(e).absolute().segments),p={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},h={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},c=[],l=[],u="",d="",f=0,g=_.max([i.length,a&&a.length||0]);f<g;f++){i[f]&&(u=i[f][0]),"C"!=u&&(c[f]=u,f&&(d=c[f-1])),i[f]=r(i[f],p,d),"A"!=c[f]&&"C"==u&&(c[f]="C"),n(i,f),a&&(a[f]&&(u=a[f][0]),"C"!=u&&(l[f]=u,f&&(d=l[f-1])),a[f]=processPath(a[f],attrs2,pcom),"A"!=l[f]&&"C"==u&&(l[f]="C"),fixArc(a,f)),s(i,a,p,h,f),s(a,i,h,p,f);var v=i[f],m=a&&a[f],x=v.length,y=a&&m.length;p.x=v[x-2],p.y=v[x-1],p.bx=_.float(v[x-4])||p.x,p.by=_.float(v[x-3])||p.y,h.bx=a&&(_.float(m[y-4])||h.x),h.by=a&&(_.float(m[y-3])||h.y),h.x=a&&m[y-2],h.y=a&&m[y-1]}return a?[new t(i),new t(a)]:(o.curve=new t(i),o.curve)},bbox:function(){if(!this.segments.length)return new Graph.lang.BBox({x:0,y:0,width:0,height:0,x2:0,y2:0});var t=Graph.lookup(this.__CLASS__,"bbox",this.toString());if(t.bbox)return t.bbox;for(var e,r=this.curve().segments,n=0,s=0,o=[],i=[],a=0,p=r.length;a<p;a++)if(e=r[a],
"M"==e[0])n=e[1],s=e[2],o.push(n),i.push(s);else{var h=Graph.curvebox(n,s,e[1],e[2],e[3],e[4],e[5],e[6]);o=o.concat(h.min.x,h.max.x),i=i.concat(h.min.y,h.max.y),n=e[5],s=e[6]}var c=_.min(o),l=_.min(i),u=_.max(o),d=_.max(i),f=u-c,g=d-l,v={x:c,y:l,x2:u,y2:d,width:f,height:g,cx:c+f/2,cy:l+g/2};return t.bbox=new Graph.lang.BBox(v),t.bbox},transform:function(e){if(e){var r=Graph.lookup(this.__CLASS__,"transform",this+"",e+"");if(r.transform)return r.transform;var n,s,o,i,a,p,h,c=_.cloneDeep(this.curve().segments);for(o=0,i=c.length;o<i;o++)for(h=c[o],a=1,p=h.length;a<p;a+=2)n=e.x(h[a],h[a+1]),s=e.y(h[a],h[a+1]),h[a]=n,h[a+1]=s;return r.transform=new t(c),r.transform}},pointAt:function(t){var e,r,n,s,o,i,a,p=this.curve().segments;o=0;for(var h=0,c=p.length;h<c;h++)if(r=p[h],"M"==r[0])n=r[1],s=r[2];else{if(i=Graph.curve([["M",n,s],r]),a=i.length(),o+a>t)return e=i.pointAt(t-o,i.t(t-o)),i=null,e;o+=a,n=r[5],s=r[6],i=null}return i=Graph.curve([["M",n,s],r]),e=i.pointAt(1),i=null,e},length:function(){
var t,e,r,n,s,o=this.curve().segments;n=0;for(var i=0,a=o.length;i<a;i++)t=o[i],"M"==t[0]?(e=t[1],r=t[2]):(s=Graph.curve([["M",e,r],t]),n+=s.length(),e=t[5],r=t[6],s=null);return n},slice:function(t,e){var r,n,s,o,i,a,p,h,c=this.curve().segments,l={};a=0,n="";for(var u=0,d=c.length;u<d;u++)s=c[u],"M"==s[0]?(o=s[1],i=s[2]):(p=Graph.curve([["M",o,i],s]),h=p.length(),a+h>length&&(r=p.pointAt(length-a,p.t(length-a)),n+=["C"+r.start.x,r.start.y,r.m.x,r.m.y,r.props.x,r.props.y],l.start=Graph.path(n),n=["M"+r.props.x,r.props.y+"C"+r.n.x,r.n.y,r.end.x,r.end.y,s[5],s[6]].join()),a+=h,o=s[5],i=s[6],p=null),n+=s.shift()+s;return l.end=Graph.path(n),l},toString:function(){return Graph.seg2cmd(this.segments)},toArray:function(){return this.segments},clone:function(){var e=_.cloneDeep(this.segments);return new t(e)}})}(),function(){var t=Graph.lang.BBox=Graph.extend({props:{x:0,y:0,x2:0,y2:0,width:0,height:0},constructor:function(t){this.props=_.cloneDeep(t)},data:function(t,e){return _.isUndefined(t)&&_.isUndefined(e)?this.props:_.isUndefined(e)?this.props[t]:null;
},x:function(){return this.props.x},y:function(){return this.props.y},origin:function(){return new Graph.lang.Point(this.props.x,this.props.y)},center:function(){return new Graph.lang.Point(this.props.x+this.props.width/2,this.props.y+this.props.height/2)},corner:function(){return new Graph.lang.Point(this.props.x+this.props.width,this.props.y+this.props.height)},width:function(){return this.props.width},height:function(){return this.props.height},clone:function(){return new t(_.cloneDeep(this.props))},contain:function(t){var e,r=!0,n=this.props,s=[];if(t instanceof Graph.lang.Point)s=[[t.props.x,t.props.y]];else if(t instanceof Graph.svg.Vector)s=t.dots(!0);else if(t instanceof Graph.lang.BBox)s=[[t.props.x,t.props.y],[t.props.x2,t.props.y2]];else{var o=_.toArray(arguments);2===o.length&&(s=[o])}if(s.length)for(var i=s.length;i--&&(e=s[i],r=e[0]>=n.x&&e[0]<=n.x2&&e[1]>=n.y&&e[1]<=n.y2););return r},expand:function(t,e,r,n){return this.props.x+=_.defaultTo(t,0),this.props.y+=_.defaultTo(e,0),
this.props.width+=_.defaultTo(r,0),this.props.height+=_.defaultTo(n,0),this},intersect:function(t){var e=this,r=e.props;e.contain;return t.contain(r.x,r.y)||t.contain(r.x2,r.y)||t.contain(r.x,r.y2)||t.contain(r.x2,r.y2)||e.contain(t.x,t.y)||e.contain(t.x2,t.y)||e.contain(t.x,t.y2)||e.contain(t.x2,t.y2)||(r.x<t.x2&&r.x>t.x||t.x<r.x2&&t.x>r.x)&&(r.y<t.y2&&r.y>t.y||t.y<r.y2&&t.y>r.y)}})}(),function(){function t(t,e,r,n,s){var o=-3*e+9*r-9*n+3*s,i=t*o+6*e-12*r+6*n;return t*i-3*e+3*r}var e=12,r=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],n=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];Graph.lang.Curve=Graph.extend({segments:[],constructor:function(t){if(this.segments=_.isString(t)?Graph.cmd2seg(t):_.cloneDeep(t),"M"!=this.segments[0][0]&&this.segments.unshift(["M",this.segments[0][1],this.segments[0][2]]),1===this.segments.length&&"M"===this.segments[0][0]){var e=this.segments[0][1],r=this.segments[0][2];this.segments.push(["C",e,r,e,r,e,r]);
}},length:function(s){s=_.defaultTo(s,1),s=s>1?1:s<0?0:s;for(var o=s/2,i=this.segments,a=i[0][1],p=i[0][2],h=i[1][1],c=i[1][2],l=i[1][3],u=i[1][4],d=i[1][5],f=i[1][6],g=0,v=0;v<e;v++){var m=o*r[v]+o,x=t(m,a,h,l,d),y=t(m,p,c,u,f),b=x*x+y*y;g+=n[v]*Math.sqrt(b)}return o*g},t:function(t){if(!(t<0||this.length()<t)){var e,r=1,n=r/2,s=r-n,o=.01;for(e=this.length(s);Math.abs(e-t)>o;)n/=2,s+=(e<t?1:-1)*n,e=this.length(s);return s}},pointAt:function(t,e){var r=this.segments,n=r[0][1],s=r[0][2],o=r[1][1],i=r[1][2],a=r[1][3],p=r[1][4],h=r[1][5],c=r[1][6],l=1-e,u=Math.pow(l,3),d=Math.pow(l,2),f=e*e,g=f*e,v=u*n+3*d*e*o+3*l*e*e*a+g*h,m=u*s+3*d*e*i+3*l*e*e*p+g*c,x=n+2*e*(o-n)+f*(a-2*o+n),y=s+2*e*(i-s)+f*(p-2*i+s),b=o+2*e*(a-o)+f*(h-2*a+o),G=i+2*e*(p-i)+f*(c-2*p+i),w=l*n+e*o,k=l*s+e*i,C=l*a+e*h,M=l*p+e*c,T=90-180*Math.atan2(x-b,y-G)/Math.PI;if((x>b||y<G)&&(T+=180),isNaN(v)||isNaN(m))return null;var z=Graph.point(v,m);return _.extend(z,{m:{x:x,y:y},n:{x:b,y:G},start:{x:w,y:k},end:{x:C,y:M},alpha:T}),z}
})}(),function(){var t=Graph.dom.Element=function(t){this.elem=t instanceof jQuery?t:$(t)};_.extend(t.prototype,{node:function(){return this.elem[0]},attr:function(t,e){var r=this,n=this.elem[0];if(Graph.isHTML(n))this.elem.attr(t,e);else if(Graph.isSVG(n)){if(_.isPlainObject(t))return _.forOwn(t,function(t,e){r.attr(e,t)}),this;"xlink:"==t.substring(0,6)?n.setAttributeNS(Graph.config.xmlns.xlink,t.substring(6),_.toString(e)):n.setAttribute(t,_.toString(e))}return this},width:function(t){return _.isUndefined(t)?this.elem.width():(this.elem.width(t),this)},height:function(t){return _.isUndefined(t)?this.elem.height():(this.elem.height(t),this)},show:function(){return this.elem.show(),this},hide:function(){return this.elem.hide(),this},offset:function(){return this.elem.offset()},position:function(){return this.elem.position()},addClass:function(t){var e=this.elem[0];return Graph.isHTML(e)&&this.elem.addClass(t),this},removeClass:function(t){var e=this.elem[0];return Graph.isHTML(e)&&this.elem.removeClass(t),
this},hasClass:function(t){var e=this.elem[0];if(Graph.isHTML(e))return this.elem.hasClass(t);if(Graph.isSVG(e)){var r=_.split(e.className.baseVal," ");return r.indexOf(t)>-1}return!1},append:function(t){return Graph.isElement(t)?this.elem.append(t.elem):this.elem.append(t),this},prepend:function(t){return Graph.isElement(t)?this.elem.prepend(t.elem):this.elem.prepend(t),this},appendTo:function(t){return Graph.isElement(t)?this.elem.appendTo(t.elem):this.elem.appendTo(t),this},on:function(t,e,r,n,s){return this.elem.on.call(this.elem,t,e,r,n,s),this},off:function(t,e,r){return this.elem.off.call(this.elem,t,e,r),this}});var e=["css","prop","data","each","hover","empty","remove","trigger","scrollTop","scrollLeft","html","text"];_.forEach(e,function(e){!function(e){t.prototype[e]=function(){var t,r=_.toArray(arguments);return t=this.elem[e].apply(this.elem,r),t instanceof jQuery?this:t}}(e)}),Graph.$=function(t,e){return new Graph.dom.Element($(t,e))},Graph.$svg=function(t){var e=document.createElementNS(Graph.config.xmlns.svg,t);
return new Graph.dom.Element($(e))},Graph.doc=function(){return document}}(),function(){function t(e,r){var n=e.children().items;e.props.collectable&&r.call(e,e),n.length&&_.forEach(n,function(e){t(e,r)})}function e(t){return t.parentNode?"svg"==t.parentNode.nodeName?t.parentNode.getBoundingClientRect():e(t.parentNode):{top:0,left:0}}var r=0;Graph.svg.Vector=Graph.lang.Class.extend({type:"",canvas:null,dirty:!1,transformer:null,collector:null,history:null,dragger:null,dropper:null,resizer:null,sorter:null,linker:null,rendered:!1,tree:{next:null,prev:null,parent:null,children:null},props:{text:"",rotate:0,collectable:!0,selectable:!0,selected:!1,focusable:!1},attrs:{stroke:"#4A4D6E","stroke-width":1,fill:"none",style:"",class:""},events:{render:!0,transform:!0,resize:!0,reset:!0,select:!0,deselect:!0,collect:!0,decollect:!0,dragstart:!0,dragmove:!0,dragend:!0},constructor:function(t,e){var n=this;n.cached={touchedBBox:null,pristinBBox:null,position:null,offset:null},n.matrix=Graph.matrix(),
n.tree.children=new Graph.collection.Vector,n.tree.children.on({push:_.bind(n.onAppendChild,n),pull:_.bind(n.onRemoveChild,n),unshift:_.bind(n.onPrependChild,n)}),n.type=t,n.elem=Graph.$(Graph.doc().createElementNS(Graph.config.xmlns.svg,t)),n.elem.data("vector",n),e=_.extend({id:"graph-node-"+ ++r},n.attrs,e||{}),n.attr(e),n.transformer=new Graph.plugin.Transformer(n),n.transformer.on({transform:_.bind(n.onTransform,n)})},id:function(){return this.attrs.id},reset:function(){this.matrix=Graph.matrix(),this.removeAttr("transform"),this.props.angle=0,this.dirty=!0,this.fire("reset",this.props)},resizable:function(t){return this.resizer||(this.resizer=new Graph.plugin.Resizer(this,t),this.resizer.on({resize:_.bind(this.onResizerResize,this)})),this.resizer},draggable:function(t){return this.dragger||(this.dragger=new Graph.plugin.Dragger(this,t),this.dragger.on({dragstart:_.bind(this.onDraggerStart,this),dragmove:_.bind(this.onDraggerMove,this),dragend:_.bind(this.onDraggerEnd,this)})),this.dragger;
},droppable:function(){return this.dropper||(this.dropper=new Graph.plugin.Dropper(this)),this.dropper},sortable:function(t){return this.sorter||(this.sorter=new Graph.plugin.Sorter(this,t)),this.Snapper},linkable:function(t){return this.network||(this.network=new Graph.plugin.Network(this,t)),this.network},collectable:function(t){return _.isUndefined(t)?this.props.collectable:(this.props.collectable=t,this)},selectable:function(t){return _.isUndefined(t)?this.props.selectable:(this.props.selectable=t,this)},clickable:function(t){var e=this;return _.isUndefined(t)?e.attrs["pointer-events"]:(t?this.attr("pointer-events",""):this.attr("pointer-events","none"),this)},node:function(){return this.elem.node()},data:function(t,e){var r=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){r.props[e]=t}),this):_.isUndefined(t)&&_.isUndefined(e)?r.props:_.isUndefined(e)?r.props[t]:(r.props[t]=e,this)},attr:function(t,e){var r=this,n=r.node();return _.isPlainObject(t)?(_.forOwn(t,function(t,e){
r.attr(e,t)}),r):_.isUndefined(t)?r.attrs:_.isUndefined(e)?r.attrs[t]||"":(r.attrs[t]=e,"xlink:"==t.substring(0,6)?n.setAttributeNS(Graph.config.xmlns.xlink,t.substring(6),_.toString(e)):"class"==t?n.className.baseVal=_.toString(e):n.setAttribute(t,_.toString(e)),r)},removeAttr:function(t){return this.node().removeAttribute(t),this.attrs[t]&&delete this.attrs[t],this},style:function(t,e){var r=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){r.style(e,t)}),this):(this.elem.css(t,e),this)},hasClass:function(t){return _.indexOf(_.split(this.attrs.class," "),t)>-1},addClass:function(t){var e=_.trim(_.join(_.uniq(_.concat(_.split(this.attrs.class," "),_.split(t," ")))," "));return this.attr("class",e),this},removeClass:function(t){var e=_.split(this.attrs.class," ");return _.pullAll(e,_.split(t," ")),this.attr("class",_.join(e," ")),this},hide:function(){this.elem.hide()},show:function(){this.elem.show()},pathinfo:function(){return new Graph.lang.Path([])},vertices:function(){return[];
},dots:function(t){var e,r,n;return t=_.defaultTo(t,!1),e=this.pathinfo().transform(t?this.ctm():this.matrix),r=e.segments,n=[],_.forEach(r,function(t){var e,r;"Z"!=t[0]&&(e=t[t.length-2],r=t[t.length-1],n.push([e,r]))}),n},dotval:function(t,e){var r=this.matrix;return{x:r.x(t,e),y:r.y(t,e)}},dimension:function(){var t={},e=this.node();try{t=e.getBBox()}catch(r){t={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}finally{t=t||{}}return t},offset:function(t){if(t=_.defaultTo(t,!0),this.dirty||_.isNull(this.cached.offset)){var e=this.node(),r=e.getBoundingClientRect();t&&(this.dirty=!1),this.cached.offset={top:r.top,left:r.left,bottom:r.bottom,right:r.right,width:r.width,height:r.height}}return this.cached.offset},position:function(t){if(t=_.defaultTo(t,!0),this.dirty||_.isNull(this.cached.position)){var r=this.node(),n=r.getBoundingClientRect(),s=e(r);t&&(this.dirty=!1),this.cached.position={top:n.top-s.top,left:n.left-s.left,bottom:n.bottom-s.top,right:n.right-s.left,
width:n.width,height:n.height}}return this.cached.position},ctm:function(){var t=this.node().getCTM();return t?Graph.matrix(t.a,t.b,t.c,t.d,t.e,t.f):this.matrix},bbox:function(t,e){var r,n;return t=_.defaultTo(t,!1),e=_.defaultTo(e,!0),t?(n=this.cached.pristinBBox,!this.dirty&&n||(r=this.pathinfo(),n=this.cached.pristinBBox=r.bbox(),e&&(this.dirty=!1))):(n=this.cached.touchedBBox,!this.dirty&&n||(r=this.pathinfo().transform(this.matrix),n=this.cached.touchedBBox=r.bbox(),e&&(this.dirty=!1))),r=null,n},find:function(t){var e=this.elem.find(t),r=[];return e.each(function(t,e){r.push($(e).data("vector"))}),new Graph.collection.Vector(r)},holder:function(){return this.isCanvas()?Graph.$(this.node().parentNode):Graph.$(this.canvas.node().parentNode)},append:function(t){return t.render(this,"append"),t},prepend:function(t){return t.render(this,"prepend"),t},render:function(t,e){var r=this,n=r.props.collectable;if(r.rendered)return r;if(t=_.defaultTo(t,r.canvas),e=_.defaultTo(e,"append"),t){switch(r.canvas=t.isCanvas()?t:t.canvas,
r.tree.parent=t,e){case"append":t.elem.append(r.elem),n&&t.children().push(r);break;case"prepend":t.elem.prepend(r.elem),n&&t.children().unshift(r)}t.rendered&&(r.rendered=!0,r.dirty=!0,r.fire("render",r),r.cascade(function(t){t===r||t.rendered||(t.rendered=!0,t.canvas=r.canvas,t.fire("render",t))}))}return r},paper:function(){return this.isCanvas()?this:this.canvas},children:function(){return this.tree.children},ancestors:function(){for(var t,e=this,r=[];(t=e.parent())&&!t.isCanvas();)r.push(t),t=t.parent();return new Graph.collection.Vector(r)},descendants:function(){var t=this,e=[];return t.cascade(function(r){r!==t&&e.push(r)}),new Graph.collection.Vector(e)},parent:function(){return this.tree.parent},prev:function(){return this.tree.prev},next:function(){return this.tree.next},cascade:function(e){var r=this;t(r,e)},remove:function(){return this.elem.remove(),this},empty:function(){return this.elem.empty(),this},select:function(){return this.addClass("graph-selected"),this.props.selected=!0,
this.fire("select",this),this},deselect:function(){return this.removeClass("graph-selected"),this.props.selected=!1,this.fire("deselect",this),this},transform:function(t){return this.transformer.transform(t)},translate:function(t,e){return this.transformer.translate(t,e)},scale:function(t,e,r,n){return this.transformer.scale(t,e,r,n)},rotate:function(t,e,r){return this.transformer.rotate(t,e,r)},globalMatrix:function(){var t=this.node().getCTM();return t?Graph.matrix(t.a,t.b,t.c,t.d,t.e,t.f):Graph.matrix()},screenMatrix:function(){var t=this.node().getScreenCTM();return Graph.matrix(t.a,t.b,t.c,t.d,t.e,t.f)},deltaMatrix:function(){},backward:function(){},forward:function(){var t=this.parent();t&&t.elem.append(this.node())},front:function(){return this.canvas?(this.canvas.elem.append(this.node()),this):this},back:function(){return this.canvas?(this.canvas.elem.prepend(this.node()),this):this},focus:function(t){var e,r=this.canvas;r&&r.spotlight&&(t=_.defaultTo(t,!0),e=_.delay(function(t,n){
clearTimeout(e),r.spotlight.focus(t,n)},0,this,t))},resize:function(t,e,r,n,s,o){return this},isGroup:function(){return"g"==this.type},isCanvas:function(){return this instanceof Graph.svg.Paper},isCollectable:function(){return this.props.collectable},isSelectable:function(){return this.props.selectable},isDraggable:function(){return!!this.dragger},isResizable:function(){return this.props.resizable},onResizerResize:function(t,e){this.dirty=!0,this.fire("resize",t,this)},onDraggerStart:function(t,e){var r=this;t.dragger=e,r.fire("dragstart",t,r),r.$collector&&r.$collector.syncDragStart(r,t)},onDraggerMove:function(t,e){t.dragger=e,this.fire("dragmove",t,this),this.$collector&&this.$collector.syncDragMove(this,t)},onDraggerEnd:function(t,e){this.dirty=!0,t.dragger=e,this.fire("dragend",t,this),this.$collector&&this.$collector.syncDragEnd(this,t)},onTransform:function(t,e){this.dirty=!0,t.rotate&&(this.props.angle=t.rotate.deg,this.props.rotate=t.rotate.deg),this.fire("transform",t,this)},onAppendChild:function(t){
this.fire("appendchild",t,this)},onRemoveChild:function(t){this.fire("removechild",t,this)},onPrependChild:function(t){this.fire("prependchild",t,this)}})}(),function(){Graph.svg.Paper=Graph.svg.Vector.extend({attrs:{class:"graph-paper"},props:{text:"",angle:0,collectable:!1,selectable:!1,selected:!1,focusable:!1},canvas:null,hinter:null,definer:null,collector:null,container:null,scroller:null,pointer:null,linker:null,constructor:function(t,e){var r=this;r.$super("svg",{xmlns:Graph.config.xmlns.svg,"xmlns:link":Graph.config.xmlns.xlink,version:Graph.config.svg.version,width:_.defaultTo(t,200),height:_.defaultTo(e,200)}),r.style({overflow:"hidden",position:"relative"}),r.collector=new Graph.util.Collector,r.definer=new Graph.util.Definer,r.linker=new Graph.util.Linker,r.router=new Graph.util.Router,r.spotlight=new Graph.util.Spotlight,r.hinter=null,r.definer.defineArrowMarker("marker-arrow"),r.elem.on({click:function(t){r.fire("click",t,r)}})},shape:function(t,e){var r,n;return r=_.capitalize(t),
n=new Graph.shape[r](e),n.render(this.elem),n},render:function(t){var e=this;e.rendered||(t=Graph.$(t),t.append(e.elem),e.container=t,e.definer.render(e),e.collector.render(e),e.linker.render(e),e.router.render(e),e.spotlight.render(e),e.attr({width:t.width(),height:t.height()}),e.rendered=!0,e.fire("render"),e.cascade(function(t){t===e||t.rendered||(t.canvas=e,t.fire("render",t))}))},autoScroll:function(t){this.scroller=Graph.$(t)}});var t={ellipse:"Ellipse",circle:"Circle",rect:"Rect",path:"Path",polygon:"Polygon",group:"Group",text:"Text",image:"Image",line:"Line",connector:"Connector"};_.forOwn(t,function(t,e){!function(t,e){Graph.svg.Paper.prototype[e]=function(){var e,r,n;return e=_.toArray(arguments),r=Graph.svg[t],n=Graph.factory(r,e),n.canvas=this,n}}(t,e)})}(),function(){Graph.svg.Circle=Graph.svg.Vector.extend({attrs:{style:"",class:"graph-elem graph-elem-circle"},constructor:function(t,e,r){var n=this;n.$super("circle",{cx:t,cy:e,r:r})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.r],["a",t.r,t.r,0,1,1,0,2*t.r],["a",t.r,t.r,0,1,1,0,-2*t.r],["z"]]);
},resize:function(t,e,r,n,s,o){var i,a,p,h=this.matrix.clone(),c=this.props.rotate,l=this.attrs.cx,u=this.attrs.cy,d=this.attrs.r;return 1===e?(p=d*t,e=t):1===t?(p=d*e,t=e):t<e?(p=d*e,t=e):t>e&&(p=d*t,e=t),h.scale(t,e,r,n),i=h.x(l,u),a=h.y(l,u),this.reset(),this.attr({cx:i,cy:a,r:p}),c&&this.rotate(c,i,a).apply(),{matrix:h,translate:{dx:s,dy:o},scale:{sx:t,sy:e,cx:r,cy:n},rotate:{deg:c,cx:i,cy:a}}}})}(),function(){Graph.svg.Ellipse=Graph.svg.Vector.extend({attrs:{class:"graph-elem graph-elem-ellipse"},constructor:function(t,e,r,n){this.$super("ellipse",{cx:t,cy:e,rx:r,ry:n})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.ry],["a",t.rx,t.ry,0,1,1,0,2*t.ry],["a",t.rx,t.ry,0,1,1,0,-2*t.ry],["z"]])},resize:function(t,e,r,n,s,o){var i,a,p=this.matrix.clone().scale(t,e,r,n),h=this.props.rotate,c=p.x(this.attrs.cx,this.attrs.cy),l=p.y(this.attrs.cx,this.attrs.cy),u=this.attrs.rx*t,d=this.attrs.ry*e;this.reset(),this.attr({cx:c,cy:l,rx:u,ry:d}),h&&this.rotate(h,c,l).apply();
var f=this.bbox(!1,!1).data();return i=c-u-s,a=l-d-o,i=f.x,a=f.y,{matrix:p,translate:{dx:s,dy:o},scale:{sx:t,sy:e,cx:r,cy:n},rotate:{deg:h,cx:c,cy:l},magnify:{cx:i,cy:a}}}})}(),function(){Graph.svg.Group=Graph.svg.Vector.extend({attrs:{class:"graph-elem graph-elem-group"},constructor:function(t,e){this.$super("g"),_.isUndefined(t)||_.isUndefined(e)||(this.matrix.translate(t,e),this.attr("transform",this.matrix.toString()))},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])}})}(),function(){Graph.svg.Image=Graph.svg.Vector.extend({attrs:{preserveAspectRatio:"none",class:"graph-elem graph-elem-image"},constructor:function(t,e,r,n,s){var o=this;o.$super("image",{"xlink:href":t,x:_.defaultTo(e,0),y:_.defaultTo(r,0),width:_.defaultTo(n,0),height:_.defaultTo(s,0)})},align:function(t,e){if("none"==t)return this.attr("preserveAspectRatio","none"),this;var r=this.attrs.preserveAspectRatio,n="";switch(r=/(meet|slice)/.test(r)?r.replace(/(.*)\s*(meet|slice)/gi,"$2"):"",
e=_.defaultTo(e,r),t=t.replace(/s+/g," ").toLowerCase()){case"top left":case"left top":n="xMinYMin";break;case"top center":case"center top":n="xMidYMin";break;case"top right":case"right top":n="xMaxYMin";break;case"left":n="xMinYMid";break;case"center":n="xMidYMid";break;case"right":n="xMaxYMid";break;case"bottom left":case"left bottom":n="xMinYMax";break;case"bottom center":case"center bottom":n="xMidYMax";break;case"bottom right":case"right bottom":n="xMaxYMax"}return r=n+(e?" "+e:""),this.attr("preserveAspectRatio",r),this},pathinfo:function(){var t=this.attrs;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},resize:function(t,e,r,n,s,o){var i=this.matrix.clone().scale(t,e,r,n),a=this.matrix.data().rotate;this.reset();var p=i.x(this.attrs.x,this.attrs.y),h=i.y(this.attrs.x,this.attrs.y),c=+this.attrs.width*t,l=+this.attrs.height*e;return this.attr({x:p,y:h,width:c,height:l}),this.rotate(a,p,h).apply(),{matrix:i,x:p,y:h}}})}(),function(){
Graph.svg.Line=Graph.svg.Vector.extend({attrs:{class:"graph-elem graph-elem-line"},constructor:function(t,e,r,n){this.$super("line",{x1:_.defaultTo(t,0),y1:_.defaultTo(e,0),x2:_.defaultTo(r,0),y2:_.defaultTo(n,0)})}})}(),function(){Graph.svg.Path=Graph.svg.Vector.extend({attrs:{style:"",class:"graph-elem graph-elem-path"},constructor:function(t){this.$super("path",{d:Graph.path(t).absolute()+""}),this.cached={segments:null}},pathinfo:function(){return new Graph.lang.Path(this.attrs.d)},segments:function(){return(this.dirty||_.isNull(this.cached.segments))&&(this.cached.segments=this.pathinfo().segments),this.cached.segments},angle:function(){var t=_.clone(this.segments()),e=t.length-1;"Z"==t[e][0]&&(e--,t.pop()),1===t.length&&(e++,t.push(["L",t[0][1],t[0][2]]));var r=t[e][1]-t[e-1][1],n=t[e][2]-t[e-1][2];return(180+180*Math.atan2(-n,-r)/Math.PI+360)%360},slice:function(t,e){return this.pathinfo().slice(t,e)},pointAt:function(t){return this.pathinfo().pointAt(t)},length:function(){return this.pathinfo().length();
},startAt:function(t,e){var r,n=this.segments();return n[0][1]=t,n[0][2]=e,r=Graph.seg2cmd(n),this.attr("d",r),this.dirty=!0,this},stopAt:function(t,e){var r=this.segments(),n=r.length,s=n-1;return 1===n?r.push(["L",t,e]):"Z"==r[s][0]?(r[s-1][1]=t,r[s-1][2]=e):(r[s][1]=t,r[s][2]=e),this.attr("d",Graph.seg2cmd(r)),this},lineTo:function(t,e){var r,n=this.segments();return n.push(["L",t,e]),r=Graph.seg2cmd(n),this.attr("d",r),this.dirty=!0,this},close:function(){var t=this.segments,e=t.length-1;return"Z"!=t[e][0]&&t.push(["Z"]),this.attr("d",Graph.seg2cmd(t)),this},expandBy:function(t,e){var r,n,s,o=this.segments(),i=o.length,a=i-1;return 1===i?(n=o[0][1]+t,s=o[0][2]+e,o.push(["L",n,s])):"Z"==o[a][0]?(o[a-1][1]+=t,o[a-1][2]+=e):(o[a][1]+=t,o[a][2]+=e),r=Graph.seg2cmd(o),this.attr("d",r),this.dirty=!0,this},resize:function(t,e,r,n,s,o){var i=this.matrix.clone(),a=this.matrix.data().rotate,p=Graph.rad(a),h=(Math.sin(p),Math.cos(p),this.pathinfo()),c=h.segments,l=c[0][1],u=c[0][2];return a&&i.rotate(-a,l,u),
l=i.x(c[0][1],c[0][2]),u=i.y(c[0][1],c[0][2]),i.scale(t,e,r,n),_.forEach(c,function(t){var e,r,n,s;"Z"!=t[0]&&(e=t[t.length-2],r=t[t.length-1],n=i.x(e,r),s=i.y(e,r),t[t.length-2]=n,t[t.length-1]=s)}),this.reset(),this.attr("d",_.toString(h)),a&&this.rotate(a,l,u).apply(!0),{matrix:i,x:l,y:u}}})}(),function(){Graph.svg.Polygon=Graph.svg.Vector.extend({attrs:{style:"",class:"graph-elem graph-elem-polygon"},constructor:function(t){this.$super("polygon",{points:t})},draggable:function(t){this.$super(t)},pathinfo:function(){var t=Graph.polygon2path(this.attrs.points);return Graph.path(t)},resize:function(t,e,r,n,s,o){var i=this.matrix.clone(),a=this.matrix.clone(),p=this.props.rotate,h=this.pathinfo().segments,c=[],l=h[0][1],u=h[0][2];return p&&(a.rotate(-p,h[0][1],h[0][2]),l=a.x(h[0][1],h[0][2]),u=a.y(h[0][1],h[0][2])),a.scale(t,e,r,n),i.scale(t,e,r,n),_.forEach(h,function(t){var e,r,n,s;"Z"!=t[0]&&(e=t[t.length-2],r=t[t.length-1],n=a.x(e,r),s=a.y(e,r),c.push(n+","+s))}),c=_.join(c," "),this.reset(),
this.attr("points",c),p&&this.rotate(p,l,u).apply(),{matrix:i,translate:{dx:s,dy:o},scale:{sx:t,sy:e,cx:r,cy:n},rotate:{deg:p,cx:l,cy:u}}}})}(),function(){Graph.svg.Rect=Graph.svg.Vector.extend({attrs:{style:"",class:"graph-elem graph-elem-rect"},constructor:function(t,e,r,n,s){var o=this;s=_.defaultTo(s,0),o.$super("rect",{x:_.defaultTo(t,0),y:_.defaultTo(e,0),rx:s,ry:s,width:_.defaultTo(r,0),height:_.defaultTo(n,0)}),o.origpath=o.pathinfo()},attr:function(){var t=_.toArray(arguments);return this.$super.apply(this,t),this.attrs.r=this.attrs.rx,this},pathinfo:function(){var t=this.attrs;return t.r?Graph.path([["M",t.x+t.r,t.y],["l",t.width-2*t.r,0],["a",t.r,t.r,0,0,1,t.r,t.r],["l",0,t.height-2*t.r],["a",t.r,t.r,0,0,1,-t.r,t.r],["l",2*t.r-t.width,0],["a",t.r,t.r,0,0,1,-t.r,-t.r],["l",0,2*t.r-t.height],["a",t.r,t.r,0,0,1,t.r,-t.r],["z"]]):Graph.path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},resize:function(t,e,r,n,s,o){var i,a,p,h,c=this.matrix.clone(),l=this.props.rotate;
return c.scale(t,e,r,n),this.reset(),i=c.x(this.attrs.x,this.attrs.y),a=c.y(this.attrs.x,this.attrs.y),p=this.attrs.width*t,h=this.attrs.height*e,this.attr({x:i,y:a,width:p,height:h}),l&&this.rotate(l,i,a).apply(),{matrix:c,translate:{dx:s,dy:o},scale:{sx:t,sy:e,cx:r,cy:n},rotate:{deg:l,cx:i,cy:a}}}})}(),function(){Graph.svg.Text=Graph.svg.Vector.extend({attrs:{"text-anchor":"middle",class:"graph-elem graph-elem-text"},props:{text:"",angle:0,lineHeight:1,collectable:!0,selectable:!0,selected:!1},rows:[],constructor:function(t,e,r){this.$super("text",{x:_.defaultTo(t,0),y:_.defaultTo(e,0)}),this.attr({"font-size":Graph.config.font.size,"font-family":Graph.config.font.family}),this.text(r),this.on("render",_.bind(this.arrange,this))},text:function(t){if(_.isUndefined(t))return this.props.text;var e,r=(this.fontSize(),(t||"").split("\n")),n=Graph.doc();this.empty(),this.rows=[],_.forEach(r,_.bind(function(t,r){e=n.createElementNS(Graph.config.xmlns.svg,"tspan"),e.setAttribute("text-anchor","middle"),
e.setAttribute("alignment-baseline","center"),e.appendChild(n.createTextNode(t)),Graph.$(e).data("vector",this),this.rows[r]=e,this.elem.append(e)},this)),this.props.text=t},arrange:function(){var t=this.rows,e=this.fontSize(),r=this.lineHeight();this.bbox(!1,!1).data();if(t.length){for(var n=0,s=t.length;n<s;n++)n&&(t[n].setAttribute("x",this.attrs.x),t[n].setAttribute("dy",e*r));t[0].setAttribute("dy",0)}},center:function(t){if(t){var e,r,n,s,o,i=t.bbox(!1,!1).data(),a=this.matrix.data();this.reset(),e=this.bbox(!1,!1).data(),r=i.width/2,n=i.height/2,s=e.x+e.width/2,o=e.y+e.height/2,a.rotate?this.translate(r,n).rotate(a.rotate).apply():this.translate(r,n).apply()}},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},fontSize:function(){return _.parseInt(this.attrs["font-size"])},lineHeight:function(){return this.props.lineHeight},toString:function(){return this.props.text}})}(),function(){var t=Graph.collection.Vector=Graph.extend({
items:[],constructor:function(t){this.items=t||[]},has:function(t){return _.indexOf(this.items,t)>-1},not:function(e){var r=_.filter(this.items,function(t){return t!==e});return new t(r)},length:function(){return this.items.length},indexOf:function(t){return _.indexOf(this.items,t)},push:function(t){return this.items.push(t),this.fire("push",t,this),this},pop:function(){this.items.pop()},shift:function(){this.items.shift()},unshift:function(t){return this.items.unshift(t),this.fire("unshift",t,this),this},pull:function(t){return _.pull(this.items,t),this.fire("pull",t,this),this},each:function(t){_.forEach(this.items,function(e){t.call(e,e)})},pathinfo:function(){this.bbox();return new Graph.lang.Path([])},bbox:function(){for(var t,e=[],r=[],n=[],s=[],o=this.items.length-1;o>=0;o--)t=this.items[o].bbox(!1,!1).data(),e.push(t.x),r.push(t.y),n.push(t.x+t.width),s.push(t.y+t.height);return e=_.min(e),r=_.min(r),n=_.max(n),s=_.max(s),new Graph.lang.BBox({x:e,y:r,x2:n,y2:s,width:n-e,height:s-r
})},toArray:function(){return this.items}});_.forOwn(Graph.svg.Vector.prototype,function(e,r){!function(e,r){_.isUndefined(t.prototype[e])&&_.isFunction(r)&&(t.prototype[e]=function(){var t=_.toArray(arguments);return this.each(function(r){r[e].apply(r,t)}),this})}(r,e)})}(),function(){function t(t,e){return t.manhattan(e)}function e(t,e,r){var n=360/r;return Math.floor((t.theta(e)+n/2)/n)*n}function r(t,e){var r=Math.abs(t-e);return r>180?360-r:r}function n(t,e){for(var r,n=[],s={props:{x:0,y:0}},o=e;r=t[o];){var i=r.difference(o);i.equals(s)||(n.unshift(o),s=i),o=r}return n.unshift(o),n}Graph.router.Manhattan=Graph.extend({props:{step:10,grid:100,perpendicular:!0,maxLoops:2e3,maxAngle:180,angle:0},startdirs:["left","right","top","bottom"],enddirs:["left","right","top","bottom"],mapdirs:{right:{x:1,y:0},bottom:{x:0,y:1},left:{x:-1,y:0},top:{x:0,y:-1}},source:null,target:null,canvas:null,obstacle:null,constructor:function(t,e,r,n){var s=this;_.extend(s.props,n||{}),s.canvas=t,s.source=e,
s.target=r,s.obstacle=new Graph.util.Obstacle(t,e,r),s.obstacle.props.step=s.props.step,s.obstacle.props.grid=s.props.grid,s.obstacle.build()},directions:function(){var t=this.props.step,e=[{dx:t,dy:0,distance:t,angle:null},{dx:0,dy:-t,distance:t,angle:null},{dx:-t,dy:0,distance:t,angle:null},{dx:0,dy:t,distance:t,angle:null}];return _.forEach(e,function(t){t.angle=Graph.theta(0,0,t.dx,t.dy)}),e},penalties:function(){var t=this.props.step;return{0:0,45:t/2,90:t/2}},route:function(){var o=this,i=o.directions(),a=i.length,p=(o.penalties(),o.props.step),h=o.props.maxLoops,c=o.source.location().snap(p,p),l=o.target.location().snap(p,p);if(o.obstacle.permit(c)&&o.obstacle.permit(l)){var u,d,f,g,v,m,x,y,b,G,w,k=new s,C={},M={},T=c.toString(),z=l.toString(),S=0,A=0;for(k.add(T,t(c,l)),M[T]=0;!k.isEmpty()&&h>0;){if(d=k.pop(),f=new Graph.lang.Point(d),g=M[d],u=v,v=C[d]?e(C[d],f,a):null!==o.props.angle?o.props.angle:e(c,f,a),z==d&&(y=r(v,e(f,l,a)),f.equals(l)||y<180))return o.props.angle=v,console.log(A),
n(C,f);for(w=0;w<a;w++)G=i[w],y=r(v,G.angle),y>o.props.maxAngle||(x=f.clone().expand(G.dx,G.dy),m=x.toString(),!k.isClose(m)&&o.obstacle.permit(x)&&(_.delay(function(t){o.canvas.circle(t.props.x,t.props.y,2).render().collectable(!1).selectable(!1).style("stroke-width","0").style("fill","blue")},S+=100,x),b=g+G.distance,(!k.isOpen(m)||b<M[m])&&(C[m]=f,M[m]=b,k.add(m,b+t(x,l)))));A++,h--}}}});var s=Graph.extend({items:[],state:{},costs:{},constructor:function(){},add:function(t,e){var r,n=this;n.state[t]?n.items.splice(n.items.indexOf(t),1):n.state[t]="OPEN",n.costs[t]=e,r=_.sortedIndexBy(n.items,t,function(t){return n.costs[t]}),this.items.splice(r,0,t)},remove:function(t){this.state[t]="CLOSE"},isOpen:function(t){return"OPEN"==this.state[t]},isClose:function(t){return"CLOSE"==this.state[t]},isEmpty:function(){return 0===this.items.length},pop:function(){var t=this.items.shift();return this.remove(t),t}})}(),function(){Graph.util.Collector=Graph.extend({props:{x:0,y:0,x2:0,y2:0,dir:null,
top:0,left:0,width:0,height:0,offset:[0,0],suspended:!0},canvas:null,collection:[],components:{rubber:null},events:{beforedrag:!0,afterdrag:!0},constructor:function(){this.components.rubber=Graph.$('<div class="graph-rubberband">')},setup:function(){var t=this,e=t.canvas;t.plugin||(t.plugin=interact(e.node()).draggable({manualStart:!0,onstart:function(r){t.reset(),t.resize(0,0);var n=e.container.offset(),s=r.pageX-n.left,o=r.pageY-n.top;t.translate(s,o),t.props.offset=[s,o]},onmove:function(e){var r=0,n=0,s=0,o=0;if(t.props.dir){switch(t.props.dir){case"nw":r=e.dx,n=e.dy,s=0,o=0;break;case"ne":r=-e.dx,n=e.dy,s=e.dx,o=0;break;case"se":r=-e.dx,n=-e.dy,s=e.dx,o=e.dy;break;case"sw":r=e.dx,n=-e.dy,s=0,o=e.dy}t.props.width+=r,t.props.height+=n,t.props.width>=0&&t.props.height>=0?(t.translate(s,o),t.resize(t.props.width,t.props.height)):(t.props.width-=r,t.props.height-=n)}else switch(!0){case e.dx>0&&e.dy>0:t.props.dir="nw";break;case e.dx<0&&e.dy<0:t.props.dir="se";break;case e.dx<0&&e.dy>0:
t.props.dir="ne";break;case e.dx>0&&e.dy<0:t.props.dir="sw"}},onend:function(){var r;t.props.x2=t.props.x+t.props.width,t.props.y2=t.props.y+t.props.height,r=t.bbox(),e.cascade(function(n){n!==e&&n.selectable()&&!n.isGroup()&&r.contain(n)&&t.collect(n)}),t.resize(0,0),t.suspend()}}).on("down",function(e){var r=!(e.ctrlKey||e.shiftKey),n=Graph.get(e.target);if(!n.selectable())return void(r&&t.clearCollection())}).on("tap",function(e){var r=Graph.get(e.target),n=!(e.ctrlKey||e.shiftKey);if(r.selectable())return n&&t.clearCollection(r),void t.collect(r)},!0).on("move",function(r){var n=r.interaction,s=r.target;n.pointerIsDown&&n.interacting()===!1&&s===e.node()&&(t.props.suspended&&t.resume(),n.start({name:"drag"},r.interactable,t.components.rubber.node()))}),t.plugin.styleCursor(!1))},render:function(t){var e=this;e.canvas=t,e.canvas.container.append(e.components.rubber),e.canvas.on({render:function(){e.setup()}}),e.canvas.rendered&&e.setup()},bbox:function(){var t=this.props;return new Graph.lang.BBox({
x:t.x,y:t.y,x2:t.x2,y2:t.y2,width:t.width,height:t.height})},collect:function(t,e){var r;t.$collector=this,t.select(),e=_.defaultTo(e,!1),r=_.indexOf(this.collection,t),r===-1&&(this.collection.push(t),e||t.fire("collect",this,t))},decollect:function(t){var e;t.$collector=null,t.deselect(),e=_.indexOf(this.collection,t),e>-1&&(this.collection.splice(e,1),t.fire("decollect",this,t))},clearCollection:function(t){var e=this;e.canvas.cascade(function(t){t!==e.canvas&&t.props.selected&&e.decollect(t)})},resume:function(){this.components.rubber.addClass("visible"),this.props.suspended=!1},suspend:function(){this.components.rubber.removeClass("visible"),this.props.suspended=!0},reset:function(){var t=this.canvas.container.scrollTop(),e=this.canvas.container.scrollLeft();this.props.x=0,this.props.y=0,this.props.x2=this.props.x,this.props.y2=this.props.y,this.props.top=t,this.props.left=e,this.props.dir=null,this.props.width=0,this.props.height=0,this.props.offset=[0,0]},translate:function(t,e){
this.props.x+=t,this.props.y+=e,this.components.rubber.css({transform:"translate("+this.props.x+"px,"+this.props.y+"px)"})},resize:function(t,e){this.components.rubber.width(t).height(e)},syncDragStart:function(t,e){var r=this;_.forEach(r.collection,function(r){r.dragger&&r.dragger.props.enabled&&r!==t&&!function(){var t=r.matrix.data(),n=t.sin,s=t.cos;r.resizer&&r.resizer.suspend(),r.dragger.components.helper&&r.dragger.resume(),r.syncdrag={sin:n,cos:s,tdx:0,tdy:0},r.addClass("dragging"),r.fire("dragstart",{dx:e.dx*s+e.dy*n,dy:e.dx*-n+e.dy*s},r)}()}),r.fire("beforedrag")},syncDragMove:function(t,e){var r=this;_.forEach(r.collection,function(r){r.dragger&&r.dragger.props.enabled&&r!==t&&!function(t,e){var r=e.ox*t.syncdrag.cos+e.oy*t.syncdrag.sin,n=e.ox*-t.syncdrag.sin+e.oy*t.syncdrag.cos;t.dragger.components.helper?t.dragger.components.helper.translate(e.ox,e.oy).apply():t.translate(r,n).apply(),t.syncdrag.tdx+=r,t.syncdrag.tdy+=n,t.fire("dragmove",{dx:r,dy:n},t)}(r,e)})},syncDragEnd:function(t,e){
var r=this;_.forEach(r.collection,function(r){r.dragger&&r.dragger.props.enabled&&r!==t&&!function(t,e){t.dragger.components.helper&&(t.translate(t.syncdrag.tdx,t.syncdrag.tdy).apply(),t.dragger.suspend()),t.resizer&&(t.resizer.resume(),t.resizer.redraw()),t.fire("dragend",{dx:t.syncdrag.tdx,dy:t.syncdrag.tdy},t),t.removeClass("dragging"),delete t.syncdrag,t.dirty=!0}(r,e)}),e.origin=t,r.fire("afterdrag",e,r)}})}(),function(){Graph.util.Connector=Graph.extend({ports:{source:null,target:null},components:{},constructor:function(){this.cached={vertices:null},this.initComponent()},initComponent:function(){var t=this,e=this.components;e.block=new Graph.svg.Group,e.block.addClass("graph-util-connector"),e.block.removeClass("graph-elem graph-elem-group"),e.wrap=e.block.append(new Graph.svg.Path("M 0 0")),e.wrap.addClass("graph-util-connector-wrap"),e.wrap.removeClass("graph-elem graph-elem-path"),e.wrap.selectable(!1),e.wrap.collectable(!1),e.wrap.elem.on({click:function(e){e.stopPropagation(),
t.select()}}),e.core=e.block.append(new Graph.svg.Path("M 0 0")),e.core.attr({"marker-end":"url(#marker-arrow)"}),e.core.addClass("graph-util-connector-core"),e.core.removeClass("graph-elem graph-elem-path"),e.core.collectable(!1),e.core.elem.on({click:function(e){e.stopPropagation(),t.select()}})},connect:function(t,e,r){var n=this,s=n.components,o=t.props.x,i=t.props.y,a=e.props.x,p=e.props.y;s.core.startAt(o,i),s.core.stopAt(a,p)},source:function(t){var e=this,r=t.props.x,n=t.props.y;return _.isUndefined(t)?e.ports.source:(e.ports.source=t,e.components.wrap.moveTo(r,n),e.components.core.moveTo(r,n),e)},target:function(t){var e=this,r=t.props.x,n=t.props.y;return _.isUndefined(t)?e.ports.target:(e.ports.target=t,e.components.wrap.closeTo(r,n),e.components.core.closeTo(r,n),e)},expand:function(t,e){var r=this;return r.components.core.expandTo(t,e),r},render:function(t){var e=this.components;e.block.rendered||e.block.render(t)},component:function(){return this.components.block},vertices:function(){
var t=this.components;return(t.core.dirty||_.isNull(this.cached.vertices))&&(this.cached.vertices=[]),this},select:function(){var t=this.components,e=t.core.pathinfo();console.log(e)}})}(),function(){Graph.util.Definer=Graph.extend({definitions:{},components:{holder:null},canvas:null,constructor:function(){var t=this;t.components.holder=Graph.$svg("defs")},render:function(t){this.canvas=t,this.canvas.elem.prepend(this.components.holder)},defineArrowMarker:function(t){if(this.definitions[t])return this.definitions[t];var e=Graph.$svg("marker");e.attr({id:t,refX:"8",refY:"4",markerWidth:"8",markerHeight:"8",orient:"auto"});var r=Graph.$svg("path");return r.attr({d:"M 0 0 L 0 8 L 8 4 L 0 0",fill:"#333","stroke-width":"0"}),e.append(r),this.definitions[t]=e,this.components.holder.append(e),e}})}(),function(){Graph.util.Hinter=Graph.extend({components:{G:null,V:null,H:null},collection:{},sources:{M:[],C:[]},targets:{M:[],C:[]},constructor:function(){var t=this.components;t.G=new Graph.svg.Group,
t.G.addClass("graph-util-hinter"),t.G.removeClass("graph-elem graph-elem-group"),t.H=new Graph.svg.Line(0,0,0,0),t.H.attr("shape-rendering","crispEdges"),t.H.removeClass("graph-elem graph-elem-line"),t.H.render(t.G),t.V=new Graph.svg.Line(0,0,0,0),t.V.attr("shape-rendering","crispEdges"),t.V.removeClass("graph-elem graph-elem-line"),t.V.render(t.G)},render:function(t){this.canvas=t,this.canvas.append(this.components.G)},suspend:function(t){this.components[t].removeClass("visible")},resume:function(t){this.components[t].addClass("visible")},register:function(t){var e=this,r=t.id(),n=t.bbox(!1,!1).data();e.collection[r]={vector:t,dirty:!1,vertices:{M:[Math.round(n.x,2),Math.round(n.y+n.height/2,2),n.width,n.height],C:[Math.round(n.x+n.width/2,2),Math.round(n.y,2),n.width,n.height]}},t.on({dragend:function(){e.collection[r].dirty=!0},resize:function(){e.collection[r].dirty=!0}})},activate:function(t){var e=this,r=t.id();if(e.canvas.elem.append(e.components.G.elem),e.collection[r].dirty){var n=t.bbox(!1,!1).data();
e.collection[r].vertices={M:[Math.round(n.x,2),Math.round(n.y+n.height/2,2),n.width,n.height],C:[Math.round(n.x+n.width/2,2),Math.round(n.y,2),n.width,n.height]},e.collection[r].dirty=!1}e.sources.M=e.collection[r].vertices.M,e.sources.C=e.collection[r].vertices.C,e.targets.M=[],e.targets.C=[],_.forEach(e.collection,function(r,n){if(r.vector!==t){if(r.dirty){var s=r.vector.bbox(!1,!1).data();r.vertices={M:[Math.round(s.x,2),Math.round(s.y+s.height/2,2),s.width,s.height],C:[Math.round(s.x+s.width/2,2),Math.round(s.y,2),s.width,s.height]},r.dirty=!1}e.targets.M.push(r.vertices.M),e.targets.C.push(r.vertices.C)}})},watch:function(t,e){var r=this;_.forEach(r.sources,function(r){r[0]+=t,r[1]+=e});var n,s,o,i,a=_.find(r.targets.M,function(t){return t[1]===r.sources.M[1]});a?(r.resume("H"),r.sources.M[0]<a[0]?(n=r.sources.M[0],o=a[0]+a[2]):(n=r.sources.M[0]+r.sources.M[2],o=a[0]),r.components.H.attr({x1:n,y1:r.sources.M[1],x2:o,y2:a[1]})):r.suspend("H");var p=_.find(r.targets.C,function(t){return t[0]===r.sources.C[0];
});p?(r.resume("V"),r.sources.C[1]<p[1]?(s=r.sources.C[1],i=p[1]+p[3]):(s=r.sources.C[1]+r.sources.C[3],i=p[1]),r.components.V.attr({x1:r.sources.C[0],y1:s,x2:p[0],y2:i})):r.suspend("V")},deactivate:function(){this.suspend("H"),this.suspend("V"),this.components.H.attr({x1:0,y1:0,x2:0,y2:0}),this.components.V.attr({x1:0,y1:0,x2:0,y2:0}),this.sources.M=[],this.sources.C=[],this.targets.M=[],this.targets.C=[]}})}(),function(){Graph.util.Link=Graph.extend({source:null,target:null,constructor:function(t,e){this.source=t,this.target=e},connect:function(t){}})}(),function(){Graph.util.Linker=Graph.extend({props:{suspended:!0,x:0,y:0},components:{block:null,point:null},ports:{source:null,target:null},constructor:function(){var t=this,e=t.components;e.block=new Graph.svg.Group,e.block.addClass("graph-util-linker"),e.block.removeClass("graph-elem graph-elem-group"),e.block.collectable(!1),e.block.selectable(!1),e.point=new Graph.svg.Ellipse(0,0,3,3),e.point.addClass("graph-util-linker-point"),e.point.removeClass("graph-elem graph-elem-ellipse"),
e.point.collectable(!1),e.point.selectable(!1),e.point.render(e.block),e.link=new Graph.svg.Path("M 0 0"),e.link.attr("marker-end","url(#marker-arrow)"),e.link.addClass("graph-util-linker-link"),e.link.removeClass("graph-elem graph-elem-path"),e.link.selectable(!1),e.link.collectable(!1),e.link.render(e.block)},component:function(){return this.components.block},pointer:function(){return this.components.point},render:function(t){this.canvas=t,this.canvas.append(this.components.block)},resume:function(){this.props.suspended=!1,this.components.block.addClass("visible")},suspend:function(){this.props.suspended=!0,this.components.block.removeClass("visible")},reset:function(){this.ports.source=null,this.ports.target=null,this.props.x=0,this.props.y=0,this.components.point.attr({cx:0,cy:0}),this.components.link.attr("d","M 0 0")},source:function(t){var e=t.props.x,r=t.props.y;this.reset(),this.ports.source=t,this.startAt(e,r)},target:function(t){var e=t.props.x,r=t.props.y;this.ports.target=t,
this.stopAt(e,r)},startAt:function(t,e){var r=this.props,n=this.components;r.x=t,r.y=e,n.point.attr({cx:t,cy:e}),n.link.startAt(t,e)},stopAt:function(t,e){var r=this.props,n=this.components;r.x=t,r.y=e,n.point.attr({cx:t,cy:e}),n.link.stopAt(t,e)},closeTo:function(t,e){},expandBy:function(t,e){var r=this.props,n=this.components;r.x+=t,r.y+=e,n.point.attr({cx:r.x,cy:r.y});var s=n.link.angle(),o=Graph.rad(s);Math.sin(o),Math.cos(o);n.link.expandBy(t,e)},revert:function(){this.ports.source=null,this.ports.target=null,this.suspend()},commit:function(){var t=this.ports.source,e=this.ports.target;if(t&&e){var r=new Graph.util.Connector;r.connect(t,e),r.render(this.canvas)}this.suspend()}})}(),function(){Graph.util.Obstacle=Graph.extend({props:{step:10,grid:100},hash:{},source:null,target:null,canvas:null,constructor:function(t,e,r,n){_.extend(this.props,n||{}),this.canvas=t,this.source=e,this.target=r},padding:function(){var t=this.props.step;return{x:t,y:t,width:-2*t,height:-2*t}},margin:function(){
var t=this.props.step;return{x:-t,y:-t,width:2*t,height:2*t}},build:function(){var t=this,e=t.props.grid,r=t.margin(),n=(t.padding(),t.canvas),s=[];t.source&&s.push(t.source.vector),t.target&&s.push(t.target.vector),_.chain(n.children().items).difference(s).map(function(t){var e;e=t.bbox(!1,!1).expand(r.x,r.y,r.width,r.height),e.snap=!0;var s=e.data();return n.rect(s.x,s.y,s.width,s.height).render().style("fill","none"),e}).reduce(function(t,r){var n,s;n=r.origin().snap(e,e),s=r.corner().snap(e,e);var o,i,a;for(o=n.props.x;o<=s.props.x;o+=e)for(i=n.props.y;i<=s.props.y;i+=e)a=o+","+i,t[a]=t[a]||[],t[a].push(r);return t},t.hash).value()},permit:function(t){var e=this,r=e.props.grid,n=t.clone().snap(r,r),s=n.toString(),o=_.every(e.hash[s],function(e){return!e.contain(t)});return o}})}(),function(){var t=0;Graph.util.Port=Graph.extend({props:{id:null,x:0,y:0,empty:!0,width:10,height:10,segment:0,weight:0},vector:null,canvas:null,network:null,components:{port:null,slot:null,core:null},snapping:{
x:0,y:0},connection:{connecting:!1,valid:!1},connectors:[],constructor:function(e,r,n){n=_.extend({id:"P"+ ++t,x:_.defaultTo(e,0),y:_.defaultTo(r,0)},n||{}),_.extend(this.props,n),this.initComponent()},initComponent:function(){var t=this,e=t.components,r=t.props;e.port=new Graph.svg.Group,e.port.addClass("graph-util-port"),e.port.removeClass("graph-elem graph-elem-group"),e.port.on({render:_.bind(t.onPortRender,t)}),e.slot=e.port.append(new Graph.svg.Ellipse(r.x,r.y,r.width,r.height)),e.slot.elem.data("port",t),e.slot.addClass("graph-util-port-slot"),e.slot.removeClass("graph-elem graph-elem-ellipse"),e.slot.elem.on({click:function(e){t.fire("click",e,t),e.stopPropagation()}}),e.core=e.port.append(new Graph.svg.Ellipse(r.x,r.y,2,2)),e.core.addClass("graph-util-port-core"),e.core.removeClass("graph-elem graph-elem-ellipse"),e.core.attr({"pointer-events":"none"}),e.core.elem.on({click:function(t){t.stopPropagation()}});for(var n in e)e[n].selectable(!1),e[n].collectable(!1)},component:function(){
return this.components.port},render:function(){var t=this.network;this.canvas=t.canvas,this.components.port.render(t.components.block)},data:function(t,e){return _.isPlainObject(t)?(_.extend(this.props,t),this):_.isUndefined(t)&&_.isUndefined(e)?this.props:_.isUndefined(e)?this.props[t]:(this.props[t]=e,this)},x:function(t){return _.isUndefined(t)?this.props.x:(this.props.y=t,this)},y:function(t){return _.isUndefined(t)?this.props.y:(this.props.y=t,this)},location:function(){return new Graph.lang.Point(this.props.x,this.props.y)},offset:function(){var t={left:this.props.x,top:this.props.y},e=this.canvas.elem.position();return t.left+=e.left,t.top+=e.top,t},position:function(){var t=this.components.slot.position();return{left:t.left+this.props.width,top:t.top+this.props.height}},setup:function(){var t=this,e=t.components,r=(t.props,t.canvas.linker);t.draggable||(t.draggable=interact(e.slot.node()).draggable({manualStart:!0,inertia:!1,snap:{targets:[interact.createSnapGrid({x:1,y:1})]},onstart:function(e){
r.source(t),t.connection.connecting=!0,t.draggable.setOptions("snap",{targets:[interact.createSnapGrid({x:1,y:1})]})},onmove:function(t){r.expandBy(t.dx,t.dy)},onend:function(t){}}),t.draggable.styleCursor(!1),t.draggable.on({move:function(t){var n=t.interaction;n.pointerIsDown&&!n.interacting()&&t.currentTarget===e.slot.node()&&(r.resume(),n.start({name:"drag"},t.interactable,r.pointer().node()))}}),t.droppable=interact(e.slot.node()).dropzone({overlap:.2,accept:".graph-util-linker-point"}),t.droppable.on({dropactivate:_.bind(t.onLinkerActivate,t),dropdeactivate:_.bind(t.onLinkerDeactivate,t),dragenter:_.bind(t.onLinkerEnter,t),dragleave:_.bind(t.onLinkerLeave,t),drop:_.bind(t.onLinkerDrop,t)}))},translate:function(t,e){var r=this.components;this.props.x+=t,this.props.y+=e,r.core.attr({cx:this.props.x,cy:this.props.y}),r.slot.attr({cx:this.props.x,cy:this.props.y})},relocate:function(t,e){this.props.x=0,this.props.y=0,this.translate(t,e)},transform:function(t){var e=this.props.x,r=this.props.y,n=t.x(e,r),s=t.y(e,r);
this.props.x=0,this.props.y=0,this.translate(n,s)},onPortRender:function(){this.setup()},onLinkerActivate:function(t){},onLinkerDeactivate:function(t){var e=Graph.$(t.target).data("port");e.components.port.removeClass("drop-active")},onLinkerEnter:function(t){var e,r=this,n=r.snapping,s=r.canvas.linker;s.ports.source!==r&&(e=r.offset(),n.x=e.left,n.y=e.top,n.range=1/0,t.draggable.setOptions("snap",{targets:[n],endOnly:!0}),r.connection.valid=!0,r.components.port.addClass("drop-enter"))},onLinkerLeave:function(t){var e=this,r=e.canvas.linker;r.ports.source!==e&&(e.components.port.removeClass("drop-enter"),e.connection.valid=!1)},onLinkerDrop:function(t){var e=this,r=e.canvas.linker;r.ports.source!==e&&(r.target(e),r.commit(),e.components.port.removeClass("drop-enter"),e.connection.connecting=!1)}})}(),function(){Graph.util.Router=Graph.extend({props:{type:"manhattan",step:10},components:{},constructor:function(t){this.props.type=t||"manhattan",this.initComponent()},initComponent:function(){
var t=this.components;t.block=new Graph.svg.Group,t.block.addClass("graph-util-router"),t.block.removeClass("graph-elem graph-elem-group"),t.block.props.selectable=!1,t.block.props.collectable=!1},type:function(t){return _.isUndefined(t)?this.props.type:(this.props.type=t,this)},render:function(t){this.canvas=t,this.canvas.append(this.components.block)}})}(),function(){Graph.util.Spotlight=Graph.extend({props:{suspended:!0},components:{G:null,N:null,E:null,S:null,W:null},canvas:null,constructor:function(){var t=this,e=t.components;e.G=new Graph.svg.Group,e.G.collectable(!1),e.G.selectable(!1),e.G.addClass("graph-util-spotlight"),e.G.removeClass("graph-elem graph-elem-group"),_.forEach(["N","E","S","W"],function(t){e[t]=new Graph.svg.Line(0,0,0,0),e[t].removeClass("graph-elem graph-elem-line"),e[t].collectable(!1),e[t].selectable(!1),e[t].attr("shape-rendering","crispEdges"),e[t].render(e.G)})},component:function(){return this.components.G},render:function(t){this.canvas=t,this.canvas.append(this.components.G);
},suspend:function(){this.props.suspended=!0,this.components.G.removeClass("visible")},resume:function(){this.props.suspended=!1,this.components.G.addClass("visible")},focus:function(t,e){if(!e)return void this.suspend();var r,n,s,o,i=t.bbox(!1,!1).data(),a=t.dots(!0),p=t.canvas,h=this.components;r=a[0][0],n=a[0][1],s=p.attrs.height,o=p.attrs.width,this.resume(),h.W.attr({x1:r,y1:0,x2:r,y2:s}),h.E.attr({x1:r+i.width,y1:0,x2:r+i.width,y2:s}),h.N.attr({x1:0,y1:n,x2:o,y2:n}),h.S.attr({x1:0,y1:n+i.height,x2:o,y2:n+i.height})}})}(),function(){Graph.plugin.Animator=Graph.extend({constructor:function(t){this.vector=t}})}(),function(){Graph.plugin.Dragger=Graph.extend({props:{enabled:!0,suspended:!1,inertia:!1,ghost:!1,bound:!1,grid:[10,10],axis:!1,hint:!1},rotate:{deg:0,rad:0,sin:0,cos:1},snaps:[],trans:{dx:0,dy:0},vector:null,canvas:null,components:{holder:null,helper:null},constructor:function(t,e){var r=this;r.vector=t,r.vector.addClass("graph-draggable"),e=_.extend({enabled:!0,inertia:!1},e||{}),
_.forEach(["axis","grid","bbox","ghost","hint"],function(t){_.isUndefined(e[t])||(r.props[t]=e[t])}),_.extend(r.props,e),r.vector.rendered?r.setup():r.vector.on({transform:_.bind(r.onVectorTransform,r),render:_.bind(r.onVectorRender,r),reset:_.bind(r.onVectorReset,r)})},setup:function(){var t=this,e=t.vector.paper(),r={};t.plugin||(t.canvas=e,e.scroller,t.props.hint&&e.hinter&&e.hinter.register(t.vector),_.extend(r,{manualStart:!!t.props.ghost,onstart:_.bind(t.onDragStart,t),onmove:_.bind(t.onDragMove,t),onend:_.bind(t.onDragEnd,t)}),t.plugin=interact(t.vector.node()).draggable(r),t.plugin.styleCursor(!1),t.plugin.on({down:_.bind(t.onPointerDown,t),move:_.bind(t.onPointerMove,t)}),t.dragRotate(t.vector.props.rotate),t.dragSnap({mode:"grid",x:t.props.grid[0],y:t.props.grid[1]}),t.plugin.draggable(t.props.enabled),t.render(),t.suspend())},enable:function(){this.props.enabled=!0,this.plugin&&this.plugin.draggable(!0)},disable:function(){this.props.enabled=!1,this.plugin&&this.plugin.draggable(!1);
},suspend:function(){this.props.suspended=!0,this.components.holder&&this.components.holder.removeClass("visible")},resume:function(){this.props.suspended=!1,this.components.holder&&this.components.holder.addClass("visible")},render:function(){var t=this.canvas,e=this.components;this.props.ghost&&(e.holder||(e.holder=t.group(),e.holder.props.collectable=!1,e.holder.props.selectable=!1,e.holder.addClass("graph-dragger").removeClass("graph-elem graph-elem-group"),this.vector.parent().append(e.holder)),e.helper||(e.helper=t.rect(0,0,0,0),e.helper.addClass("graph-dragger-helper").removeClass("graph-elem graph-elem-rect"),e.helper.props.collectable=!1,e.helper.props.selectable=!1,e.holder.append(e.helper),e.helper.attr({fill:"transparent",stroke:"#333","stroke-width":1,"stroke-dasharray":"4 3"}))),this.redraw()},redraw:function(){var t=this.components;if(this.resume(),t.helper){var e=this.vector.bbox(!1,!1).data(),r=t.helper.bbox(!1,!1).data(),n=e.x-r.x,s=e.y-r.y;t.helper.translate(n,s).apply(),
t.helper.attr({width:e.width,height:e.height})}},dragRotate:function(t){var e=Graph.rad(t);this.rotate.deg=t,this.rotate.rad=e,this.rotate.sin=Math.sin(e),this.rotate.cos=Math.cos(e)},dragSnap:function(t){function e(t){return t.mode=_.defaultTo(t.mode,"anchor"),"grid"==t.mode?("x"==r.props.axis?t.y=0:"y"==r.props.axis&&(t.x=0),t=interact.createSnapGrid({x:t.x,y:t.y})):"anchor"==t.mode&&(t.range=_.defaultTo(t.range,20)),t}var r=this,n=r.snaps;_.isArray(t)?_.forEach(t,function(t){n.unshift(e(t))}):n.push(e(t)),this.plugin&&this.plugin.setOptions("snap",{targets:n})},resetSnap:function(){this.snaps=[],this.dragSnap({mode:"grid",x:this.props.grid[0],y:this.props.grid[1]})},dragBound:function(t){},onVectorRender:function(){this.setup()},onVectorTransform:function(t){t.rotate&&this.dragRotate(this.rotate.deg+t.rotate.deg)},onVectorReset:function(){this.dragRotate(0)},onPointerDown:function(t){this.fire("pointerdown",t,this)},onPointerMove:function(t){var e=t.interaction;this.props.ghost&&e.pointerIsDown&&!e.interacting()&&t.currentTarget===this.vector.node()&&(this.props.suspended&&(this.resume(),
this.redraw()),e.start({name:"drag"},t.interactable,this.components.helper.node()))},onDragStart:function(t){this.vector.addClass("dragging"),this.trans.dx=0,this.trans.dy=0;var e={dx:0,dy:0,ghost:this.props.ghost};this.props.hint&&this.canvas.hinter&&this.canvas.hinter.activate(this.vector),this.fire("dragstart",e,this)},onDragMove:function(t){var e,r,n,s,o,i,a=this.props.axis,p=(this.rotate.deg,this.rotate.sin),h=this.rotate.cos;e=r=n=s=o=i=0,"x"==a?(e=n=t.dx,r=s=0,o=t.dx*h+0*p,i=t.dx*-p+0*h):"y"==a?(e=n=0,r=s=t.dy,o=0*h+t.dy*p,i=0*-p+t.dy*h):(n=t.dx,s=t.dy,e=o=t.dx*h+t.dy*p,r=i=t.dx*-p+t.dy*h),this.trans.dx+=o,this.trans.dy+=i,this.props.hint&&this.canvas.hinter&&this.canvas.hinter.watch(e,r),this.components.helper?this.components.helper.translate(n,s).apply():this.vector.translate(e,r).apply();var c={pageX:_.defaultTo(t.pageX,t.x0),pageY:_.defaultTo(t.pageY,t.y0),dx:e,dy:r,ox:n,oy:s,ghost:this.props.ghost};this.fire("dragmove",c,this)},onDragEnd:function(t){var e=this.trans.dx,r=this.trans.dy;
this.props.hint&&this.canvas.hinter&&this.canvas.hinter.deactivate(),this.components.helper&&(this.vector.translate(e,r).apply(),this.redraw(),this.suspend()),this.vector.removeClass("dragging");var n={dx:e,dy:r,ghost:this.props.ghost};this.fire("dragend",n,this),this.trans.dx=0,this.trans.dy=0}})}(),function(){Graph.plugin.Dropper=Graph.extend({props:{overlap:"center",accept:".graph-draggable"},config:{},constructor:function(t,e){var r=this;r.vector=t,r.vector.addClass("graph-dropzone").removeClass("graph-draggable"),e=e||{},_.forEach(["accept","overlap"],function(t){r.props[t]=e[t],delete e[t]}),r.config=_.extend({},e),r.vector.on({render:_.bind(r.onVectorRender,r)}),r.vector.rendered&&r.setup()},setup:function(){var t=this;t.plugin||(t.plugin=interact(t.vector.node()).dropzone({checker:_.bind(t.onDropValidate,t),ondropactivate:_.bind(t.onDropActivate,t),ondropdeactivate:_.bind(t.onDropDeactivate,t),ondragenter:_.bind(t.onDragEnter,t),ondragleave:_.bind(t.onDragLeave,t),ondrop:_.bind(t.onDrop,t)
}))},onDropValidate:function(t,e,r,n,s,o,i){return!0},onVectorRender:function(){this.setup()},onDropActivate:function(t){this.vector.addClass("activate")},onDropDeactivate:function(t){this.vector.removeClass("activate")},onDragEnter:function(t){this.vector.removeClass("activate").addClass("enter")},onDragLeave:function(t){this.vector.removeClass("enter").addClass("activate")},onDrop:function(t){this.vector.removeClass("activate enter leave")}})}(),function(){Graph.plugin.History=Graph.extend({props:{limit:1,index:0},items:{},constructor:function(t){this.vector=t},save:function(t,e){var r,n=this.props.limit;r>n&&_.drop(this.items,r-n),this.items[t]=this.items[t]||[],(r=this.items[t].length)>n-1&&this.items[t].splice(0,r-n),this.items[t].push(e),console.log(this)},last:function(t){},go:function(){},back:function(){},next:function(){},clear:function(){}})}(),function(){Graph.plugin.Network=Graph.extend({props:{segments:4},cached:{vertices:null},components:{block:null},ports:[],vector:null,
canvas:null,rendered:!1,dragging:!1,constructor:function(t,e){var r,n=this;_.extend(n.props,e||{}),n.vector=t,n.vector.addClass("graph-linkable"),n.initComponent(),n.vector.on({render:function(){r=_.delay(function(){clearTimeout(r),n.render()},0)}}),n.vector.rendered&&(r=_.delay(function(){clearTimeout(r),n.render()},0))},initComponent:function(){var t=this,e=t.components;e.block=new Graph.svg.Group,e.block.selectable(!1),e.block.collectable(!1),e.block.addClass("graph-network"),e.block.removeClass("graph-elem graph-elem-group");var r=t.vertices();_.forEach(r,function(e,r){var n=t.createPort(e);t.ports.push(n)})},createPort:function(t){var e=this.vector.ctm(),r=e.x(t.props.x,t.props.y),n=e.y(t.props.x,t.props.y),s=new Graph.util.Port(r,n);return s.props.weight=t.weight,s.props.segment=t.segment,s.network=this,s.vector=this.vector,s},render:function(){var t=this,e=t.components,r=t.vector,n=t.vector.paper();t.rendered||(t.rendered=!0,t.canvas=n,e.block.render(n),_.forEach(t.ports,function(t){
t.render()}),r.elem.on({mouseenter:function(e){t.resume()},mouseleave:function(e){var r=Graph.$(e.relatedTarget),n=r.hasClass("graph-util-port")||r.hasClass("graph-util-port-slot")||r.hasClass("graph-util-pointer")||r.hasClass("graph-util-connector-marker");n||t.vector.props.selected||t.suspend(),r=null}}),r.on({dragstart:_.bind(t.onVectorDragStart,t),dragend:_.bind(t.onVectorDragEnd,t),select:_.bind(t.onVectorSelect,t),deselect:_.bind(t.onVectorDeselect,t),resize:_.bind(t.onVectorResize,t)}),n.on("click",function(e){var r=Graph.$(e.target);r.hasClass("graph-linkable")||(t.suspend(),r=null)}))},vertices:function(){var t,e,r,n,s=this,o=s.vector,i=(s.vector.ctm(),[]);if(s.vector.dirty||_.isNull(s.cached.vertices)){switch(t=o.pathinfo().transform(o.matrix),s.vector.type){case"ellipse":case"circle":e=t.length(),r=e/8,n=Graph.point(t.segments[1][1],t.segments[1][2]),n.segment=0,n.weight=0,i.push(n);for(var a=r;a<=e-r;a+=r)n=t.pointAt(a),n.segment=0,n.weight=a/e,i.push(n);break;default:_.forEach(t.segments,function(t,e){
var r,n,o,a,p;if("M"!=t[0])for(r=Graph.curve([t]),n=r.length(),o=n/s.props.segments,p=o;p<=n;p+=o)a=r.pointAt(p,r.t(p)),a.segment=e,a.weight=p/n,i.push(a)})}this.cached.vertices=i}return this.cached.vertices},component:function(){return this.components.block},suspend:function(){this.components.block&&this.components.block.removeClass("visible")},resume:function(){this.dragging||this.vector.props.selected||this.components.block&&this.components.block.addClass("visible")},port:function(t){return this.ports[t]},onVectorDragStart:function(){this.dragging=!0,this.suspend()},onVectorDragEnd:function(t){var e,r,n,s,o,i=this,a=this.vector.props.rotate;a?(e=Graph.rad(-a),r=Math.sin(e),n=Math.cos(e),s=t.dx*n+t.dy*r,o=t.dx*-r+t.dy*n):(s=t.dx,o=t.dy),_.forEach(i.ports,function(t){t.translate(s,o)}),i.dragging=!1,i.resume()},onVectorSelect:function(){this.suspend()},onVectorDeselect:function(){},onVectorResize:function(t){var e,r,n,s,o,i,o,a,p=this,a=p.vector.pathinfo().transform(p.vector.ctm());switch(p.vector.type){
case"ellipse":case"circle":o=a.length(),_.forEach(p.ports,function(t){r=t.props.weight*o,i=a.pointAt(r),i&&(t.relocate(i.props.x,i.props.y),i=null)});break;default:_.forEach(p.ports,function(t){n=a.segments[t.props.segment],n&&(t.props.segment===e&&s||(s=Graph.curve([n]),o=s.length()),r=o*t.props.weight,i=s.pointAt(r,s.t(r)),i&&(t.relocate(i.props.x,i.props.y),i=null)),e=t.props.segment})}s=null}})}(),function(){Graph.plugin.Resizer=Graph.extend({props:{snap:[1,1],suspended:!0,handlePath:Graph.config.base+"img/resize-control.png",handleSize:17},components:{holder:null,helper:null,handle:{}},trans:{ox:0,oy:0,ow:0,oh:0,cw:0,ch:0,dx:0,dy:0},constructor:function(t){var e=this;e.vector=t,e.vector.addClass("graph-resizable"),e.props.handlePath=Graph.config.base+"img/resize-control.png",e.props.handleSize=17,e.cached={vertices:null},e.vector.on({select:function(){e.components.holder?e.resume():(e.render(),e.resume())},deselect:function(){e.props.suspended||e.suspend()},dragstart:function(t,r){
e.suspend()},dragend:function(t,r){e.resume(),r.props.selected?e.redraw():(e.redraw(),e.suspend())}})},render:function(){var t=this,e=t.components,r=t.vector.paper();if(e.holder)return void t.redraw();e.holder=r.group(),e.holder.addClass("graph-resizer").removeClass("graph-elem graph-elem-group"),e.holder.props.collectable=!1,e.holder.props.selectable=!1,t.vector.parent().append(e.holder),e.helper=r.rect(0,0,0,0),e.helper.addClass("graph-resizer-helper").removeClass("graph-elem graph-elem-rect"),e.helper.props.collectable=!1,e.helper.props.selectable=!1,e.holder.append(e.helper),t.handle={};var n=t.props.snap,s={ne:{snap:n},se:{snap:n},sw:{snap:n},nw:{snap:n},n:{snap:n,axis:"y"},e:{snap:n,axis:"x"},s:{snap:n,axis:"y"},w:{snap:n,axis:"x"}};_.forOwn(s,function(n,s){!function(s){e.handle[s]=r.image(t.props.handlePath,0,0,t.props.handleSize,t.props.handleSize),e.handle[s].props.collectable=!1,e.handle[s].props.selectable=!1,e.handle[s].props.dir=s,e.handle[s].removeClass("graph-elem graph-elem-image"),
e.handle[s].addClass("graph-resizer-handle handle-"+s),e.handle[s].draggable(n).on("pointerdown",function(t){t.stopImmediatePropagation()}),e.handle[s].on("dragstart",_.bind(t.onHandleMoveStart,t)),e.handle[s].on("dragmove",_.bind(t.onHandleMove,t)),e.handle[s].on("dragend",_.bind(t.onHandleMoveEnd,t)),e.holder.append(e.handle[s])}(s)}),t.redraw()},grid:function(t,e){this.props.snap=[t,e]},vertices:function(){var t,e,r,n,s,o,i,a,p,h=this,c=h.cached.vertices;if(this.vector.dirty||!c){t=h.vector.matrix.clone(),r=h.vector.bbox(!0,!1).data(),o=h.vector.pathinfo().transform(t),s=t.data().rotate,a=r.x+r.width/2,p=r.y+r.height/2,e=Graph.matrix(),e.rotate(-s,a,p),i=o.transform(e),n=i.bbox().data();var l=n.x,u=n.y,d=n.width,f=n.height,g=d/2,v=f/2,m=h.props.handleSize/2;c={ne:{x:l+d-m,y:u-m},se:{x:l+d-m,y:u+f-m},sw:{x:l-m,y:u+f-m},nw:{x:l-m,y:u-m},n:{x:l+g-m,y:u-m},e:{x:l+d-m,y:u+v-m},s:{x:l+g-m,y:u+f-m},w:{x:l-m,y:u+v-m},rotate:{deg:s,cx:a,cy:p},box:{x:l,y:u,width:d,height:f},offset:{x:r.x,y:r.y
}},h.cached.vertices=c}return c},redraw:function(){var t,e=this,r=e.components;r.holder&&(t=this.vertices(),r.helper.reset(),r.helper.attr({x:t.box.x,y:t.box.y,width:t.box.width,height:t.box.height}),r.helper.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).apply(),_.forOwn(r.handle,function(e,r){!function(e,r){e.show(),e.reset(),e.attr(t[r]),e.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).apply()}(e,r)}),e.trans.ox=t.offset.x,e.trans.oy=t.offset.y,e.trans.ow=this.trans.cw=t.box.width,e.trans.oh=this.trans.ch=t.box.height,e.trans.dx=0,e.trans.dy=0)},suspend:function(){this.props.suspended=!0,this.components.holder&&this.components.holder.removeClass("visible")},resume:function(){this.props.suspended=!1,this.components.holder&&this.components.holder.addClass("visible")},onHandleMoveStart:function(t,e){var r=this;_.forOwn(r.components.handle,function(t,r){t!==e&&t.hide()}),e.show(),e.removeClass("dragging")},onHandleMove:function(t,e){var r=this,n=this.trans,s=_.defaultTo(t.dx,0),o=_.defaultTo(t.dy,0);
switch(e.props.dir){case"ne":n.cw+=s,n.ch-=o,r.trans.dy+=o,r.components.helper.translate(0,o).apply();break;case"se":n.cw+=s,n.ch+=o;break;case"sw":n.cw-=s,n.ch+=o,r.trans.dx+=s,r.components.helper.translate(s,0).apply();break;case"nw":n.cw-=s,n.ch-=o,r.trans.dx+=s,r.trans.dy+=o,r.components.helper.translate(s,o).apply();break;case"n":n.cw+=0,n.ch-=o,r.trans.dy+=o,r.components.helper.translate(0,o).apply();break;case"e":n.cw+=s,n.ch+=0;break;case"s":n.cw+=0,n.ch+=o;break;case"w":n.cw-=s,n.ch+=0,r.trans.dx+=s,r.components.helper.translate(s,0).apply()}r.components.helper.attr({width:n.cw,height:n.ch})},onHandleMoveEnd:function(t,e){var r,n,s,o,i,a,p=this,h=this.trans;switch(r=h.ow>0?h.cw/h.ow:1,n=h.oh>0?h.ch/h.oh:1,i=h.dx,a=h.dy,e.props.dir){case"ne":s=h.ox,o=h.oy+h.oh;break;case"se":s=h.ox,o=h.oy;break;case"sw":s=h.ox+h.ow,o=h.oy;break;case"nw":s=h.ox+h.ow,o=h.oy+h.oh;break;case"n":s=h.ox+h.ow/2,o=h.oy+h.oh;break;case"e":s=h.ox,o=h.oy+h.oh/2;break;case"s":s=h.ox+h.ow/2,o=h.oy;break;case"w":
s=h.ox+h.ow,o=h.oy+h.oh/2}var c=p.vector.resize(r,n,s,o,i,a);p.redraw(),p.fire("resize",c,p)}})}(),function(){Graph.plugin.Sorter=Graph.extend({props:{height:0,width:0,suspended:!0,enabled:!0,offsetTop:0,offsetLeft:0},sortables:[],origins:[],guests:[],batch:[],helper:null,trans:{sorting:!1,valid:!1,drag:null,drop:null},components:{helper:null},constructor:function(t){var e=this;e.vector=t,e.vector.addClass("graph-sorter"),e.components.helper=new Graph.svg.Rect(0,0,0,0),e.components.helper.addClass("graph-sorter-helper"),e.components.helper.removeClass("graph-elem graph-elem-rect"),e.components.helper.props.selectable=!1,e.components.helper.render(e.vector),e.components.helper.$sorter=e,e.sortables.push(e.components.helper),e.vector.on({render:_.bind(e.onVectorRender,e),appendchild:_.bind(e.onItemAdded,e),prependchild:_.bind(e.onItemAdded,e)}),e.vector.rendered&&e.setup()},setup:function(){var t=this,e=t.vector,r=e.paper(),n=e.node();t.plugin||(t.plugin=interact(".graph-sortable",{context:n
}).dropzone({accept:".graph-sortable",overlap:.1,ondropactivate:_.bind(t.onSortActivate,t),ondropdeactivate:_.bind(t.onSortDeactivate,t),ondragenter:_.bind(t.onSortEnter,t),ondragleave:_.bind(t.onSortLeave,t),ondrop:_.bind(t.onSort,t)}),t.plugin.styleCursor(!1),r.collector&&r.collector.on({afterdrag:function(e){var r=e.origin;_.indexOf(t.sortables,r)>-1&&(t.props.offsetTop+=e.dy)}}))},snapping:function(t,e,r,n,s,o,i){return r},suspend:function(){this.props.suspended=!0,this.components.helper&&(this.components.helper.focus(!1),this.components.helper.removeClass("visible"))},resume:function(){var t=this;t.props.suspended=!1,t.components.helper&&t.components.helper.addClass("visible")},redraw:function(){var t=this;t.trans.valid&&(t.props.suspended&&t.resume(),t.swap(t.components.helper,t.trans.drop),t.components.helper.focus())},commit:function(){var t=this;_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$master=!1,t.$sorter=null,t.$sorting=!1;
}),t.components.helper.attr("height",0),t.batch.length?t.permute():t.swap(t.trans.drag,t.components.helper),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.reset(),t.suspend(),t.resumeBatch(t.batch)},revert:function(){var t=this;_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$sorting=!1,t.$sorter=null,t.$master=!1}),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend(),t.resumeBatch(t.batch)},permute:function(){var t=this,e=_.indexOf(t.sortables,t.components.helper),r=_.map(t.sortables,function(t,e){return e});t.batch.sort(function(t,e){var r=t.offset().top,n=e.offset().top;return r===n?0:r<n?-1:1}),orders=_.map(t.batch,function(e){return _.indexOf(t.sortables,e)});var n=_.difference(r,orders),s=_.indexOf(n,e);_.insert(n,s,orders),t.sortables=_.permute(t.sortables,n),
t.arrange()},swap:function(t,e){var r=this,n=_.indexOf(r.sortables,t),s=_.indexOf(r.sortables,e);_.move(r.sortables,n,s),r.arrange()},arrange:function(){var t=this;t.props.height=0,t.props.width=0,_.forEach(t.sortables,function(e){if(!e.$sorting){var r=e.bbox(!1,!1).data(),n=t.props.height-r.y+t.props.offsetTop;e.translate(0,n).apply(),t.props.height+=r.height,r.width>t.props.width&&(t.props.width=r.width)}})},suspendBatch:function(t,e){_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.suspend()}),e&&e.call(t,t)})},resumeBatch:function(t){var e;e=_.delay(function(){clearTimeout(e),_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.resume()})})},0)},reset:function(){this.guests=[],this.origins=[],this.trans.drag=null,this.trans.sorting=!1,this.trans.valid=!1,this.trans.drop=null},enroll:function(t){var e,r=this;_.indexOf(r.sortables,t)===-1&&(e=t.$sorter,e.release(t),_.indexOf(r.origins,e)===-1&&r.origins.push(e),t.$sorter=r,
t.$master&&(r.trans.drag=t),t.off(".sorter"),t.tree.parent=r.vector,r.vector.children().push(t),r.guests.push(t))},release:function(t){var e,r=this,n=t.$sorter||r;t.off(".sorter"),t.$sorter=null,t.tree.parent=null,t.$master&&(n.trans.drag=null),n.vector.children().pull(t),(e=_.indexOf(n.sortables,t))>-1&&n.sortables.splice(e,1),(e=_.indexOf(n.batch,t))>-1&&n.batch.splice(e,1),(e=_.indexOf(n.guests,t))>-1&&n.guests.splice(e,1)},onVectorRender:function(){var t=this;t.vector.paper();t.setup()},onItemAdded:function(t){var e,r=this;_.indexOf(r.sortables,t)>-1||t.hasClass("graph-sorter-helper")||(t.$sorter=this,t.addClass("graph-sortable"),t.off(".sorter"),t.on("render.sorter",_.bind(r.onItemRender,r)),t.on("resize.sorter",_.bind(r.onItemResize,r)),t.on("dragstart.sorter",_.bind(r.onItemDragStart,r)),t.on("dragend.sorter",_.bind(r.onItemDragEnd,r)),t.on("collect.sorter",_.bind(r.onItemCollect,r)),t.on("decollect.sorter",_.bind(r.onItemDecollect,r)),r.sortables.push(t),t.rendered&&!t.$sorting&&(e=_.delay(function(){
clearTimeout(e),r.arrange()},0)))},onItemRender:function(t){var e,r=this;e=_.delay(function(){clearTimeout(e),r.arrange()},0)},onItemResize:function(t,e){function r(t,e){t.cascade(function(t){if(t.props.selected&&t.resizer){var r=e?"suspend":"resume";t.resizer[r].call(t.resizer)}})}var n,s=e.$sorter||this;r(e,!0),_.forEach(s.sortables,function(r){r!==e&&r.fire("resize.sortable",t,r)}),n=_.defer(function(t){clearTimeout(n),s.arrange(),r(t,!1)},e)},onItemDragStart:function(t,e){var r,n=this,s=n.batch.length;n.props.enabled=!s||s+1!==n.sortables.length,n.props.enabled&&(e.$sorter=n,e.$master=!0,e.$sorting=!0,n.trans.drag=e,n.trans.sorting=!0,r=e.bbox(!1,!1).data(),width=n.props.width,height=r.height,s&&(e.$collector?(height=0,n.suspendBatch(n.batch,function(t){var e=t.bbox(!1,!1).data();height+=e.height,t.$sorter=n,t.$sorting=!0})):(n.batch.pop().$collector.clearCollection(),n.batch=[])),n.components.helper.attr({width:width,height:height}))},onItemDragEnd:function(t,e){var r=this;r.props.enabled&&(r.trans.sorting?r.trans.valid||r.revert():r.revert());
},onItemCollect:function(t,e){var r=e.$sorter||this;r.batch.push(e)},onItemDecollect:function(t,e){var r,n=e.$sorter||this;r=_.indexOf(n.batch,e),r>-1&&n.batch.splice(r,1)},onSortActivate:function(){},onSortDeactivate:function(){},onSortEnter:function(t){var e,r,n,s,o,i=this;i.props.enabled&&(e=Graph.get(t.relatedTarget),r=Graph.get(t.target),e.$collector?(o=0,s=i.props.width,_.forEach(e.$collector.collection,function(t){var e;t.$sorter&&(t.$sorter!==i&&(i.enroll(t),i.batch.push(t)),e=t.bbox(!1,!1).data(),o+=e.height,e.width>s&&(s=e.width))}),i.components.helper.attr({width:s,height:o})):e.$sorter&&e.$sorter!==i&&(i.batch.length&&i.suspendBatch(i.batch),i.enroll(e),n=e.bbox(!1,!1).data(),o=n.height,s=i.props.width,i.components.helper.attr({width:s,height:o})),i.trans.drop=r,i.trans.valid=!0,i.redraw())},onSortLeave:function(){var t=this;t.props.enabled&&(t.trans.drop=null,t.trans.valid=!1,t.suspend())},onSort:function(){var t=this;t.props.enabled&&t.commit()}})}(),function(){Graph.plugin.Transformer=Graph.extend({
constructor:function(t){this.actions=[],this.vector=t},transform:function(t){var e=this,r=Graph.cmd2transform(t);return _.forEach(r,function(t){var r=t.shift();e[r]&&_.isFunction(e[r])&&!function(){e[r].apply(e,t)}(r,t)}),this},queue:function(){var t=_.toArray(arguments);return this.actions.push({name:t.shift(),args:t,sort:this.actions.length}),this},translate:function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.queue("translate",t,e),this},rotate:function(t,e,r){return _.isUndefined(e)||_.isUndefined(r)?this.queue("rotate",t):this.queue("rotate",t,e,r),this},scale:function(t,e,r,n){return e=_.defaultTo(e,t),_.isUndefined(r)||_.isUndefined(n)?this.queue("scale",t,e):this.queue("scale",t,e,r,n),this},matrix:function(t,e,r,n,s,o){return this.queue("matrix",t,e,r,n,s,o),this},apply:function(t){var e=this,r=this.actions,n={translate:!1,rotate:!1,scale:!1};if(r.length){t=_.defaultTo(t,!1);var s=0,o=1,i=1,a=this.vector.matrix.clone();_.forEach(r,function(r){var p=r.args,h=r.name,c=p.length,l=!1;
t&&(l=a.invert(!0));var u,d,f,g,v;"translate"==h&&2===c?(t?(u=l.x(0,0),d=l.y(0,0),f=l.x(p[0],p[1]),g=l.y(p[0],p[1]),a.translate(f-u,g-d)):a.translate(p[0],p[1]),n.translate=!0):"rotate"==h?(1==c?(v=v||e.vector.bbox(!0,!1).data(),a.rotate(p[0],v.x+v.width/2,v.y+v.height/2),s+=p[0]):3==c&&(t?(f=l.x(p[1],p[2]),g=l.y(p[1],p[2]),a.rotate(p[0],f,g)):a.rotate(p[0],p[1],p[2]),s+=p[0]),n.rotate=!0):"scale"==h?(1===c||2===c?(v=v||e.vector.bbox(!0,!1).data(),a.scale(p[0],p[c-1],v.x+v.width/2,v.y+v.height/2),o*=p[0],i*=p[c-1]):4===c&&(t?(f=l.x(p[2],p[3]),g=l.y(p[2],p[3]),a.scale(p[0],p[1],f,g)):a.scale(p[0],p[1],p[2],p[3]),o*=p[0],i*=p[1]),n.scale=!0):"matrix"==h&&a.multiply(p[0],p[1],p[2],p[3],p[4],p[5])}),this.vector.matrix=a,this.vector.attr("transform",a),n.translate&&(n.translate={dx:a.e,dy:a.f}),n.rotate&&(n.rotate={deg:s}),n.scale&&(n.scale={sx:o,sy:i}),this.fire("transform",n,this),this.actions=[]}}})}(),function(){var t=0;Graph.shape.Base=Graph.extend({props:{},page:null,ports:[],rendered:!1,
connectors:[],components:{},tree:{parent:null,children:null},events:{render:!0,resize:!0,rotate:!0},constructor:function(e){var r=this;r.props.id="graph-shape-"+ ++t,_.extend(r.props,e||{}),r.tree.children=new Graph.collection.Shape,r.initComponent(),r.components.group?r.components.group.on("render",function(){r.rendered=!0,r.fire("render",r)}):console.warn("Component group is required!")},id:function(){return this.props.id},initComponent:function(){},parent:function(){return this.tree.parent},children:function(){return this.tree.children},render:function(t,e){var r,n=this,s=this.components;if(s.group)switch(t=_.defaultTo(t,n.page),e=_.defaultTo(e,"append"),t.canvas?(n.page=t,r=t.canvas):(n.page=t.page,r=t.components.group),n.tree.parent=t,e){case"append":t.children().push(n),r.append(s.group);break;case"prepend":t.children().unshift(n),r.prepend(s.group)}return n},append:function(t){return t.render(this,"append"),t},prepend:function(t){return t.render(this,"prepend"),t},data:function(t,e){
var r=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){r.data(e,t)}),this):_.isUndefined(t)&&_.isUndefined(e)?this.props:_.isUndefined(e)?this.props[t]:(this.props[t]=e,this)},text:function(){return this.components.text?this.components.text.props.text:""},isPage:function(){return!1}})}(),function(){Graph.shape.Page=Graph.extend({canvas:null,rendered:!0,tree:{parent:null,children:null},constructor:function(){this.canvas=new Graph.svg.Paper(1e3,1e3),this.canvas.addClass("graph-page"),this.tree.children=new Graph.collection.Shape},children:function(){return this.tree.children},render:function(t){var e=this;return e.rendered=!0,e.canvas.render(t),this},append:function(t){return t.render(this,"append"),t},prepend:function(t){return t.render(this,"prepend"),t},draw:function(){var t,e=_.toArray(arguments),r=_.split(e.shift(),"."),n=_.capitalize(r.pop()||""),s="Graph.shape."+_.join(r.concat([n]),"."),o=Graph.ns(s);return o?(t=Graph.factory(o,e),t.page=this):(console.warn("Class {"+s+"} doesn't exists!"),
t=null),t},erase:function(){},isPage:function(){return!0}})}(),function(){Graph.shape.common.Connector=Graph.shape.Base.extend({props:{source:{x:0,y:0},target:{x:0,y:0}},constructor:function(){this.$super()},initComponent:function(){this.component=new Graph.svg.Group,this.component.addClass("graph-shape-connector"),this.component.line()}})}(),function(){Graph.shape.activity.Action=Graph.shape.Base.extend({props:{x:0,y:0,width:200,height:50,text:"Action"},initComponent:function(){var t=this.components,e=this.props;t.group=new Graph.svg.Group,t.group.draggable(),t.group.on({render:_.bind(this.onGroupRender,this)}),t.block=t.group.append(new Graph.svg.Rect(0,0,e.width,e.height)),t.block.resizable(),t.block.linkable(),t.block.on({resize:_.bind(this.onBlockResize,this)}),t.text=t.group.append(new Graph.svg.Text(0,0,e.text)),t.text.selectable(!1),t.text.clickable(!1),t.text.on({render:_.bind(this.onTextRender,this)})},centerText:function(){this.components.text.center(this.components.block)},onGroupRender:function(){
var t=this.components;t.group.translate(this.props.x,this.props.y).apply()},onBlockResize:function(){this.centerText()},onTextRender:function(){this.centerText()}})}(),function(){Graph.shape.activity.Initial=Graph.shape.Base.extend({})}(),function(){Graph.shape.activity.Pool=Graph.shape.Base.extend({props:{x:0,y:0,height:0,offsetTop:0,offsetLeft:0},constructor:function(t){this.$super(t)},initComponent:function(){var t=this.components,e=this.props;t.group=new Graph.svg.Group,t.group.sortable(),t.group.addClass("graph-shape graph-shape-activity-pool"),t.group.translate(e.x,e.y).apply(),t.group.data("selectable",!1),t.group.on("render",_.bind(this.onGroupRender,this))},onGroupRender:function(){var t=this;t.props.offsetTop=t.props.y,t.props.offsetLeft=t.props.x,t.children().each(function(t){console.log(t.text())})}})}(),function(){Graph.shape.activity.Router=Graph.shape.Base.extend({})}(),function(){Graph.shape.activity.Swimlane=Graph.shape.Base.extend({props:{x:0,y:0,offsetLeft:0,offsetTop:0,
height:150,width:200,rotate:0,headerHeight:30,text:"Swimlane",textRotate:270},initComponent:function(){var t=this.components,e=this.props;t.group=new Graph.svg.Group,t.group.addClass("graph-shape graph-shape-activity-swimlane"),t.group.draggable({axis:"y"}),t.group.on({render:_.bind(this.onGroupRender,this),"resize.sortable":_.bind(this.onGroupResize,this)}),t.block=t.group.append(new Graph.svg.Rect(0,0,e.width,e.height)),t.block.resizable(),t.block.on({resize:_.bind(this.onBlockResize,this),collect:_.bind(this.onBlockCollect,this),render:_.bind(this.onBlockRender,this)}),t.headGroup=t.group.append(new Graph.svg.Group),t.headGroup.selectable(!1),t.head=t.headGroup.append(new Graph.svg.Rect(0,0,e.headerHeight,e.height)),t.head.selectable(!1),t.text=t.headGroup.append(new Graph.svg.Text(0,0,e.text)),t.text.selectable(!1),t.text.on({render:_.bind(this.onTextRender,this)})},render:function(t,e){var r=this;r.$super(t,e),r.page.on("scroll",_.bind(r.onPageScroll,r))},translate:function(t,e){this.props.x+=t,
this.props.y+=e,this.components.group.translate(t,e).apply()},rotate:function(t,e,r){},width:function(t){return _.isUndefined(t)?this.props.width:(this.props.width=t,this)},height:function(t){return _.isUndefined(t)?this.props.height:(this.props.height=t,this)},centerText:function(){this.components.text.reset(),this.components.text.center(this.components.head),this.components.text.rotate(this.props.textRotate).apply()},onPageScroll:function(t){var e=this.components,r=this.props;"right"!=t.dir&&"left"!=t.dir||(e.headGroup.reset(),t.currX>=r.offsetLeft&&e.headGroup.translate(t.currX-r.offsetLeft-t.origX,0).apply())},onGroupRender:function(){var t=this.components;t.group.translate(this.props.x,this.props.y).apply()},onGroupResize:function(t,e){var r=this.components;r.block.attr({width:t.width}),r.block.resizer.redraw()},onBlockRender:function(){var t=this.components,e=(this.props,t.block.bbox(!1,!1).data()),r=t.block.ctm();this.props.offsetLeft=r.x(e.x,e.y),this.props.offsetTop=r.y(e.x,e.y);
},onBlockCollect:function(t){t.collect(this.components.group),this.components.group.forward()},onBlockResize:function(t){var e=this.components,r=e.block.bbox(!1,!1).data();e.head.resize(1,t.sy,t.cx,t.cy,0,0),this.centerText(),this.props.width=r.width,this.props.height=r.height,t.width=this.props.width,t.height=this.props.height,e.group.fire("resize",t,e.group)},onTextRender:function(){this.centerText()}})}(),function(){Graph.shape.activity.Terminal=Graph.shape.Base.extend({})}(),function(){Graph.collection.Shape=Graph.extend({items:[],constructor:function(t){this.items=t||[]},length:function(){return this.items.length},push:function(t){this.items.push(t),this.fire("push",t,this)},pop:function(){},shift:function(){},unshift:function(t){this.items.unshift(t),this.fire("unshift",t,this)},last:function(){return _.last(this.items)},each:function(t){var e=this;_.forEach(e.items,function(e,r){!function(e){t.call(e,e,r)}(e)})}})}();
//# sourceMappingURL=graph.min.js.map
