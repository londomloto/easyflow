!function(){function t(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function e(t){return{left:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){for(arguments.length<3&&(r=0),arguments.length<4&&(i=e.length);r<i;){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}_.float=parseFloat,_.gcd=function(t){if(2===t.length){for(var e,n=t[0],r=t[1];r>0;)e=r,r=n%r,n=e;return n}var i,o=t[0],a=t.length;for(i=1;i<a;i++)o=_.gcd([o,t[i]]);return o},_.lcm=function(t){if(2===t.length){var e=t[0],n=t[1];return e*(n/_.gcd([e,n]))}var r,i=t[0],o=t.length;for(r=1;r<o;r++)i=_.lcm([i,t[r]]);return i},_.format=function(){var t=_.toArray(arguments),e=t.shift();return e.replace(/{(\d+)}/g,function(e,n){return"undefined"!=typeof t[n]?t[n]:e})},_.insert=function(t,e,n){return Array.prototype.splice.apply(t,[e,0].concat(n)),t},_.move=function(t,e,n){for(var r=t.length;e<0;)e+=r;for(;n<0;)n+=r;if(n>=r)for(var i=n-r;i--+1;)t.push(void 0);
return t.splice(n,0,t.splice(e,1)[0]),t},_.permute=function(t,e){return _.isFunction(e)?_.reduce(t,function(t,n,r){return t[e(r,n)]=n,t},[]):_.isArray(e)?_.reduce(e,function(n,r,i){return n[i]=t[e[i]],n},[]):t},_.bisector=function(n){return e(1===n.length?function(e,r){return t(n(e),r)}:n)},_.ascendingKey=function(t){return"function"==typeof t?function(e,n){return t(e)<t(n)?-1:t(e)>t(n)?1:t(e)>=t(n)?0:NaN}:function(e,n){return e[t]<n[t]?-1:e[t]>n[t]?1:e[t]>=n[t]?0:NaN}},_.isIE=function(){var t=global.navigator,e=(t&&t.userAgent||"").toLowerCase(),n=e.indexOf("MSIE ");return!!(n>0||e.match(/Trident.*rv\:11\./))&&parseInt(e.substring(n+5,e.indexOf(".",n)))}}(),function(){var t="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),e=document,n=(location,navigator),r=100,i=1e3,o=[];t.Graph=function(t){o.push(t)},Graph.VERSION="1.0.0",Graph.AUTHOR="Kreasindo Cipta Teknologi",Graph.cached={},Graph.config={base:"../",locale:"id",
svg:{version:"1.1"},xmlns:{svg:"http://www.w3.org/2000/svg",xlink:"http://www.w3.org/1999/xlink",html:"http://www.w3.org/1999/xhtml"},font:{family:"Segoe UI",size:"12px",line:1}},Graph.setup=function(t,e){_.isPlainObject(t)?_.extend(Graph.config,t):Graph.config[t]=e},Graph.string={ID_VECTOR:"graph-vector-id",ID_SHAPE:"graph-shape-id",ID_LINK:"graph-link-id",ID_PORT:"graph-port-id"},Graph.styles={VECTOR:"graph-elem",PAPER:"graph-paper",VIEWPORT:"graph-viewport",SHAPE:"graph-shape",SHAPE_BLOCK:"comp-block",SHAPE_LABEL:"comp-label",SHAPE_HEADER:"comp-header",SHAPE_CHILD:"comp-child",SHAPE_DRAG:"shape-draggable",LINK_HEAD:"graph-link-head",LINK_TAIL:"graph-link-tail"},Graph.icons={ZOOM_IN:"ion-android-add",ZOOM_OUT:"ion-android-remove",ZOOM_RESET:"ion-pinpoint",SHAPE:"bpmn-icon-start-event-none",SHAPE_LANE:"bpmn-icon-participant",SHAPE_LINK:"ion-ios-shuffle-strong",SHAPE_ACTION:"bpmn-icon-task",SHAPE_ROUTER:"bpmn-icon-gateway-none",LANE_ABOVE:"bpmn-icon-lane-insert-above",LANE_BELOW:"bpmn-icon-lane-insert-below",
CONFIG:"bpmn-icon-screw-wrench",LINK:"bpmn-icon-connection-multi",TRASH:"bpmn-icon-trash",SEND_TO_BACK:"font-icon-send-back",SEND_TO_FRONT:"font-icon-bring-front",MOVE_UP:"ion-android-arrow-up",MOVE_DOWN:"ion-android-arrow-down"},Graph.doc=function(){},Graph.global=function(){},Graph.isHTML=function(t){return t instanceof HTMLElement},Graph.isSVG=function(t){return t instanceof SVGElement},Graph.isElement=function(t){return t instanceof Graph.dom.Element},Graph.isMac=function(){return/mac/i.test(n.platform)},Graph.ns=function(e){var n=Graph.lookup("Graph","ns",e);if(n.clazz)return n.clazz;var r,i,o=_.split(e,"."),a=t,s=o.length;for(i=0;i<s;i++)r=o[i],a[r]=a[r]||{},a=a[r];return _.isFunction(a)&&(n.clazz=a),a},Graph.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var e=16*Math.random()|0,n="x"==t?e:3&e|8;return n.toString(16)})},Graph.hash=function(t){var e,n,r,i=0;if(!t.length)return i;for(r=0,n=t.length;r<n;r++)e=t.charCodeAt(r),i=(i<<5)-i+e,i|=0;
return i},Graph.create=function(t,e){},Graph.factory=function(t,e){return e=[t].concat(e),new(Function.prototype.bind.apply(t,e))},Graph.expand=function(t,e,n){var r=t.constructor.prototype,i=e.constructor.prototype;n=_.defaultTo(e),_.forOwn(i,function(t,e){_.isFunction(t)&&_.isUndefined(r[e])&&!function(t,e){r[t]=_.bind(e,n)}(e,t)})},Graph.extend=function(t,e){return _.isPlainObject(t)&&(e=t,t=Graph.lang.Class),t.extend(e)},Graph.mixin=function(t,e){this.extend(t,e,t)},Graph.lookup=function(t,e){var n,i,o=_.toArray(arguments);return t=o.shift(),e=_.join(o,"|"),n=Graph.cached[t]=Graph.cached[t]||{},i="Regex.event"==t?null:r,n[e]?n[e].credit=i:n[e]={credit:i,remove:function(t,e){return function(){delete Graph.cached[t][e]}}(t,e)},_.debounce(function(t){_.forOwn(n,function(e,r){r!=t&&null!==n[r].credit&&(n[r].credit--,n[r].credit<=0&&delete n[r])})})(e),n[e]},Graph.memoize=function(t){return function e(){var n=_.toArray(arguments),r=_.join(n,"â€"),o=e.cache=e.cache||{},a=e.saved=e.saved||[];
if(!_.isUndefined(o[r])){for(var s=0,p=a.length;s<p;s++)if(a[s]==r){a.push(a.splice(s,1)[0]);break}return o[r]}return a.length>=i&&delete o[a.shift()],a.push(r),o[r]=t.apply(this,n),o[r]}},Graph.defer=function(){return $.Deferred()},Graph.when=$.when,Graph.paper=function(t,e,n){return Graph.factory(Graph.svg.Paper,[t,e,n])},Graph.svg=function(t){var e,n=_.toArray(arguments);return t=n.shift(),e=Graph.factory(Graph.svg[_.capitalize(t)],n),n=null,e},Graph.shape=function(t,e){var n,r,i;return i=t.lastIndexOf("."),t=t.substr(0,i)+"."+_.capitalize(t.substr(i+1)),n=Graph.ns("Graph.shape."+t),r=Graph.factory(n,e),i=t=n=null,r},Graph.layout=function(t){},Graph.router=function(t){},Graph.link=function(t){},Graph.plugin=function(t){},Graph.diagram=function(t,e){var n,r;n=Graph.diagram[_.capitalize(t)],r=Graph.factory(n,[e]),console.log(r)},Graph.pallet=function(t,e){var n;return n=Graph.pallet[_.capitalize(t)],Graph.factory(n,[e])},Graph.topic={subscribers:{},publish:function(t,e,n){var r=Graph.topic.subscribers,i=r[t]||[];
_.forEach(i,function(t){!function(){t.call(null,e,n)}(t)})},subscribe:function(t,e){if(_.isPlainObject(t)){var n=[];return _.forOwn(t,function(t,e){!function(t,e){var r=Graph.topic.subscribe(t,e);n.push({topic:t,sub:r})}(e,t)}),{unsubscribe:function(t){return function(e){if(e){var n=_.find(t,function(t){return t.topic==e});n&&n.sub.unsubscribe()}else _.forEach(t,function(t){t.sub.unsubscribe()})}}(n)}}var r=Graph.topic.subscribers;return r[t]=r[t]||[],r[t].push(e),{unsubscribe:function(t,e){return function(){Graph.topic.unsubscribe(t,e)}}(t,e)}},unsubscribe:function(t,e){for(var n=Graph.topic.subscribers,r=n[t]||[],i=r.length-1;i>=0;i--)r[i]===e&&r.splice(i,1)}},t.graphConfig&&Graph.setup(t.graphConfig),Graph.ns("Graph.lang"),Graph.ns("Graph.collection"),Graph.ns("Graph.registry"),Graph.ns("Graph.data"),Graph.ns("Graph.popup"),Graph.ns("Graph.shape.activity"),Graph(function(){var t=$(e);t.on("mousedown",function(t){var e,n=$(t.target),r=n.data(Graph.string.ID_VECTOR);r?(r=Graph.registry.vector.get(r),
e=r.paper(),Graph.cached.paper=e?e.guid():null):Graph.cached.paper=null,r=e=null}),t=null}),function(t,e){var n,r=function(){t.removeEventListener(e,r,!1),t.readyState="complete"},i=function(){_.forEach(o,function(t){t()})},a=function(){"complete"!=t.readyState?n=_.delay(function(){clearTimeout(n),n=null,a()},10):i()};null==t.readyState&&t.addEventListener&&(t.addEventListener(e,r,!1),t.readyState="loading"),a()}(e,"DOMContentLoaded")}(),function(){var t=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,e=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,n=/,?([achlmqrstvxz]),?/gi,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,i=/((matrix|translate|rotate|scale|skewX|skewY)*\((\-?\d+\.?\d*e?\-?\d*[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+\))+/g,o=/[\w\.\-]+/g,r=/(\-?[0-9.]+)\s*,\s*(\-?[0-9.]+)/g,a=10,s=6,p=12,h=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],c=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472];
Graph.util={deg:function(t){return Math.round(180*t/Math.PI%360*1e3)/1e3},rad:function(t){return t%360*Math.PI/180},angle:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n||r?(180+180*Math.atan2(-r,-n)/Math.PI+360)%360:0},theta:function(t,e){var n,r,i=-(e.y-t.y),o=e.x-t.x;return n=0==i.toFixed(10)&&0==o.toFixed(10)?0:Math.atan2(i,o),n<0&&(n=2*Math.PI+n),r=180*n/Math.PI,r=r%360+(r<0?360:0)},taxicab:function(t,e){var n=t.x-e.x,r=t.y-e.y;return n*n+r*r},hypo:function(t,e){return Math.sqrt(t*t+e*e)},sign:function(t){return t<0?-1:1},quadrant:function(t,e){return t>=0&&e>=0?1:t>=0&&e<0?4:t<0&&e<0?3:2},gradient:function(t,e){return e.x==t.x?e.y>t.y?1/0:-(1/0):e.y==t.y?e.x>t.x?0:-0:(e.y-t.y)/(e.x-t.x)},snapValue:function(t,e,n){if(n=_.defaultTo(n,10),_.isArray(e)){for(var r=e.length;r--;)if(Math.abs(e[r]-t)<=n)return e[r]}else{e=+e;var i=t%e;if(i<n)return t-i;if(i>t-n)return t-i+e}return t},pointbox:function(t,e,n){_.isPlainObject(t)&&(n=e,e=t.y,t=t.x),n=n||0;var r=t-n,i=e-n,o=t+n,a=e+n,s=o-r,p=a-i;
return{x:r,y:i,x2:o,y2:a,width:s,height:p}},pointAlign:function(t,e,n){return!(!t||!e)&&(n=n||2,Math.abs(t.x-e.x)<=n?"h":Math.abs(t.y-e.y)<=n&&"v")},pointDistance:function(t,e){return t&&e?Graph.util.hypo(t.x-e.x,t.y-e.y):-1},isPointEquals:function(t,e){return t.x==e.x&&t.y==e.y},isPointOnLine:function(t,e,n){if(!t||!e||!n)return!1;var r=(e.x-t.x)*(n.y-t.y)-(e.y-t.y)*(n.x-t.x),i=Graph.util.pointDistance(t,e);return Math.abs(r/i)<2},polar2point:function(t,e,n){var r,i,o;return _.isUndefined(n)&&(n=Graph.point(0,0)),r=Math.abs(t*Math.cos(e)),i=Math.abs(t*Math.sin(e)),o=Graph.util.deg(e),o<90?i=-i:o<180?(r=-r,i=-i):o<270&&(r=-r),Graph.point(n.props.x+r,n.props.y+i)},isBoxContainsPoint:function(t,e){return e.x>=t.x&&e.x<=t.x2&&e.y>=t.y&&e.y<=t.y2},isBoxIntersect:function(t,e){var n=Graph.util.isBoxContainsPoint;return n(e,{x:t.x,y:t.y})||n(e,{x:t.x2,y:t.y})||n(e,{x:t.x,y:t.y2})||n(e,{x:t.x2,y:t.y2})||n(t,{x:e.x,y:e.y})||n(t,{x:e.x2,y:e.y})||n(t,{x:e.x,y:e.y2})||n(t,{x:e.x2,y:e.y2})||(t.x<e.x2&&t.x>e.x||e.x<t.x2&&e.x>t.x)&&(t.y<e.y2&&t.y>e.y||e.y<t.y2&&e.y>t.y);
},boxOrientation:function(t,e,n,r){n=_.defaultTo(n,0),r=_.defaultTo(r,n);var i=t.y2+r<=e.y,o=t.x-n>=e.x2,a=t.y-r>=e.y2,s=t.x2+n<=e.x,p=i?"top":a?"bottom":null,h=s?"left":o?"right":null;return h&&p?p+"-"+h:h||p||"intersect"},midpoint:function(t,e){return{x:(t.x+e.x)/2,y:(t.y+e.y)/2}},movepoint:function(t,e,n){var r=Graph.util.rad(Graph.util.theta(e,t)),i=Math.cos(r)*n,o=-Math.sin(r)*n;return t.x+=i,t.y+=o,t},lineBendpoints:function(t,e,n){var r,i,o=[],a=t.x,s=t.y,p=e.x,h=e.y;return n=n||"h:h","h:v"==n?o=[{x:p,y:s}]:"v:h"==n?o=[{x:a,y:h}]:"h:h"==n?(r=Math.round((p-a)/2+a),o=[{x:r,y:s},{x:r,y:h}]):"v:v"==n?(i=Math.round((h-s)/2+s),o=[{x:a,y:i},{x:p,y:i}]):o=[],o},lineIntersection:function(t,e,n,r,i,o,a,s){if(Math.max(t,n)<Math.min(i,a)||Math.min(t,n)>Math.max(i,a)||Math.max(e,r)<Math.min(o,s)||Math.min(e,r)>Math.max(o,s))return null;var p=(t*r-e*n)*(i-a)-(t-n)*(i*s-o*a),h=(t*r-e*n)*(o-s)-(e-r)*(i*s-o*a),c=(t-n)*(o-s)-(e-r)*(i-a);if(!c)return null;var l=p/c,u=h/c,d=+l.toFixed(2),f=+u.toFixed(2);
return d<+Math.min(t,n).toFixed(2)||d>+Math.max(t,n).toFixed(2)||d<+Math.min(i,a).toFixed(2)||d>+Math.max(i,a).toFixed(2)||f<+Math.min(e,r).toFixed(2)||f>+Math.max(e,r).toFixed(2)||f<+Math.min(o,s).toFixed(2)||f>+Math.max(o,s).toFixed(2)?null:{x:l,y:u}},perpendicular:function(t,e,n){var r,i,o,a;r=Graph.util.gradient(t,e),i=0===r?0:-1/r,o=Math.atan(i);var a=n*Math.cos(o),s=(t.x+e.x)/2,p=(t.y+e.y)/2,h=p-s*i,c=s+a,l=i*c+h;return{from:{x:s,y:p},to:{x:c,y:l}}},points2path:function(t){var e=_.map(t,function(t,e){var n=0===e?"M":"L";return[n,t.x,t.y]});return Graph.util.segments2path(e)},path2points:function(t){var e=Graph.util.path2segments(t);return _.map(e,function(t,e){return"M"==t[0]||"L"==t[0]?{x:t[1],y:t[2]}:{x:t[5],y:t[6]}})},segments2path:function(t){return _.join(t||[],",").replace(n,"$1")},path2segments:function(n){if(!n)return[];var r=Graph.lookup("Graph.util","path2segments",n),i={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},o=[];return r.segments?_.cloneDeep(r.segments):(n.replace(t,function(t,n,r){
var a=[],s=n.toLowerCase();if(r.replace(e,function(t,e){e&&a.push(+e)}),"m"==s&&a.length>2&&(o.push(_.concat([n],a.splice(0,2))),s="l",n="m"==n?"l":"L"),"r"==s)o.push(_.concat([n],a));else for(;a.length>=i[s]&&(o.push(_.concat([n],a.splice(0,i[s]))),i[s]););}),r.segments=_.cloneDeep(o),o)},polygon2dots:function(t){var e=[];return t.replace(r,function(t,n,r){e.push([_.float(n),_.float(r)])}),e},polygon2path:function(t){var e=Graph.util.polygon2dots(t);if(!e.length)return"M0,0";for(var t="M"+e[0][0]+","+e[0][1],n=1,r=e.length;n<r;n++)t+="L"+e[n][0]+","+e[n][1]+",";return t=t.substring(0,t.length-1),t+="Z"},transform2segments:Graph.memoize(function(t){var e={matrix:!0,translate:!0,rotate:!0,scale:!0,skewX:!0,skewY:!0};t+="";var n=[],r=t.match(i);return r&&_.forEach(r,function(t){var r=t.match(o),i=r.shift();e[i]&&(r=_.map(r,function(t){return+t}),n.push([i].concat(r)))}),n}),curvebox:Graph.memoize(function(t,e,n,r,i,o,a,s){var p=_.join(arguments,"_"),h=Graph.lookup("Graph.util","curvebox",p);
if(p=null,h.curvebox)return h.curvebox;for(var c,l,u,d,f,g,v,y,m=[],x=[[],[]],b=0;b<2;++b)if(0==b?(l=6*t-12*n+6*i,c=-3*t+9*n-9*i+3*a,u=3*n-3*t):(l=6*e-12*r+6*o,c=-3*e+9*r-9*o+3*s,u=3*r-3*e),Math.abs(c)<1e-12){if(Math.abs(l)<1e-12)continue;d=-u/l,0<d&&d<1&&m.push(d)}else v=l*l-4*u*c,y=Math.sqrt(v),v<0||(f=(-l+y)/(2*c),0<f&&f<1&&m.push(f),g=(-l-y)/(2*c),0<g&&g<1&&m.push(g));for(var G,w=m.length,k=w;w--;)d=m[w],G=1-d,x[0][w]=G*G*G*t+3*G*G*d*n+3*G*d*d*i+d*d*d*a,x[1][w]=G*G*G*e+3*G*G*d*r+3*G*d*d*o+d*d*d*s;return x[0][k]=t,x[1][k]=e,x[0][k+1]=a,x[1][k+1]=s,x[0].length=x[1].length=k+2,h.curvebox={min:{x:Math.min.apply(0,x[0]),y:Math.min.apply(0,x[1])},max:{x:Math.max.apply(0,x[0]),y:Math.max.apply(0,x[1])}},h.curvebox}),curveLength:function(t,e,n,r,i,o,a,s,l){l=_.defaultTo(l,1),l=l>1?1:l<0?0:l;for(var u=l/2,d=0,f=0;f<p;f++){var g=u*h[f]+u,v=Graph.util.curvePolynom(g,t,n,i,a),y=Graph.util.curvePolynom(g,e,r,o,s),m=v*v+y*y;d+=c[f]*Math.sqrt(m)}return u*d},curvePolynom:function(t,e,n,r,i){var o=-3*e+9*n-9*r+3*i,a=t*o+6*e-12*n+6*r;
return t*a-3*e+3*n},curveInterval:function(t,e,n,r,i,o,a,s,p){if(!(p<0||Graph.util.curveLength(t,e,n,r,i,o,a,s)<p)){var h,c=1,l=c/2,u=c-l,d=.01;for(h=Graph.util.curveLength(t,e,n,r,i,o,a,s,u);Math.abs(h-p)>d;)l/=2,u+=(h<p?1:-1)*l,h=Graph.util.curveLength(t,e,n,r,i,o,a,s,u);return u}},pointAtInterval:function(t,e,n,r,i,o,a,s,p){var h=1-p,c=Math.pow(h,3),l=Math.pow(h,2),u=p*p,d=u*p,f=c*t+3*l*p*n+3*h*p*p*i+d*a,g=c*e+3*l*p*r+3*h*p*p*o+d*s,v=t+2*p*(n-t)+u*(i-2*n+t),y=e+2*p*(r-e)+u*(o-2*r+e),m=n+2*p*(i-n)+u*(a-2*i+n),x=r+2*p*(o-r)+u*(s-2*o+r),b=h*t+p*n,G=h*e+p*r,_=h*i+p*a,w=h*o+p*s,k=90-180*Math.atan2(v-m,y-x)/Math.PI;return k=90-180*Math.atan2(m-v,x-y)/Math.PI,{x:f,y:g,m:{x:v,y:y},n:{x:m,y:x},start:{x:b,y:G},end:{x:_,y:w},alpha:k}},curveIntersection:function(t,e,n){var r=Graph.util.curvebox.apply(null,t),i=Graph.util.curvebox.apply(null,e),o=0,a=[],s={x:r.min.x,y:r.min.y,x2:r.max.x,y2:r.max.y},p={x:i.min.x,y:i.min.y,x2:i.max.x,y2:i.max.y};if(!Graph.util.isBoxIntersect(s,p))return n?0:[];var h,c,l,u,d=Graph.util.curveLength.apply(null,t),f=Graph.util.curveLength.apply(null,e),g=~~(d/10),v=~~(f/10),y=[],m=[],x={};
for(h=0;h<g+1;h++)l=h/g,u=Graph.util.pointAtInterval.apply(null,t.concat([l])),y.push({x:u.x,y:u.y,t:l});for(h=0;h<v+1;h++)l=h/v,u=Graph.util.pointAtInterval.apply(null,e.concat([l])),m.push({x:u.x,y:u.y,t:l});for(h=0;h<g;h++)for(c=0;c<v;c++){var b=y[h],G=y[h+1],_=m[c],w=m[c+1],k=Math.abs(G.x-b.x)<.001?"y":"x",C=Math.abs(w.x-_.x)<.001?"y":"x",S=Graph.util.lineIntersection(b.x,b.y,G.x,G.y,_.x,_.y,w.x,w.y);if(S){if(x[S.x.toFixed(4)]==S.y.toFixed(4))continue;x[S.x.toFixed(4)]=S.y.toFixed(4);var T=b.t+Math.abs((S[k]-b[k])/(G[k]-b[k]))*(G.t-b.t),M=_.t+Math.abs((S[C]-_[C])/(w[C]-_[C]))*(w.t-_.t);T>=0&&T<=1.001&&M>=0&&M<=1.001&&(o++,a.push({x:S.x,y:S.y,t1:T,t2:M}))}}return n?o:a},convexSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||a,i>r&&o>r){var s,p=Graph.util.movepoint({x:t.x,y:t.y},e,-r/2),h=Graph.util.movepoint({x:t.x,y:t.y},n,-r/2),c=Graph.util.pointAlign(e,n,r/2);return"h"==c?s={x:t.x-r,y:t.y}:(p.y=e.y,h.y=n.y,
s={x:t.x,y:t.y-r}),[["L",p.x,p.y],["Q",s.x,s.y,h.x,h.y]]}return null},smoothSegment:function(t,e,n,r){if(!e||!n||!t)return null;var i=Graph.util.pointDistance(t,e),o=Graph.util.pointDistance(t,n);if(r=r||s,i>r&&o>r){var a=Graph.util.movepoint({x:t.x,y:t.y},e,-r),p=Graph.util.movepoint({x:t.x,y:t.y},n,-r);return[["L",a.x,a.y],["Q",t.x,t.y,p.x,p.y]]}return null}}}(),function(){var t,e=/file/.test(location.protocol);e?t={translate:function(t){return{fetch:function(){return t}}}}:$.ajax({url:Graph.config.base+"i18n/languages/"+Graph.config.locale+".json",type:"GET",dataType:"json",async:!1}).done(function(e){var n={graph:{"":{domain:"graph",lang:Graph.config.locale,plural_forms:"nplurals=2; plural=(n != 1)"}}};_.assign(n.graph,e),t=new Jed({domain:"graph",locale_data:n})}),Graph._=function(e){return t.translate(e).fetch()}}(),function(){var t=!1,e=Graph.lang.Class=function(){};e.prototype.constructor=e,e.prototype.toString=function(){return"Graph.lang.Class"},e.defaults={},e.extend=function(n){
var r,i,o,a,p;r=this.prototype,p={},t=!0,i=Object.create(r),t=!1;var o;for(o in n)a=n[o],_.isFunction(a)?i[o]=a:(i[o]=a,p[o]=a);var h,c;return _.isUndefined(i.constructor)||(c=i.constructor,delete i.constructor),h=function(){var t,e,n=this;n.listeners={};var r=n.constructor.defaults,i=n.superclass.defaults,o={};if(i)for(t in i)n[t]=_.cloneDeep(i[t]),o[t]=!0;if(r)for(t in r)e=_.cloneDeep(r[t]),o[t]?(_.isPlainObject(e)||_.isArray(e))&&_.assign(n[t],e):n[t]=e;o=i=r=null,c&&c.apply(n,arguments)},h.extend=e.extend,h.defaults=p,h.prototype=i,h.prototype.constructor=h,h.prototype.superclass=r.constructor,h.prototype.on=function(t,e,n){var r,i=this;if(_.isPlainObject(t))return _.forOwn(t,function(t,e){if(_.isPlainObject(t)){var n=t;t=n.handler,s=n.once,i.on(e,t,s)}else i.on(e,t,!1)}),i;var o=_.split(t,"."),a=o.shift();return i.listeners[a]=i.listeners[a]||[],n=_.defaultTo(n,!1),r={type:t,once:n,orig:e,func:_.bind(e,this)},i.listeners[a].push(r),this},h.prototype.one=function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){
n.on(e,t,!0)}),n):n.on(t,e,!0)},h.prototype.off=function(t,e){var n,r,i,o;n=_.split(t,"."),r=n.shift(),i=r?(this.listeners[r]||[]).slice():[];var a=Graph.lookup("Regex.event",t);if(a.rgex?o=a.rgex:(o=new RegExp(_.escapeRegExp(t),"i"),a.rgex=o),i.length)for(var s=i.length-1;s>=0;s--)e?o.test(i[s].type)&&i[s].orig===e&&this.listeners[r].splice(s,1):o.test(i[s].type)&&this.listeners[r].splice(s,1);else{var p=this;for(r in p.listeners)!function(t){for(var n=t.length-1;n>=0;n--)e?o.test(t[n].type)&&t[n].orig===e&&t.splice(n,1):o.test(t[n].type)&&t.splice(n,1)}(p.listeners[r])}return o=null,i=null,this},h.prototype.fire=function(t,e){var n,r,i,o,a,s=(h.prototype.fire,[]);_.isString(t)?n=new Graph.lang.Event(t,e):(n=t,n.originalData=n.originalData||{},t=n.originalType||n.type),n.publisher=this,s.push(n),r=_.split(t,"."),i=r.shift(),o=(this.listeners[i]||[]).slice();var p=Graph.lookup("Regex.event",t);p.rgex?a=p.rgex:(a=new RegExp(_.escapeRegExp(t),"i"),p.rgex=a);var c=[];if(o.length)for(var l=0,u=o.length;l<u;l++)i!=t?a.test(o[l].type)&&(o[l].once&&c.push(o[l]),
o[l].func.apply(o[l].func,s)):(o[l].once&&c.push(o[l]),o[l].func.apply(o[l].func,s));if(c.length){var d=this;_.forEach(c,function(t){d.off(t.type,t.orig)})}return a=o=null,n},h}}(),function(){var t=Graph.lang.Error=function(t){this.message=t;var e=new Error;this.stack=e.stack,e=null};t.defaults={message:""},t.extend=Graph.lang.Class.extend,t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t.prototype.name="Graph.lang.Error",t.prototype.message="",Graph.error=function(t){return new Graph.lang.Error(t)},Graph.isError=function(t){return t instanceof Graph.lang.Error}}(),function(t,e){var n=Graph.lang.Event=function(t,e){this.type=t,this.originalData=null,this.cancelBubble=!1,this.defaultPrevented=!1,this.propagationStopped=!1,this.immediatePropagationStopped=!1,this.init(e)};n.defaults={type:null,originalData:null,cancelBubble:!1,defaultPrevented:!1,propagationStopped:!1,immediatePropagationStopped:!1},n.extend=Graph.lang.Class.extend,n.prototype.constructor=n,n.prototype.init=function(e){
e&&(this.originalData=e,t.assign(this,e||{}))},n.prototype.stopPropagation=function(){this.cancelBubble=this.propagationStopped=!0},n.prototype.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},n.prototype.preventDefault=function(){this.defaultPrevented=!0},n.prototype.toString=function(){return"Graph.lang.Event"},Graph.event=function(t,e){return new Graph.lang.Event(t,e)},Graph.isEvent=function(t){return t instanceof Graph.lang.Event},Graph.event.ESC=27,Graph.event.ENTER=13,Graph.event.DELETE=46,Graph.event.SHIFT=16,Graph.event.fix=function(t){return e.event.fix(t)},Graph.event.original=function(t){return t.originalEvent||t},Graph.event.position=function(t){return{x:t.clientX,y:t.clientY}},Graph.event.relative=function(t,e){var n=Graph.event.position(t),r=e.matrix().clone().invert(),i={x:r.x(n.x,n.y),y:r.y(n.x,n.y)};return r=null,i},Graph.event.isPrimaryButton=function(t){var e=Graph.event.original(t);return!e.button},Graph.event.hasPrimaryModifier=function(t){
if(!Graph.event.isPrimaryButton(t))return!1;var e=Graph.event.original(t);return Graph.isMac()?e.metaKey:e.ctrlKey},Graph.event.hasSecondaryModifier=function(t){var e=Graph.event.original(t);return Graph.event.isPrimaryButton(t)&&e.shiftKey}}(_,jQuery),function(){function t(t,e){return e*Math.round(t/e)}var e=Graph.lang.Point=function(t,e){var n;this.props={x:0,y:0},_.isPlainObject(t)?(n=t,t=n.x,e=n.y):_.isString(t)&&(n=_.split(_.trim(t),","),t=_.toNumber(n[0]),e=_.toNumber(n[1])),this.props.x=t,this.props.y=e};e.defaults={props:{x:0,y:0}},e.extend=Graph.lang.Class.extend,e.prototype=Object.create(Graph.lang.Class.prototype),e.prototype.constructor=e,e.prototype.superclass=Graph.lang.Class,e.prototype.x=function(t){return _.isUndefined(t)?this.props.x:(this.props.x=t,this)},e.prototype.y=function(t){return _.isUndefined(t)?this.props.y:(this.props.y=t,this)},e.prototype.distance=function(t){var e=this.props.x-t.props.x,n=this.props.y-t.props.y;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2));
},e.prototype.manhattan=function(t){return Math.abs(t.props.x-this.props.x)+Math.abs(t.props.y-this.props.y)},e.prototype.angle=function(t){return Graph.util.angle(a.toJson(),t.toJson())},e.prototype.triangle=function(t,e){return this.angle(e)-t.angle(e)},e.prototype.theta=function(t){return Graph.util.theta(this.toJson(),t.toJson())},e.prototype.difference=function(t){return new Graph.lang.Point(this.props.x-t.props.x,this.props.y-t.props.y)},e.prototype.alignment=function(t){return Graph.util.pointAlign(this.toJson(),t.toJson())},e.prototype.bbox=function(){var t=this.props.x,e=this.props.y;return Graph.bbox({x:t,y:e,x2:t,y2:e,width:0,height:0})},e.prototype.bearing=function(t){var e=new Graph.lang.Line(this,t),n=e.bearing();return e=null,n},e.prototype.snap=function(e,n){return n=_.defaultTo(n,e),this.props.x=t(this.props.x,e),this.props.y=t(this.props.y,n),this},e.prototype.move=function(t,e){var n=Graph.util.rad(t.theta(this));return this.expand(Math.cos(n)*e,-Math.sin(n)*e),this},
e.prototype.expand=function(t,e){return this.props.x+=t,this.props.y+=e,this},e.prototype.round=function(t){return this.props.x=t?this.props.x.toFixed(t):Math.round(this.props.x),this.props.y=t?this.props.y.toFixed(t):Math.round(this.props.y),this},e.prototype.equals=function(t){return this.props.x==t.props.x&&this.props.y==t.props.y},e.prototype.rotate=function(t,e){var n=Graph.util.rad(t),r=this.props.x-(e?e.props.x:0),i=this.props.y-(e?e.props.y:0),o=Math.sin(n),a=Math.cos(n),s=r*a+i*o,p=r*-o+i*a;return this.props.x=this.props.x+s,this.props.y=this.props.y+p,this},e.prototype.transform=function(t){var e=this.props.x,n=this.props.y;return this.props.x=t.x(e,n),this.props.y=t.y(e,n),this},e.prototype.polar=function(){},e.prototype.adhereToBox=function(t){return t.contains(this)?this:(this.props.x=Math.min(Math.max(this.props.x,t.props.x),t.props.x+t.props.width),this.props.y=Math.min(Math.max(this.props.y,t.props.y),t.props.y+t.props.height),this)},e.prototype.stringify=function(t){return t=_.defaultTo(t,","),
this.props.x+t+this.props.y},e.prototype.toString=function(){return"Graph.lang.Point"},e.prototype.toValue=function(){return this.stringify()},e.prototype.toJson=function(){return{x:this.props.x,y:this.props.y}},e.prototype.clone=function(){return new e(this.props.x,this.props.y)},Graph.isPoint=function(t){return t instanceof Graph.lang.Point},Graph.point=function(t,e){return new Graph.lang.Point(t,e)}}(),function(){var t=Graph.lang.Line=function(t,e){var n=_.toArray(arguments);this.props={start:{x:0,y:0},end:{x:0,y:0}},4===n.length?(_.assign(this.props.start,{x:n[0],y:n[1]}),_.assign(this.props.end,{x:n[2],y:n[3]})):(this.props.start=n[0].toJson(),this.props.end=n[1].toJson())};t.defaults={props:{start:{x:0,y:0},end:{x:0,y:0}}},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.start=function(){return Graph.point(this.props.start.x,this.props.start.y)},t.prototype.end=function(){return Graph.point(this.props.end.x,this.props.end.y)},t.prototype.bearing=function(){var t=["NE","E","SE","S","SW","W","NW","N"],e=this.props.start.x,n=this.props.start.y,r=this.props.end.x,i=this.props.end.y,o=Graph.util.rad(n),a=Graph.util.rad(i),s=e,p=r,h=Graph.util.rad(p-s),c=Math.sin(h)*Math.cos(a),l=Math.cos(o)*Math.sin(a)-Math.sin(o)*Math.cos(a)*Math.cos(h);
return index=Graph.util.deg(Math.atan2(c,l))-22.5,index<0&&(index+=360),index=parseInt(index/45),t[index]},t.prototype.intersect=function(t){return null!==this.intersection(t)},t.prototype.intersection=function(t,e){var n=this.props.start.x,r=this.props.start.y,i=this.props.end.x,o=this.props.end.y,a=t.props.start.x,s=t.props.start.y,p=t.props.end.x,h=t.props.end.y,c=Graph.util.lineIntersection(n,r,i,o,a,s,p,h);return c?e?c:Graph.point(c.x,c.y):c},t.prototype.toString=function(){return"Graph.lang.Line"},Graph.line=function(t){var e=_.toArray(arguments);return Graph.factory(Graph.lang.Line,e)},Graph.isLine=function(t){return t instanceof Graph.lang.Line}}(),function(){var t=Graph.lang.Curve=function(t){if(this.segments=_.isString(t)?Graph.util.path2segments(t):_.cloneDeep(t),"M"!=this.segments[0][0]&&this.segments.unshift(["M",this.segments[0][1],this.segments[0][2]]),1===this.segments.length&&"M"===this.segments[0][0]){var e=this.segments[0][1],n=this.segments[0][2];this.segments.push(["C",e,n,e,n,e,n]);
}};t.defaults={segments:[]},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.segments=[],t.prototype.x=function(){return this.segments[1][5]},t.prototype.y=function(){return this.segments[1][6]},t.prototype.length=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveLength.apply(null,e)},t.prototype.t=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]);return Graph.util.curveInterval.apply(null,e)},t.prototype.pointAt=function(t,e){var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)).concat([t]),r=Graph.util.pointAtInterval.apply(null,n);if(e)return r;var i=Graph.point(r.x,r.y);return r.x=r.y=void 0,_.extend(i,r)},t.prototype.intersection=function(t,e){var n=this.segments[0].slice(1).concat(this.segments[1].slice(1)),r=t.segments[0].slice(1).concat(t.segments[1].slice(1)),i=Graph.util.curveIntersection(n,r);if(e)return i;var o=_.map(i,function(t){return Graph.point(t.x,t.y);
});return o},t.prototype.intersectnum=function(t){var e=this.segments[0].slice(1).concat(this.segments[1].slice(1)),n=t.segments[0].slice(1).concat(t.segments[1].slice(1));return Graph.util.curveIntersection(e,n,!0)},t.prototype.bbox=function(){var t=[this.segments[0][1],this.segments[0][2]].concat(this.segments[1].slice(1)),e=Graph.util.curvebox.apply(null,t);return Graph.bbox({x:e.min.x,y:e.min.y,x2:e.max.x,y2:e.max.y,width:e.max.x-e.min.x,height:e.max.y-e.min.y})},t.prototype.clone=function(){var t=_.cloneDeep(this.segments);return new Graph.lang.Curve(t)},t.prototype.toValue=function(){return Graph.util.segments2path(this.segments)},t.prototype.toString=function(){return"Graph.lang.Curve"},Graph.curve=function(t){return new Graph.lang.Curve(t)},Graph.isCurve=function(t){return t instanceof Graph.lang.Curve}}(),function(){var t=Graph.lang.BBox=function(t){this.props=_.extend({x:0,y:0,x2:0,y2:0,width:0,height:0},t||{})};t.defaults={props:{x:0,y:0,x2:0,y2:0,width:0,height:0}},t.extend=Graph.lang.Class.extend,
t.prototype=Object.create(Graph.lang.Class.prototype),t.prototype.constructor=t,t.prototype.superclass=Graph.lang.Class,t.prototype.pathinfo=function(){var t=this.props;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},t.prototype.origin=function(t){t=_.defaultTo(t,!1);var e=this.props.x,n=this.props.y;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.center=function(t){t=_.defaultTo(t,!1);var e=this.props.x+this.props.width/2,n=this.props.y+this.props.height/2;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.corner=function(t){t=_.defaultTo(t,!1);var e=this.props.x+this.props.width,n=this.props.y+this.props.height;return t?{x:e,y:n}:Graph.point(e,n)},t.prototype.width=function(){return this.props.width},t.prototype.height=function(){return this.props.height},t.prototype.clone=function(){var e=_.extend({},this.props);return new t(e)},t.prototype.contains=function(t){var e,n=!0,r=this.props,i=[];if(Graph.isPoint(t))i=[[t.props.x,t.props.y]];else if(Graph.isVector(t))i=t.vertices(!0);else if(Graph.isBBox(t))i=[[t.props.x,t.props.y],[t.props.x2,t.props.y2]];else{
var o=_.toArray(arguments);2===o.length&&(i=[o])}if(i.length)for(var a=i.length;a--&&(e=i[a],n=e[0]>=r.x&&e[0]<=r.x2&&e[1]>=r.y&&e[1]<=r.y2););return n},t.prototype.expand=function(t,e,n,r){var i,o;return _.isUndefined(e)?(i=Math.abs(t),t=-i,e=-i,n=2*i,r=2*i):(i=Math.abs(t),o=Math.abs(e),t=-i,e=-o,n=2*i,r=2*o),this.props.x+=t,this.props.y+=e,this.props.width+=n,this.props.height+=r,this},t.prototype.translate=function(t,e){return this.props.x+=t,this.props.y+=e,this.props.x2+=t,this.props.y2+=e,this},t.prototype.transform=function(t){var e=this.props.x,n=this.props.y;return this.props.x=t.x(e,n),this.props.y=t.y(e,n),e=this.props.x2,n=this.props.y2,this.props.x2=t.x(e,n),this.props.y2=t.y(e,n),this.props.width=this.props.x2-this.props.x,this.props.height=this.props.y2-this.props.y,this},t.prototype.intersect=function(t){var e=this,n=e.props,r=t.toJson();return t.contains(n.x,n.y)||t.contains(n.x2,n.y)||t.contains(n.x,n.y2)||t.contains(n.x2,n.y2)||e.contains(r.x,r.y)||e.contains(r.x2,r.y)||e.contains(r.x,r.y2)||e.contains(r.x2,r.y2)||(n.x<r.x2&&n.x>r.x||r.x<n.x2&&r.x>n.x)&&(n.y<r.y2&&n.y>r.y||r.y<n.y2&&r.y>n.y);
},t.prototype.sideNearestPoint=function(t){var e=t.props.x,n=t.props.y,r=this.props.x,i=this.props.y,o=this.props.width,a=this.props.height,s=e-r,p=r+o-e,h=n-i,c=i+a-n,l=s,u="left";return p<l&&(l=p,u="right"),h<l&&(l=h,u="top"),c<l&&(l=c,u="bottom"),u},t.prototype.pointNearestPoint=function(t){if(this.contains(t)){var e=this.sideNearestPoint(t);switch(e){case"right":return Graph.point(this.props.x+this.props.width,t.props.y);case"left":return Graph.point(this.props.x,t.props.y);case"bottom":return Graph.point(t.props.x,this.props.y+this.props.height);case"top":return Graph.point(t.props.x,this.props.y)}}return t.clone().adhereToBox(this)},t.prototype.toJson=function(){return _.clone(this.props)},t.prototype.toString=function(){return"Graph.lang.BBox"},t.prototype.toValue=function(){var t=this.props;return _.format("{0},{1} {2},{3} {4},{5} {6},{7}",t.x,t.y,t.x+t.width,t.y,t.x+t.width,t.y+t.height,t.x,t.y+t.height)},Graph.isBBox=function(t){return t instanceof Graph.lang.BBox},Graph.bbox=function(t){
return new Graph.lang.BBox(t)}}(),function(){function t(t,e,o){var a,s,p={T:1,Q:1};if(!t)return["C",e.x,e.y,e.x,e.y,e.x,e.y];switch(!(t[0]in p)&&(e.qx=e.qy=null),t[0]){case"M":e.X=t[1],e.Y=t[2];break;case"A":t=["C"].concat(i.apply(0,[e.x,e.y].concat(t.slice(1))));break;case"S":"C"==o||"S"==o?(a=2*e.x-e.bx,s=2*e.y-e.by):(a=e.x,s=e.y),t=["C",a,s].concat(t.slice(1));break;case"T":"Q"==o||"T"==o?(e.qx=2*e.x-e.qx,e.qy=2*e.y-e.qy):(e.qx=e.x,e.qy=e.y),t=["C"].concat(r(e.x,e.y,e.qx,e.qy,t[1],t[2]));break;case"Q":e.qx=t[1],e.qy=t[2],t=["C"].concat(r(e.x,e.y,t[1],t[2],t[3],t[4]));break;case"L":t=["C"].concat(n(e.x,e.y,t[1],t[2]));break;case"H":t=["C"].concat(n(e.x,e.y,t[1],e.y));break;case"V":t=["C"].concat(n(e.x,e.y,e.x,t[1]));break;case"Z":t=["C"].concat(n(e.x,e.y,e.X,e.Y))}return t}function e(t,e){for(var n=[],r=_.defaultTo,i=0,o=t.length;o-2*!e>i;i+=2){var a=[{x:r(t[i-2],0),y:r(t[i-1],0)},{x:r(t[i],0),y:r(t[i+1],0)},{x:r(t[i+2],0),y:r(t[i+3],0)},{x:r(t[i+4],0),y:r(t[i+5],0)}];e?i?o-4==i?a[3]={
x:r(t[0],0),y:r(t[1],0)}:o-2==i&&(a[2]={x:r(t[0],0),y:r(t[1],0)},a[3]={x:r(t[2],0),y:r(t[3],0)}):a[0]={x:r(t[o-2],0),y:r(t[o-1],0)}:o-4==i?a[3]=a[2]:i||(a[0]={x:r(t[i],0),y:r(t[i+1],0)}),n=[(-a[0].x+6*a[1].x+a[2].x)/6,(-a[0].y+6*a[1].y+a[2].y)/6,(a[1].x+6*a[2].x-a[3].x)/6,(a[1].y+6*a[2].y-a[3].y)/6,a[2].x,a[2].y]}return n}function n(t,e,n,r){return[t,e,n,r,n,r]}function r(t,e,n,r,i,o){var a=1/3,s=2/3;return[a*t+s*n,a*e+s*r,a*i+s*n,a*o+s*r,i,o]}function i(t,e,n,r,o,a,s,p,h,c){var l,u=120*Math.PI/180,d=Math.PI/180*(+o||0),f=[],g=Graph.memoize(function(t,e,n){var r=t*Math.cos(n)-e*Math.sin(n),i=t*Math.sin(n)+e*Math.cos(n);return{x:r,y:i}});if(c)k=c[0],C=c[1],_=c[2],w=c[3];else{l=g(t,e,-d),t=l.x,e=l.y,l=g(p,h,-d),p=l.x,h=l.y;var v=(Math.cos(Math.PI/180*o),Math.sin(Math.PI/180*o),(t-p)/2),y=(e-h)/2,m=v*v/(n*n)+y*y/(r*r);m>1&&(m=Math.sqrt(m),n=m*n,r=m*r);var x=n*n,b=r*r,G=(a==s?-1:1)*Math.sqrt(Math.abs((x*b-x*y*y-b*v*v)/(x*y*y+b*v*v))),_=G*n*y/r+(t+p)/2,w=G*-r*v/n+(e+h)/2,k=Math.asin(((e-w)/r).toFixed(9)),C=Math.asin(((h-w)/r).toFixed(9));
k=t<_?Math.PI-k:k,C=p<_?Math.PI-C:C,k<0&&(k=2*Math.PI+k),C<0&&(C=2*Math.PI+C),s&&k>C&&(k-=2*Math.PI),!s&&C>k&&(C-=2*Math.PI)}var S=C-k;if(Math.abs(S)>u){var T=C,M=p,E=h;C=k+u*(s&&C>k?1:-1),p=_+n*Math.cos(C),h=w+r*Math.sin(C),f=i(p,h,n,r,o,0,s,M,E,[C,T,_,w])}S=C-k;var D=Math.cos(k),P=Math.sin(k),A=Math.cos(C),z=Math.sin(C),L=Math.tan(S/4),O=4/3*n*L,R=4/3*r*L,I=[t,e],B=[t+O*P,e-R*D],N=[p+O*z,h-R*A],H=[p,h];if(B[0]=2*I[0]-B[0],B[1]=2*I[1]-B[1],c)return[B,N,H].concat(f);f=[B,N,H].concat(f).join().split(",");for(var q=[],V=0,F=f.length;V<F;V++)q[V]=V%2?g(f[V-1],f[V],d).y:g(f[V],f[V+1],d).x;return q}function o(t,e,n){var r,i,o,a,s,p,h,c,l,u,d,f,g,v,y,m,x,b=t.curve().segments,G=b.length,_=e.curve().segments,w=_.length,k=n?0:[];for(y=0;y<G;y++)if(g=b[y],"M"==g[0])r=s=g[1],i=p=g[2];else for("C"==g[0]?(l=[["M",r,i],g],d=[r,i].concat(g.slice(1)),r=g[5],i=g[6]):(l=[["M",r,i],["C",r,i,s,p,s,s]],d=[r,i,r,i,s,p,s,p],r=s,i=p),m=0;m<w;m++)if(v=_[m],"M"==v[0])o=h=v[1],a=c=v[2];else if("C"==v[0]?(u=[["M",o,a],v],
f=[o,a].concat(v.slice(1)),o=v[5],a=v[6]):(u=[["M",o,a],["C",o,a,h,c,h,c]],f=[o,a,o,a,h,c,h,c],o=h,a=c),n)k+=Graph.util.curveIntersection(d,f,!0);else{x=Graph.util.curveIntersection(d,f);for(var C=0,S=x.length;C<S;C++)x[C].segment1=y,x[C].segment2=m,x[C].bezier1=l,x[C].bezier2=u;k=k.concat(x)}return k}var a=Graph.lang.Path=function(t){var e=[];e=Graph.isPath(t)?_.cloneDeep(t.segments):_.isArray(t)?_.cloneDeep(t):_.cloneDeep(Graph.util.path2segments(t)),this.segments=e};a.defaults={segments:[]},a.extend=Graph.lang.Class.extend,a.prototype.constructor=a,a.prototype.command=function(){return Graph.util.segments2path(this.segments)},a.prototype.absolute=function(){if(!this.segments.length)return new a([["M",0,0]]);var t=Graph.lookup(this.toString(),"absolute",this.toValue()),n=this.segments;if(t.absolute)return t.absolute;var r=[],i=0,o=0,s=0,p=0,h=0;"M"==n[0][0]&&(i=+n[0][1],o=+n[0][2],s=i,p=o,h++,r[0]=["M",i,o]);for(var c,l,u,d=3==n.length&&"M"==n[0][0]&&"R"==n[1][0].toUpperCase()&&"Z"==n[2][0].toUpperCase(),f=h,g=n.length;f<g;f++){
if(r.push(l=[]),u=n[f],u[0]!=_.toUpper(u[0]))switch(l[0]=_.toUpper(u[0]),l[0]){case"A":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]+i),l[7]=+(u[7]+o);break;case"V":l[1]=+u[1]+o;break;case"H":l[1]=+u[1]+i;break;case"R":c=_.concat([i,o],u.slice(1));for(var v=2,y=c.length;v<y;v++)c[v]=+c[v]+i,c[++v]=+c[v]+o;r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]);break;case"M":s=+u[1]+i,p=+u[2]+o;default:for(var m=1,x=u.length;m<x;m++)l[m]=+u[m]+(m%2?i:o)}else if("R"==u[0])c=_.concat([i,o],u.slice(1)),r.pop(),r=_.concat(r,[["C"].concat(e(c,d))]),l=_.concat(["R"],u.slice(-2));else for(var b=0,G=u.length;b<G;b++)l[b]=u[b];switch(l[0]){case"Z":i=s,o=p;break;case"H":i=l[1];break;case"V":o=l[1];break;case"M":s=l[l.length-2],p=l[l.length-1];default:i=l[l.length-2],o=l[l.length-1]}}return t.absolute=r=new a(r),r},a.prototype.start=function(){return this.pointAt(0)},a.prototype.end=function(){return this.pointAt(this.length())},a.prototype.head=function(){},a.prototype.tail=function(){},a.prototype.relative=function(){
var t=Graph.lookup(this.toString(),"relative",this.toValue()),e=this.segments;if(t.relative)return t.relative;var n=[],r=0,i=0,o=0,s=0,p=0;"M"==e[0][0]&&(r=e[0][1],i=e[0][2],o=r,s=i,p++,n.push(["M",r,i]));for(var h=p,c=e.length;h<c;h++){var l=n[h]=[],u=e[h];if(u[0]!=_.toLower(u[0]))switch(l[0]=_.toLower(u[0]),l[0]){case"a":l[1]=u[1],l[2]=u[2],l[3]=u[3],l[4]=u[4],l[5]=u[5],l[6]=+(u[6]-r).toFixed(3),l[7]=+(u[7]-i).toFixed(3);break;case"v":l[1]=+(u[1]-i).toFixed(3);break;case"m":o=u[1],s=u[2];default:for(var d=1,f=u.length;d<f;d++)l[d]=+(u[d]-(d%2?r:i)).toFixed(3)}else{l=res[h]=[],"m"==u[0]&&(o=u[1]+r,s=u[2]+i);for(var g=0,v=u.length;g<v;g++)res[h][g]=u[g]}var y=n[h].length;switch(n[h][0]){case"z":r=o,i=s;break;case"h":r+=+n[h][y-1];break;case"v":i+=+n[h][y-1];break;default:r+=+n[h][y-2],i+=+n[h][y-1]}}return t.relative=n=new a(n),n},a.prototype.curve=function(){function e(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)o[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),
c=r.length}}var n=Graph.lookup(this.toString(),"curve",this.toValue());if(n.curve)return n.curve;for(var r=_.cloneDeep(this.absolute().segments),i={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},o=[],s="",p="",h=0,c=r.length;h<c;h++){r[h]&&(s=r[h][0]),"C"!=s&&(o[h]=s,h&&(p=o[h-1])),r[h]=t(r[h],i,p),"A"!=o[h]&&"C"==s&&(o[h]="C"),e(r,h);var l=r[h],u=l.length;i.x=l[u-2],i.y=l[u-1],i.bx=_.float(l[u-4])||i.x,i.by=_.float(l[u-3])||i.y}return n.curve=new a(r),n.curve},a.prototype.curve2curve=function(e){function n(t,e){if(t[e].length>7){t[e].shift();for(var n=t[e];n.length;)h[e]="A",c[e]="A",t.splice(e++,0,["C"].concat(n.splice(0,6)));t.splice(e,1),f=_.max([i.length,o.length])}}function r(t,e,n,r,a){t&&e&&"M"==t[a][0]&&"M"!=e[a][0]&&(e.splice(a,0,["M",r.x,r.y]),n.bx=0,n.by=0,n.x=t[a][1],n.y=t[a][2],f=_.max([i.length,o&&o.length||0]))}for(var i=_.cloneDeep(this.absolute().segments),o=_.cloneDeep(new a(e).absolute().segments),s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},p={x:0,y:0,bx:0,by:0,X:0,Y:0,
qx:null,qy:null},h=[],c=[],l="",u="",d=0,f=_.max([i.length,o.length]);d<f;d++){i[d]&&(l=i[d][0]),"C"!=l&&(h[d]=l,d&&(u=h[d-1])),i[d]=t(i[d],s,u),"A"!=h[d]&&"C"==l&&(h[d]="C"),n(i,d),o[d]&&(l=o[d][0]),"C"!=l&&(c[d]=l,d&&(u=c[d-1])),o[d]=t(o[d],attrs2,pcom),"A"!=c[d]&&"C"==l&&(c[d]="C"),fixArc2(o,d),r(i,o,s,p,d),r(o,i,p,s,d);var g=i[d],v=o[d],y=g.length,m=v.length;s.x=g[y-2],s.y=g[y-1],s.bx=_.float(g[y-4])||s.x,s.by=_.float(g[y-3])||s.y,p.bx=_.float(v[m-4])||p.x,p.by=_.float(v[m-3])||p.y,p.x=v[m-2],p.y=v[m-1]}return[new a(i),new a(o)]},a.prototype.bbox=function(){if(!this.segments.length)return Graph.bbox({x:0,y:0,width:0,height:0,x2:0,y2:0});var t=Graph.lookup(this.toString(),"bbox",this.toValue());if(t.bbox)return t.bbox;for(var e,n=this.curve().segments,r=0,i=0,o=[],a=[],s=0,p=n.length;s<p;s++)if(e=n[s],"M"==e[0])r=e[1],i=e[2],o.push(r),a.push(i);else{var h=Graph.util.curvebox(r,i,e[1],e[2],e[3],e[4],e[5],e[6]);o=o.concat(h.min.x,h.max.x),a=a.concat(h.min.y,h.max.y),r=e[5],i=e[6]}var c=_.min(o),l=_.min(a),u=_.max(o),d=_.max(a),f=u-c,g=d-l,v={
x:c,y:l,x2:u,y2:d,width:f,height:g,cx:c+f/2,cy:l+g/2};return t.bbox=Graph.bbox(v),t.bbox},a.prototype.transform=function(t){if(t){var e=Graph.lookup(this.toString(),"transform",this.toValue(),t.toValue());if(e.transform)return e.transform;var n,r,i,o,s,p,h,c=_.cloneDeep(this.curve().segments);for(i=0,o=c.length;i<o;i++)for(h=c[i],s=1,p=h.length;s<p;s+=2)n=t.x(h[s],h[s+1]),r=t.y(h[s],h[s+1]),h[s]=n,h[s+1]=r;return e.transform=new a(c),e.transform}},a.prototype.lengthAt=function(t){},a.prototype.pointAt=function(t,e){var n,r,i,o,a,s,p,h=this.curve().segments;e=_.defaultTo(e,!1),a=0;for(var c=0,l=h.length;c<l;c++)if(r=h[c],"M"==r[0])i=r[1],o=r[2];else{if(s=Graph.curve([["M",i,o],r]),p=s.length(),a+p>t)return n=s.pointAt(s.t(t-a),e),s=null,n;a+=p,i=r[5],o=r[6],s=null}return s=Graph.curve([["M",i,o],r]),n=s.pointAt(1,e),s=null,n},a.prototype.segmentAt=function(t){var e,n,r,i,o=this.curve().segments,a=-1,s=0;return _.forEach(o,function(o,p){if("M"==o[0])e=o[1],n=o[2];else{if(i=Graph.curve([["M",e,n],o]),
e=i.x(),n=i.y(),r=i.length(),r+s>t)return a=p,!1;s+=r,i=null}}),a},a.prototype.length=function(){var t,e,n,r,i,o=this.curve().segments;r=0;for(var a=0,s=o.length;a<s;a++)t=o[a],"M"==t[0]?(e=t[1],n=t[2]):(i=Graph.curve([["M",e,n],t]),r+=i.length(),e=t[5],n=t[6],i=null);return r},a.prototype.slice=function(t,e){var n,r,i,o,a,s,p,h,c=this.curve().segments,l={};s=0,r="";for(var u=0,d=c.length;u<d;u++)i=c[u],"M"==i[0]?(o=i[1],a=i[2]):(p=Graph.curve([["M",o,a],i]),h=p.length(),s+h>length&&(n=p.pointAt(p.t(length-s)),r+=["C"+n.start.x,n.start.y,n.m.x,n.m.y,n.props.x,n.props.y],l.start=Graph.path(r),r=["M"+n.props.x,n.props.y+"C"+n.n.x,n.n.y,n.end.x,n.end.y,i[5],i[6]].join()),s+=h,o=i[5],a=i[6],p=null),r+=i.shift()+i;return l.end=Graph.path(r),l},a.prototype.vertices=function(){var t=Graph.lookup(this.toString(),"vertices",this.toValue());if(t.vertices)return t.vertices;var e=this.segments,n=[];return _.forEach(e,function(t){var e,r,i=t.length;"Z"!=t[0]&&("M"==t[0]?(e=t[1],r=t[2]):(e=t[i-2],r=t[i-1]),
n.push(Graph.point(e,r)))}),t.vertices=n,t.vertices},a.prototype.addVertext=function(t){var e,n,r,i,o=this.isSimple(),a=o?_.cloneDeep(this.segments):this.curve().segments,s=-1,p=t.props.x,h=t.props.y,c=0,l=0;return _.forEach(a,function(t,o){if("Z"!=t[0])if("M"==t[0])e=t[1],n=t[2];else if("L"==t[0]?(r=Graph.curve([["M",e,n],["C",e,n,e,n,t[1],t[2]]]),e=t[1],n=t[2]):(r=Graph.curve([["M",e,n],t]),e=r.x(),n=r.y()),i=r.clone(),i.segments[1][5]=p,i.segments[1][6]=h,c+=r.length(),l+=i.length(),l<=c)return s=o,!1}),s>-1&&(o?a.splice(s,0,["L",p,h]):a.splice(s,0,["C",p,h,p,h,p,h]),this.segments=a),this},a.prototype.intersect=function(t){return o(this,t,!0)>0},a.prototype.intersection=function(t,e){var n=o(this,t);return e?n:_.map(n,function(t){var e=Graph.point(t.x,t.y);return e.segment1=t.segment1,e.segment2=t.segment2,e.bezier1=t.bezier1,e.bezier2=t.bezier2,e})},a.prototype.intersectnum=function(t){return o(this,t,!0)},a.prototype.alpha=function(t){},a.prototype.contains=function(t){var e,n,r,i,o;
return i=t.props.x,o=t.props.y,e=this.bbox(),r=e.toJson(),n=new a([["M",i,o],["H",r.x2+10]]),e.contains(t)&&this.intersectnum(n)%2==1},a.prototype.nearest=function(t){var e,n,r,i,o,a=this.length(),s=20,p=1/0,h=Graph.util.taxicab;for(Graph.isPoint(t)&&(t=t.toJson()),o=0;o<a;o+=s)r=this.pointAt(o,!0),i=h(r,t),i<p&&(p=i,e=r,n=o);s/=2;for(var c,l,u,d,f,g;s>.5;)(u=n-s)>=0&&(f=h(c=this.pointAt(u,!0),t))<p?(e=c,n=u,p=f):(d=n+s)<=a&&(g=h(l=this.pointAt(d,!0),t))<p?(e=l,n=d,p=g):s/=2;return e.distance=n,e},a.prototype.isSimple=function(){var t=!0;return _.forEach(this.segments,function(e){if(!/[MLZ]/i.test(e[0]))return t=!1,!1}),t},a.prototype.moveTo=function(t,e){var n=this.segments;return n.length?(n[0][0]="M",n[0][1]=t,n[0][2]=e):n=[["M",t,e]],this},a.prototype.lineTo=function(t,e,n){var r=this.segments;if(n=_.defaultTo(n,!0),r){var i=r.length-1;"M"==r[i][0]||n?r.push(["L",t,e]):(r[i][1]=t,r[i][2]=e)}return this},a.prototype.toString=function(){return"Graph.lang.Path"},a.prototype.toValue=function(){
return Graph.util.segments2path(this.segments)},a.prototype.toArray=function(){return this.segments},a.prototype.clone=function(){var t=[];return _.forEach(this.segments,function(e){t.push(e.slice())}),new a(t)},Graph.isPath=function(t){return t instanceof Graph.lang.Path},Graph.path=function(t){return new Graph.lang.Path(t)}}(),function(){var t=Graph.lang.Matrix=function(t,e,n,r,i,o){this.props={},this.props.a=_.defaultTo(t,1),this.props.b=_.defaultTo(e,0),this.props.c=_.defaultTo(n,0),this.props.d=_.defaultTo(r,1),this.props.e=_.defaultTo(i,0),this.props.f=_.defaultTo(o,0)};t.defaults={props:{a:1,b:0,c:0,d:1,e:0,f:0}},t.extend=Graph.lang.Class.extend,t.prototype.constructor=t,t.prototype.x=function(t,e){return t*this.props.a+e*this.props.c+this.props.e},t.prototype.y=function(t,e){return t*this.props.b+e*this.props.d+this.props.f},t.prototype.get=function(t){return+this.props[t].toFixed(4)},t.prototype.multiply=function(t,e,n,r,i,o){var a,s,p,h,c=[[],[],[]],l=[[this.props.a,this.props.c,this.props.e],[this.props.b,this.props.d,this.props.f],[0,0,1]],u=[[t,n,i],[e,r,o],[0,0,1]];
for(Graph.isMatrix(t)&&(u=[[t.props.a,t.props.c,t.props.e],[t.props.b,t.props.d,t.props.f],[0,0,1]]),a=0;a<3;a++)for(s=0;s<3;s++){for(h=0,p=0;p<3;p++)h+=l[a][p]*u[p][s];c[a][s]=h}return this.props.a=c[0][0],this.props.b=c[1][0],this.props.c=c[0][1],this.props.d=c[1][1],this.props.e=c[0][2],this.props.f=c[1][2],this},t.prototype.invert=function(t){var e,n,r,i,o,a,s=this.props.a*this.props.d-this.props.b*this.props.c;return t=_.defaultTo(t,!1),e=this.props.d/s,n=-this.props.b/s,r=-this.props.c/s,i=this.props.a/s,o=(this.props.c*this.props.f-this.props.d*this.props.e)/s,a=(this.props.b*this.props.e-this.props.a*this.props.f)/s,t?new Graph.matrix(e,n,r,i,o,a):(this.props.a=e,this.props.b=n,this.props.c=r,this.props.d=i,this.props.e=o,this.props.f=a,this)},t.prototype.translate=function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.multiply(1,0,0,1,t,e),this},t.prototype.rotate=function(t,e,n){if(void 0===t){var r=this.delta(0,1),i=(this.delta(1,0),180/Math.PI*Math.atan2(r.y,r.x)-90),o=Graph.util.rad(i);
return{deg:i,rad:o}}t=Graph.util.rad(t),e=_.defaultTo(e,0),n=_.defaultTo(n,0);var a=+Math.cos(t).toFixed(9),s=+Math.sin(t).toFixed(9);return this.multiply(a,s,-s,a,e,n),this.multiply(1,0,0,1,-e,-n),this},t.prototype.scale=function(t,e,n,r){if(void 0===t){var i=this.props,t=Graph.util.hypo(i.a,i.b),e=Graph.util.hypo(i.c,i.d);return this.determinant()<0&&(t=-t),{x:t,y:e}}return e=_.defaultTo(e,t),(n||r)&&(n=_.defaultTo(n,0),r=_.defaultTo(r,0)),(n||r)&&this.multiply(1,0,0,1,n,r),this.multiply(t,0,0,e,0,0),(n||r)&&this.multiply(1,0,0,1,-n,-r),this},t.prototype.determinant=function(){return this.props.a*this.props.d-this.props.b*this.props.c},t.prototype.delta=function(t,e){return{x:t*this.props.a+e*this.props.c+0,y:t*this.props.b+e*this.props.d+0}},t.prototype.data=function(){var t=this.delta(0,1),e=this.delta(1,0),n=180/Math.PI*Math.atan2(t.y,t.x)-90,r=Graph.util.rad(n),i=Math.cos(r),o=Math.sin(r),a=Graph.util.hypo(this.props.a,this.props.b),s=Graph.util.hypo(this.props.c,this.props.d),p=Graph.util.rad(n);
return this.determinant()<0&&(a=-a),{x:this.props.e,y:this.props.f,dx:(this.props.e*i+this.props.f*o)/a,dy:(this.props.f*i+this.props.e*-o)/s,skewX:-n,skewY:180/Math.PI*Math.atan2(e.y,e.x),scaleX:a,scaleY:s,rotate:n,rad:p,sin:Math.sin(p),cos:Math.cos(p),a:this.props.a,b:this.props.b,c:this.props.c,d:this.props.d,e:this.props.e,f:this.props.f}},t.prototype.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get("a")+", M12="+this.get("c")+", M21="+this.get("b")+", M22="+this.get("d")+", Dx="+this.get("e")+", Dy="+this.get("f")+", sizingmethod='auto expand')"},t.prototype.toArray=function(){return[[this.get("a"),this.get("c"),this.get("e")],[this.get("b"),this.get("d"),this.get("f")],[0,0,1]]},t.prototype.toValue=function(){return _.format("matrix({0},{1},{2},{3},{4},{5})",this.get("a"),this.get("b"),this.get("c"),this.get("d"),this.get("e"),this.get("f"))},t.prototype.toString=function(){return"Graph.lang.Matrix"},t.prototype.clone=function(){return new t(this.props.a,this.props.b,this.props.c,this.props.d,this.props.e,this.props.f);
},Graph.isMatrix=function(t){return t instanceof Graph.lang.Matrix},Graph.matrix=function(t,e,n,r,i,o){return new Graph.lang.Matrix(t,e,n,r,i,o)}}(),function(){var t=Graph.collection.Point=function(t){this.items=t||[]};t.prototype.constructor=t,t.prototype.items=[],t.prototype.get=function(t){return this.items[t]},t.prototype.push=function(t){return this.items.push(t),t},t.prototype.pop=function(){var t=this.items.pop();return t},t.prototype.shift=function(){var t=this.items.shift();return t},t.prototype.first=function(){return _.head(this.items)},t.prototype.last=function(){return _.last(this.items)},t.prototype.clear=function(){return this.items=[],this},t.prototype.modify=function(t,e,n){var r=this.items[t];return r.props.x=e,r.props.y=n,r},t.prototype.each=function(t){_.forEach(this.items,t)},t.prototype.toArray=function(){return this.items},t.prototype.toJson=function(){return _.map(this.items,function(t){return t.toJson()})}}(),function(){var t=Graph.collection.Vector=Graph.extend({
items:[],constructor:function(t){this.items=_.map(t,function(t){return t.guid()})},has:function(t){var e=t.guid();return _.indexOf(this.items,e)>-1},not:function(e){var n=e.guid(),r=_.filter(this.items,function(t){return t!=n});return new t(r)},count:function(){return this.items.length},index:function(t){var e=t.guid();return _.indexOf(this.items,e)},push:function(t){var e=t.guid();return this.items.push(e),this.items.length},pop:function(){var t=this.items.pop();return Graph.registry.vector.get(t)},shift:function(){var t=this.items.shift();return Graph.registry.vector.get(t)},unshift:function(t){var e=t.guid();this.items.unshift(e)},insert:function(t,e){e===-1&&(e=0),this.items.splice(e,0,t.guid())},pull:function(t){var e=t.guid();_.pull(this.items,e)},clear:function(){this.items=[]},reverse:function(){return this.items.reverse(),this},each:function(t){_.forEach(this.items,function(e){var n=Graph.registry.vector.get(e);t.call(n,n)})},bbox:function(){for(var t,e,n=[],r=[],i=[],o=[],a=this.items.length-1;a>=0;a--)t=Graph.registry.vector.get(this.items[a]),
e=t.bbox().toJson(),n.push(e.x),r.push(e.y),i.push(e.x+e.width),o.push(e.y+e.height);return n=_.min(n),r=_.min(r),i=_.max(i),o=_.max(o),Graph.bbox({x:n,y:r,x2:i,y2:o,width:i-n,height:o-r})},toArray:function(){return _.map(this.items,function(t){return Graph.registry.vector.get(t)})},toString:function(){return"Graph.collection.Vector"}});Graph.collection.Vector.toString=function(){return"function(vectors)"};var e=["attr","remove"];_.forEach(e,function(e){!function(e){t.prototype[e]=function(){var t=_.toArray(arguments);return this.each(function(n){n[e].apply(n,t)}),this}}(e)})}(),function(){Graph.collection.Shape=Graph.extend({items:[],constructor:function(t){this.items=t||[]},count:function(){return this.items.length},index:function(t){var e=t.guid();return _.indexOf(this.items,e)},has:function(t){var e=t.guid();return _.indexOf(this.items,e)!==-1},push:function(t){var e=t.guid();return this.items.push(e),this.items.length},pop:function(){var t=this.items.pop();return Graph.registry.shape.get(t);
},shift:function(){var t=this.items.shift();return Graph.registry.shape.get(t)},unshift:function(t){return this.items.unshift(t),t},pull:function(t){var e=t.guid();_.pull(this.items,e)},last:function(){return _.last(this.items)},each:function(t){var e=this;_.forEach(e.items,function(e,n){var r=Graph.registry.shape.get(e);r&&t.call(r,r,n)})},toString:function(){return"Graph.collection.Shape"}});Graph.collection.Shape.toString=function(){return"function(shapes)"}}(),function(){var t=Graph.collection.Tree=function(t){var e=this;e.nodes=t,e.key=function(t){return t},e.bisect=_.bisector(function(t){return e.key(t)}).left};t.prototype.get=function(t){return this.nodes[t]},t.prototype.count=function(){return this.nodes.length},t.prototype.insert=function(t){var e=this.index(t),n=this.key(t);if(!this.nodes[e]||n!=this.key(this.nodes[e]))return this.nodes.splice(e,0,t),e},t.prototype.remove=function(t){var e=this.index(t);return this.nodes.splice(e,1),e},t.prototype.keygen=function(t){return this.key=t,
this},t.prototype.index=function(t){return this.bisect(this.nodes,this.key(t))},t.prototype.order=function(){return this.nodes.sort(_.ascendingKey(this.key)),this},t.prototype.root=function(){return this.nodes[0]},t.prototype.cascade=function(t,e){for(var n=this.index(t),r=this.nodes,i=this.nodes.length,o=0,a=n;a<i;a++)e(r[a],o),o++},t.prototype.bubble=function(t,e){for(var n=this.index(t),r=this.nodes,i=0,o=n;o>=0;o--)e(r[o],i),i++},t.prototype.toArray=function(){return this.nodes.slice()}}(),function(t,e){var n,r=/^<(svg|g|rect|text|path|line|tspan|circle|polygon|defs|marker)/i;Graph.dom=function(i,o,a){var s,p;if(void 0===n)try{n=new DOMParser}catch(t){n=null}return a=t.defaultTo(a,!1),void 0!==o&&Graph.isElement(o)&&(o=o.node()),t.isString(i)?r.test(i)?n&&(s='<g xmlns="'+Graph.config.xmlns.svg+'">'+i+"</g>",p=n.parseFromString(s,"text/xml").documentElement.childNodes[0],s=null,p=a?e(p):p):p=a?e(i,o):e(i,o)[0]:p=Graph.isHTML(i)||Graph.isSVG(i)?a?e(i):i:Graph.isElement(i)?a?i.query:i.query[0]:a?e(i,o):i,
o=null,p},Graph.dom.clone=function(t,e){return t.cloneNode(e)};var i=Graph.dom.Element=function(t){this.query=e(t)};i.prototype.is=function(t){return this.query.is(t)},i.prototype.node=function(){return this.query[0]},i.prototype.length=function(){return this.query.length},i.prototype.group=function(t){return void 0===t?this.query.data("component-group"):(this.query.data("component-group",t),this)},i.prototype.belong=function(t){return this.group()==t},i.prototype.attr=function(e,n){if(void 0===n)return this.query.attr(e);var r=this,i=this.query[0];if(Graph.isHTML(i))this.query.attr(e,n);else if(Graph.isSVG(i)){if(t.isPlainObject(e))return t.forOwn(e,function(t,e){r.attr(e,t)}),this;"xlink:"==e.substring(0,6)?i.setAttributeNS(Graph.config.xmlns.xlink,e.substring(6),t.toString(n)):i.setAttribute(e,t.toString(n))}return this},i.prototype.width=function(t){return void 0===t?this.query.width():(this.query.width(t),this)},i.prototype.outerHeight=function(t){return this.query.outerHeight(t)},
i.prototype.height=function(t){return void 0===t?this.query.height():(this.query.height(t),this)},i.prototype.show=function(){return this.query.show(),this},i.prototype.hide=function(){return this.query.hide(),this},i.prototype.offset=function(){return this.query.offset()},i.prototype.position=function(){return this.query.position()},i.prototype.css=function(t,e){return void 0===e?this.query.css(t):(this.query.css(t,e),this)},i.prototype.addClass=function(e){var n=this.query[0];if(Graph.isHTML(n))this.query.addClass(e);else if(Graph.isSVG(n)){var r=t.chain([]).concat(t.split(n.className.baseVal||""," ")).concat(t.split(e," ")).uniq().join(" ").trim().value();n.className.baseVal=r}return this},i.prototype.removeClass=function(t){var e=this.query[0];return Graph.isHTML(e)&&this.query.removeClass(t),this},i.prototype.hasClass=function(e){var n=this.query[0];if(Graph.isHTML(n))return this.query.hasClass(e);if(Graph.isSVG(n)){var r=t.split(n.className.baseVal," ");return r.indexOf(e)>-1}return!1;
},i.prototype.find=function(t){return new Graph.dom.Element(this.query.find(t))},i.prototype.parent=function(){return new Graph.dom.Element(this.query.parent())},i.prototype.closest=function(t){return new Graph.dom.Element(this.query.closest(t))},i.prototype.append=function(t){return void 0===t.query?this.query.append(t):this.query.append(t.query),this},i.prototype.prepend=function(t){return this.query.prepend(t.query),this},i.prototype.appendTo=function(t){return this.query.appendTo(t.query),this},i.prototype.prependTo=function(t){return this.query.prependTo(t.query),this},i.prototype.before=function(t){return this.query.before(t.query),this},i.prototype.after=function(t){return this.query.after(t.query),this},i.prototype.last=function(){return new Graph.dom.Element(this.query.last())},i.prototype.remove=function(){return this.query.remove(),this.query=null,this},i.prototype.detach=function(){return this.query=this.query.detach(),this},i.prototype.on=function(t,e,n,r,i){return this.query.on.call(this.query,t,e,n,r,i),
this},i.prototype.off=function(t,e,n){return this.query.off.call(this.query,t,e,n),this},i.prototype.trigger=function(t,e){return this.query.trigger(t,e),this},i.prototype.val=function(t){return void 0===t?this.query.val():(this.query.val(t),this)},i.prototype.text=function(t){return void 0===t?this.query.text():(this.query.text(t),this)},i.prototype.html=function(t){return void 0===t?this.query.html():(this.query.html(t),this)},i.prototype.focus=function(){return this.query.focus(),this},i.prototype.contextmenu=function(e){e=t.defaultTo(e,!0),e||this.query.on("contextmenu",function(t){return!1})},i.prototype.each=function(t){return this.query.each(t),this},i.prototype.empty=function(){return this.query.empty(),this},i.prototype.data=function(t,e){return void 0===e?this.query.data(t):(this.query.data(t,e),this)},i.prototype.prop=function(t,e){return void 0===e?this.query.data(t):(this.query.prop(t,e),this)},i.prototype.scrollTop=function(t){return void 0===t?this.query.scrollTop():(this.query.scrollTop(t),
this)},i.prototype.scrollLeft=function(t){return void 0===t?this.query.scrollLeft():(this.query.scrollLeft(t),this)},i.prototype.toString=function(){return"Graph.dom.Element"},i.guid=0,Graph.$=function(t,e){var n=Graph.dom(t,e,!0);return new Graph.dom.Element(n)}}(_,jQuery),function(){function t(e,n){var r,i=e.children().toArray();r=n.call(e,e),r=_.defaultTo(r,!0),r&&i.length&&_.forEach(i,function(e){t(e,n)})}function e(t,n){var r,i=t.parent();r=n.call(t,t),r=_.defaultTo(r,!0),r&&i&&e(i,n)}function n(t){return t.parentNode?"svg"==t.parentNode.nodeName?t.parentNode.getBoundingClientRect():n(t.parentNode):{top:0,left:0}}var r=Graph.svg.Vector=Graph.extend({tree:{container:null,paper:null,parent:null,children:null,next:null,prev:null},props:{id:null,guid:null,type:null,text:null,rotate:0,scaleX:1,scaleY:1,traversable:!0,selectable:!0,focusable:!1,snappable:!1,selected:!1,rendered:!1,state:null},attrs:{style:null,class:null},plugins:{transformer:null,collector:null,definer:null,animator:null,
resizer:null,reactor:null,dragger:null,dropper:null,network:null,history:null,sorter:null,panzoom:null,toolmgr:null,toolpad:null,snapper:null,editor:null},utils:{},graph:{matrix:null,layout:null},cached:{bbox:null,originalBBox:null,position:null,offset:null},elem:null,constructor:function(t,e){var n,i=this;i.graph.matrix=Graph.matrix(),i.tree.children=new Graph.collection.Vector,n="graph-elem-"+ ++r.guid,e=_.extend({id:n},i.attrs,e||{}),i.elem=Graph.$(document.createElementNS(Graph.config.xmlns.svg,t)),e.class?e.class=Graph.styles.VECTOR+" "+e.class:e.class=Graph.styles.VECTOR,i.attr(e),i.props.guid=i.props.id=n,i.props.type=t,n=null,i.elem.data(Graph.string.ID_VECTOR,i.props.guid),i.plugins.transformer=new Graph.plugin.Transformer(i).on("translate",_.bind(i.onTransformTranslate,i)).on("rotate",_.bind(i.onTransformRotate,i)).on("scale",_.bind(i.onTransformScale,i)),i.isPaper()&&(i.plugins.toolmgr=new Graph.plugin.ToolManager(i).on("activate",_.bind(i.onActivateTool,i)).on("deactivate",_.bind(i.onDeactivateTool,i))),
Graph.registry.vector.register(this)},matrix:function(){return this.graph.matrix},globalMatrix:function(){var t,e=this.node().getCTM();return e?(t=new Graph.lang.Matrix(e.a,e.b,e.c,e.d,e.e,e.f),e=null):t=this.matrix().clone(),t},layout:function(t){if(void 0===t)return this.graph.layout;var e,n;return t="default"==t?"layout":t,_.isString(t)?(e=Graph.layout[_.capitalize(t)],n=Graph.factory(e,[this])):_.isPlainObject(t)&&t.name&&(e=Graph.layout[_.capitalize(t.name)],delete t.name,n=Graph.factory(e,[this,t])),n.refresh(),this.graph.layout=n,this},reset:function(){this.graph.matrix=Graph.matrix(),this.removeAttr("transform"),this.props.rotate=0,this.props.scale=0,this.dirty(!0),this.fire("reset",this.props),this.dragger&&this.dragger.rotate(0)},invalidate:function(t){this.cached[t]=null},state:function(t){return void 0===t?this.props.state:(this.props.state=t,this)},dirty:function(t){var e=this;if(void 0===t)return null===e.cached.bbox;if(t){for(var n in this.cached)e.cached[n]=null;var r=["resizer","network"];
_.forEach(r,function(t){e.plugins[t]&&e.plugins[t].invalidate()})}return this},interactable:function(t){return this.plugins.reactor||(this.plugins.reactor=new Graph.plugin.Reactor(this,t)),this.plugins.reactor},animable:function(){var t=this;return t.plugins.animator||(t.plugins.animator=new Graph.plugin.Animator(t),t.plugins.animator.on({animstart:function(e){t.fire(e)},animating:function(e){t.fire(e)},animend:function(e){t.fire(e)}})),t.plugins.animator},resizable:function(t){return this.plugins.resizer||(this.plugins.resizer=new Graph.plugin.Resizer(this,t),this.plugins.resizer.on({resize:_.bind(this.onResizerResize,this)})),this.plugins.resizer},draggable:function(t){return this.plugins.dragger||(this.plugins.dragger=new Graph.plugin.Dragger(this,t),this.plugins.dragger.on({dragstart:_.bind(this.onDraggerStart,this),dragmove:_.bind(this.onDraggerMove,this),dragend:_.bind(this.onDraggerEnd,this)})),this.plugins.dragger},zoomable:function(){return this.plugins.panzoom||(this.plugins.panzoom=new Graph.plugin.Panzoom(this),
this.plugins.toolmgr.register("panzoom")),this.plugins.panzoom},droppable:function(){return this.plugins.dropper||(this.plugins.dropper=new Graph.plugin.Dropper(this),this.plugins.dropper.on({dropenter:_.bind(this.onDropperEnter,this),dropleave:_.bind(this.onDropperLeave,this)})),this.plugins.dropper},sortable:function(t){return this.plugins.sorter||(this.plugins.sorter=new Graph.plugin.Sorter(this,t)),this.plugins.sorter},connectable:function(t){return this.plugins.network?t&&this.plugins.network.options(t):this.plugins.network=new Graph.plugin.Network(this,t),this.plugins.network},traversable:function(t){return t=_.defaultTo(t,!0),this.props.traversable=t,this},selectable:function(t){return t=_.defaultTo(t,!0),this.props.selectable=t,this},clickable:function(t){var e=this;return void 0===t?e.attrs["pointer-events"]||"visiblePainted":(t?this.attr("pointer-events",""):this.attr("pointer-events","none"),this)},editable:function(t){var e=this;return this.plugins.editor||(this.plugins.editor=new Graph.plugin.Editor(this,t),
this.plugins.editor.on({beforeedit:function(t){e.fire(t)},edit:function(t){e.fire(t)}})),this.plugins.editor},snappable:function(t){var e,n=this;return t=_.isBoolean(t)?{context:n,enabled:t}:_.extend({context:n,enabled:!0},t||{}),n.props.snappable=t.enabled,n.props.rendered?(e=n.paper().plugins.snapper,e.setup(n,t)):n.on("render",function(){e=n.paper().plugins.snapper,e.setup(n,t)}),n},id:function(){return this.props.id},guid:function(){return this.props.guid},node:function(){return this.elem.node()},data:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.props[e]=t}),this):void 0===t&&void 0===e?n.props:void 0===e?n.props[t]:(n.props[t]=e,this)},attr:function(t,e){var n=this,r=n.node();return _.isPlainObject(t)?(_.forOwn(t,function(t,e){!function(t,e){n.attr(e,t)}(t,e)}),n):void 0===t?n.attrs:void 0===e?n.attrs[t]||"":(n.attrs[t]=e,null!==e&&("xlink:"==t.substring(0,6)?r.setAttributeNS(Graph.config.xmlns.xlink,t.substring(6),_.toString(e)):"class"==t?r.className.baseVal=_.toString(e):r.setAttribute(t,_.toString(e))),
n)},removeAttr:function(t){return this.node().removeAttribute(t),this.attrs[t]&&delete this.attrs[t],this},style:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.style(e,t)}),this):(this.elem.css(t,e),this)},cursor:function(t){this.elem.css("cursor",t)},hasClass:function(t){return _.indexOf(_.split(this.attrs.class," "),t)>-1},addClass:function(t){var e=_.chain(this.attrs.class).split(" ").concat(_.split(t," ")).uniq().join(" ").trim().value();return this.attr("class",e),this},removeClass:function(t){var e=_.split(this.attrs.class," "),n=_.isArray(t)?t:_.split(t," ");return _.pullAll(e,n),this.attr("class",_.join(e," ")),this},hide:function(){this.elem.hide()},show:function(){this.elem.show()},pathinfo:function(){return new Graph.lang.Path([])},vertices:function(t){var e,n,r,i;return t=_.defaultTo(t,!1),e=t?this.globalMatrix():this.matrix(),n=this.pathinfo().transform(e),r=n.segments,i=[],_.forEach(r,function(t){var e,n;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],
i.push([e,n]))}),i},dimension:function(){var t={},e=this.node();try{t=e.getBBox()}catch(n){t={x:e.clientLeft,y:e.clientTop,width:e.clientWidth,height:e.clientHeight}}finally{t=t||{}}return t},offset:function(){var t=this.node(),e=t.getBoundingClientRect(),n={top:e.top,left:e.left,bottom:e.bottom,right:e.right,width:e.width,height:e.height};return n},position:function(){if(!this.cached.position){var t=this.node(),e=t.getBoundingClientRect(),r=n(t);this.cached.position={top:e.top-r.top,left:e.left-r.left,bottom:e.bottom-r.top,right:e.right-r.left,width:e.width,height:e.height}}return this.cached.position},bbox:function(t){var e,n;return t=_.defaultTo(t,!1),t?(n=this.cached.originalBBox,n||(e=this.pathinfo(),n=e.bbox(),this.cached.originalBBox=n)):(n=this.cached.bbox,n||(e=this.pathinfo().transform(this.matrix()),n=e.bbox(),this.cached.bbox=n)),e=null,n},find:function(t){var e=this.elem.find(t),n=[];return e.each(function(t,e){n.push(Graph.registry.vector.get(e))}),new Graph.collection.Vector(n);
},render:function(t,e,n){var r,i=this,o=i.guid(),a=i.props.traversable;if(i.props.rendered)return i;if(t=_.defaultTo(t,i.paper()),e=_.defaultTo(e,"append"),t){switch(t.isPaper()&&(t=t.viewport()),i.tree.paper=t.tree.paper,a&&(i.tree.parent=t.guid()),e){case"before":if(!n)throw Graph.error("vector.render(): Sibling vector is undefined");n.elem.query.before(i.elem.query),a&&(r=t.children().index(n),t.children().insert(i,r));break;case"after":if(!n)throw Graph.error("vector.render(): Sibling vector is undefined");n.elem.query.after(i.elem.query),a&&(r=t.children().index(n),t.children().insert(i,r+1));break;case"append":t.elem.query.append(i.elem.query),a&&t.children().push(i);break;case"prepend":t.elem.query.prepend(i.elem.query),a&&t.children().unshift(i)}if(t.props.rendered){i.props.rendered=!0,i.fire("render");var s=t.isViewport()?t.paper():null;s&&Graph.registry.vector.setContext(o,i.tree.paper),i.cascade(function(t){t===i||t.props.rendered||(t.props.rendered=!0,t.tree.paper=i.tree.paper,
t.fire("render"),s&&Graph.registry.vector.setContext(t.props.guid,i.tree.paper))})}}return i},children:function(){return this.tree.children},attach:function(t,e){if(!this.isContainer())return this;if(e=_.defaultTo(e,"append"),t.isRendered()){var n=this.isPaper()?this.viewport():this,r=t.isTraversable();if(r){var i=t.parent();i&&(i.children().pull(t),t.tree.parent=null)}if(n.elem[e](t.elem),r){switch(e){case"append":n.children().push(t);break;case"prepend":n.children().unshift(t)}t.tree.parent=this.guid()}}else t.render(this,e);return this},detach:function(){return this.elem.detach(),this},append:function(t){return this.attach(t,"append")},prepend:function(t){return this.attach(t,"prepend")},ancestors:function(){var t=[],e=this.guid();return this.bubble(function(n){n.guid()!=e&&t.push(n)}),new Graph.collection.Vector(t)},descendants:function(){var t=[],e=this.guid();return this.cascade(function(n){n.guid()!=e&&t.push(n)}),new Graph.collection.Vector(t)},paper:function(){return this.isPaper()?this:Graph.registry.vector.get(this.tree.paper);
},parent:function(){return Graph.registry.vector.get(this.tree.parent)},prev:function(){return Graph.registry.vector.get(this.tree.prev)},next:function(){return Graph.registry.vector.get(this.tree.next)},cascade:function(e){t(this,e)},bubble:function(t){return e(this,t)},remove:function(){var t=this.parent();this.lasso&&this.lasso.decollect(this);for(var e in this.plugins)this.plugins[e]&&(this.plugins[e].destroy(),this.plugins[e]=null);t&&t.children().pull(this),this.elem&&(this.elem.remove(),this.elem=null),Graph.registry.vector.unregister(this),this.fire("remove"),this.listeners=null},empty:function(){var t=this.guid();return this.cascade(function(e){e.guid()!=t&&Graph.registry.vector.unregister(e)}),this.children().clear(),this.elem.empty(),this},select:function(t){return this.addClass("graph-selected"),this.props.selected=!0,t=_.defaultTo(t,!1),this.fire("select",{batch:t}),t||this.plugins.resizer&&this.plugins.resizer.resume(),this},deselect:function(t){return this.removeClass("graph-selected"),
this.props.selected=!1,t=_.defaultTo(t,!1),this.fire("deselect",{batch:t}),this.plugins.resizer&&this.plugins.resizer.suspend(),this},transform:function(t){return this.plugins.transformer.transform(t)},translate:function(t,e){return this.plugins.transformer.translate(t,e)},scale:function(t,e,n,r){return void 0===t?this.globalMatrix().scale():this.plugins.transformer.scale(t,e,n,r)},rotate:function(t,e,n){return this.plugins.transformer.rotate(t,e,n)},animate:function(t,e,n,r){return this.plugins.animator?(this.plugins.animator.animate(t,e,n,r),this.plugins.animator):null},label:function(t){return this.elem.text(t),this},sendToFront:function(){return this.tree.paper?(this.paper().elem.append(this.elem),this):this},sendToBack:function(){return this.tree.paper?(this.paper().elem.prepend(this.elem),this):this},resize:function(t,e,n,r,i,o){return this},isContainer:function(){return this.isGroup()||this.isPaper()},isGroup:function(){return"g"==this.props.type},isPaper:function(){return"svg"==this.props.type;
},isViewport:function(){return this.props.viewport===!0},isTraversable:function(){return this.props.traversable},isSelectable:function(){return this.props.selectable},isDraggable:function(){return null!==this.plugins.dragger},isResizable:function(){return null!==this.plugins.resizer},isConnectable:function(){return!!this.plugins.network},isSnappable:function(){return this.props.snappable},isRendered:function(){return this.props.rendered},tool:function(){return this.plugins.toolmgr},toString:function(){return"Graph.svg.Vector"},onResizerResize:function(t){this.dirty(!0),this.fire(t),Graph.topic.publish("vector/resize",t)},onDraggerStart:function(t){this.fire(t),this.lasso&&this.lasso.syncDragStart(this,t),this.plugins.resizer&&this.plugins.resizer.suspend(),this.plugins.editor&&this.plugins.editor.suspend()},onDraggerMove:function(t){this.fire(t),this.lasso&&this.lasso.syncDragMove(this,t)},onDraggerEnd:function(t){this.dirty(!0),this.fire(t),Graph.topic.publish("vector/dragend",t),this.plugins.resizer&&(this.plugins.resizer.resume(),
this.props.selected||this.plugins.resizer.suspend()),this.lasso&&this.lasso.syncDragEnd(this,t)},onDropperEnter:function(t){this.fire(t)},onDropperLeave:function(t){this.fire(t)},onTransformRotate:function(t){if(this.dirty(!0),this.props.rotate=t.deg,this.fire("rotate",{deg:t.deg}),this.plugins.dragger){var e=this.globalMatrix().rotate();this.plugins.dragger.rotate(e.deg)}},onTransformTranslate:function(t){this.dirty(!0),this.fire("translate",{dx:t.dx,dy:t.dy})},onTransformScale:function(t){if(this.dirty(!0),this.props.scaleX=t.sx,this.props.scaleY=t.sy,this.fire("scale",{sx:t.sx,sy:t.sy}),this.plugins.dragger){var e=this.globalMatrix().scale();this.plugins.dragger.scale(e.x,e.y)}},onActivateTool:function(t){var e=t.originalData;this.fire("activatetool",e)},onDeactivateTool:function(t){var e=t.originalData;this.fire("deactivatetool",e)}});r.toString=function(){return"function(tag)"},r.guid=0,Graph.isVector=function(t){return t instanceof Graph.svg.Vector}}(),function(){Graph.svg.Ellipse=Graph.extend(Graph.svg.Vector,{
constructor:function(t,e,n,r){this.superclass.prototype.constructor.call(this,"ellipse",{cx:t,cy:e,rx:n,ry:r})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.ry],["a",t.rx,t.ry,0,1,1,0,2*t.ry],["a",t.rx,t.ry,0,1,1,0,-2*t.ry],["z"]])},resize:function(t,e,n,r,i,o){var a,s,p=this.graph.matrix.clone().scale(t,e,n,r),h=this.props.rotate,c=p.x(this.attrs.cx,this.attrs.cy),l=p.y(this.attrs.cx,this.attrs.cy),u=this.attrs.rx*t,d=this.attrs.ry*e;this.reset(),this.attr({cx:c,cy:l,rx:u,ry:d}),h&&this.rotate(h,c,l).commit();var f=this.bbox().toJson();return a=c-u-i,s=l-d-o,a=f.x,s=f.y,{matrix:p,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:h,cx:c,cy:l},magnify:{cx:a,cy:s}}},toString:function(){return"Graph.svg.Ellipse"}}),Graph.svg.Ellipse.toString=function(){return"function(cx, cy, rx, ry)"}}(),function(){Graph.svg.Circle=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n){var r=this;Graph.isPoint(t)&&(n=e,e=t.props.y,t=t.props.x),r.superclass.prototype.constructor.call(r,"circle",{
cx:t,cy:e,r:n})},pathinfo:function(){var t=this.attrs;return Graph.path([["M",t.cx,t.cy],["m",0,-t.r],["a",t.r,t.r,0,1,1,0,2*t.r],["a",t.r,t.r,0,1,1,0,-2*t.r],["z"]])},resize:function(t,e,n,r,i,o){var a,s,p,h=this.graph.matrix.clone(),c=this.props.rotate,l=this.attrs.cx,u=this.attrs.cy,d=this.attrs.r;return 1===e?(p=d*t,e=t):1===t?(p=d*e,t=e):t<e?(p=d*e,t=e):t>e&&(p=d*t,e=t),h.scale(t,e,n,r),a=h.x(l,u),s=h.y(l,u),this.reset(),this.attr({cx:a,cy:s,r:p}),c&&this.rotate(c,a,s).commit(),{matrix:h,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:c,cx:a,cy:s}}},toString:function(){return"Graph.svg.Circle"}}),Graph.svg.Circle.toString=function(){return"function(cx, cy, r)"}}(),function(){Graph.svg.Rect=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n,r,i){var o=this;i=_.defaultTo(i,6),o.superclass.prototype.constructor.call(o,"rect",{x:_.defaultTo(t,0),y:_.defaultTo(e,0),rx:i,ry:i,width:_.defaultTo(n,0),height:_.defaultTo(r,0)}),o.origpath=o.pathinfo()},attr:function(t,e){
var n=this.superclass.prototype.attr.apply(this,[t,e]);return"rx"==t&&void 0!==e&&(this.attrs.r=this.attrs.rx),n},pathinfo:function(){var t,e=this.attrs;return t=e.r?Graph.path([["M",e.x+e.r,e.y],["l",e.width-2*e.r,0],["a",e.r,e.r,0,0,1,e.r,e.r],["l",0,e.height-2*e.r],["a",e.r,e.r,0,0,1,-e.r,e.r],["l",2*e.r-e.width,0],["a",e.r,e.r,0,0,1,-e.r,-e.r],["l",0,2*e.r-e.height],["a",e.r,e.r,0,0,1,e.r,-e.r],["z"]]):Graph.path([["M",e.x,e.y],["l",e.width,0],["l",0,e.height],["l",-e.width,0],["z"]])},resize:function(t,e,n,r,i,o){var a,s,p,h,c=this.matrix().clone(),l=c.rotate().deg;return c.scale(t,e,n,r),this.reset(),a=c.x(this.attrs.x,this.attrs.y),s=c.y(this.attrs.x,this.attrs.y),p=this.attrs.width*t,h=this.attrs.height*e,this.attr({x:a,y:s,width:p,height:h}),l&&this.rotate(l,a,s).commit(),{matrix:c,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:l,cx:a,cy:s}}},toString:function(){return"Graph.svg.Rect"}}),Graph.svg.Rect.toString=function(){return"function(x, y, width, height, r)"};
}(),function(){Graph.svg.Path=Graph.extend(Graph.svg.Vector,{constructor:function(t){t||(t=[["M",0,0]]),t=_.isArray(t)?Graph.path(Graph.util.segments2path(t)).absolute().toValue():t instanceof Graph.lang.Path?t.toValue():Graph.path(t).absolute().toValue(),this.superclass.prototype.constructor.call(this,"path",{d:t})},pathinfo:function(){return Graph.path(this.attrs.d)},segments:function(){return this.pathinfo().segments},intersection:function(t,e){return this.pathinfo().intersection(t.pathinfo(),e)},intersectnum:function(t){return this.pathinfo().intersectnum(t.pathinfo())},angle:function(){var t=_.clone(this.segments()),e=t.length-1;"Z"==t[e][0]&&(e--,t.pop()),1===t.length&&(e++,t.push(["L",t[0][1],t[0][2]]));var n=t[e][1]-t[e-1][1],r=t[e][2]-t[e-1][2];return(180+180*Math.atan2(-r,-n)/Math.PI+360)%360},slice:function(t,e){return this.pathinfo().slice(t,e)},pointAt:function(t){return this.pathinfo().pointAt(t)},length:function(){return this.pathinfo().length()},addVertext:function(t){var e=this.pathinfo();
return e.addVertext(t),this.attr("d",e.command()),this},resize:function(t,e,n,r,i,o){var a=this.matrix().clone(),s=matrix.rotate(),p=s.deg,h=s.rad,c=(Math.sin(h),Math.cos(h),this.pathinfo()),l=c.segments,u=l[0][1],d=l[0][2];return p&&a.rotate(-p,u,d),u=a.x(l[0][1],l[0][2]),d=a.y(l[0][1],l[0][2]),a.scale(t,e,n,r),_.forEach(l,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=a.x(e,n),i=a.y(e,n),t[t.length-2]=r,t[t.length-1]=i)}),this.reset(),this.attr("d",c.command()),p&&this.rotate(p,u,d).commit(!0),{matrix:a,x:u,y:d}},moveTo:function(t,e){var n=this.pathinfo();return n.moveTo(t,e),this.attr("d",n.command()),this},lineTo:function(t,e,n){var r=this.pathinfo();return r.lineTo(t,e,n),this.attr("d",r.command()),this},tail:function(){var t=this.segments();return t.length?Graph.point(t[0][1],t[0][2]):null},head:function(){var t,e=this.segments();return e.length?(t=e.length-1,Graph.point(e[t][1],e[t][2])):null},toString:function(){return"Graph.svg.Path"}}),Graph.svg.Path.toString=function(){
return"function(d)"}}(),function(){Graph.svg.Polyline=Graph.extend(Graph.svg.Vector,{constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polyline",{points:t})},pathinfo:function(){var t=Graph.util.polygon2path(this.attrs.points);return t=t.replace(/Z/i,""),Graph.path(t)},attr:function(t,e){return"points"==t&&_.isArray(e)&&(e=_.join(_.map(e,function(t){return t[0]+","+t[1]})," ")),this.superclass.prototype.attr.call(this,t,e)},toString:function(){return"Graph.svg.Polyline"}}),Graph.svg.Polyline.toString=function(){return"function(points)"}}(),function(){Graph.svg.Polygon=Graph.extend(Graph.svg.Vector,{constructor:function(t){t=_.defaultTo(t,""),_.isArray(t)&&(t.length?(_.isPlainObject(t[0])&&(t=_.map(t,function(t){return t.x+","+t.y})),t=_.join(t,",")):t=""),this.superclass.prototype.constructor.call(this,"polygon",{points:t})},attr:function(t,e){
return"points"==t&&_.isArray(e)&&(e=_.join(e,",")),this.superclass.prototype.attr.call(this,t,e)},pathinfo:function(){var t=Graph.util.polygon2path(this.attrs.points);return Graph.path(t)},resize:function(t,e,n,r,i,o){var a=this.graph.matrix.clone(),s=this.graph.matrix.clone(),p=this.props.rotate,h=this.pathinfo().segments,c=[],l=h[0][1],u=h[0][2];return p&&(s.rotate(-p,h[0][1],h[0][2]),l=s.x(h[0][1],h[0][2]),u=s.y(h[0][1],h[0][2])),s.scale(t,e,n,r),a.scale(t,e,n,r),_.forEach(h,function(t){var e,n,r,i;"Z"!=t[0]&&(e=t[t.length-2],n=t[t.length-1],r=s.x(e,n),i=s.y(e,n),c.push(r+","+i))}),c=_.join(c," "),this.reset(),this.attr("points",c),p&&this.rotate(p,l,u).commit(),{matrix:a,translate:{dx:i,dy:o},scale:{sx:t,sy:e,cx:n,cy:r},rotate:{deg:p,cx:l,cy:u}}},toString:function(){return"Graph.svg.Polygon"}}),Graph.svg.Polygon.toString=function(){return"function(points)"}}(),function(){Graph.svg.Group=Graph.extend(Graph.svg.Vector,{attrs:{stroke:null,"stroke-width":null,class:null,fill:null,style:null
},constructor:function(t,e){this.superclass.prototype.constructor.call(this,"g"),void 0!==t&&void 0!==e&&(this.graph.matrix.translate(t,e),this.attr("transform",this.graph.matrix.toValue()))},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},toString:function(){return"Graph.svg.Group"}}),Graph.svg.Group.toString=function(){return"function(x, y)"}}(),function(){Graph.svg.Text=Graph.extend(Graph.svg.Vector,{attrs:{"text-anchor":"middle"},props:{id:"",guid:"",text:"",type:"text",rotate:0,lineHeight:1,fontSize:12,traversable:!0,focusable:!1,selectable:!0,selected:!1,rendered:!1},rows:[],constructor:function(t,e,n){this.superclass.prototype.constructor.call(this,"text",{x:_.defaultTo(t,0),y:_.defaultTo(e,0)}),this.attr({"font-size":Graph.config.font.size}),n&&this.write(n),this.on("render",_.bind(this.onTextRender,this))},attr:function(t,e){var n=this.superclass.prototype.attr.apply(this,[t,e]);return"font-size"==t&&void 0!==e&&(this.props.fontSize=_.parseInt(e)||12),
n},write:function(t){var e,n=this;return void 0===t?n.props.text:(e=(t||"").split("\n"),n.empty(),n.rows=[],_.forEach(e,function(t,e){n.addSpan(t)}),n.props.text=t,void(n.cached.bbox=null))},addSpan:function(t){var e,n=this;return t=_.defaultTo(t,""),e=Graph.$("<tspan/>"),e.text(t),n.elem.append(e),n.rows.push(e),e},arrange:function(){var t=this.rows,e=this.props.fontSize,n=this.props.lineHeight;this.bbox().toJson();if(t.length){for(var r=0,i=t.length;r<i;r++)r&&(t[r].attr("x",this.attrs.x),t[r].attr("dy",e*n));t[0].attr("dy",0)}},wrap:function(t){var e,n,r=this.props.text,i=r.split(/\s+/).reverse(),o=[],a=0,s=this.props.lineHeight,p=this.attrs.x,h=this.attrs.y,c=0;for(this.empty(),this.rows=[],n=this.addSpan(),n.attr({x:p,y:h,dy:c+"em"});e=i.pop();)o.push(e),n.text(o.join(" ")),n.node().getComputedTextLength()>t&&(o.pop(),n.text(o.join(" ")),o=[e],n=this.addSpan(e),n.attr({x:p,y:h,dy:++a*s+"em"}))},center:function(t){if(t){var e,n,r,i,o,a=t.bbox().toJson(),s=this.matrix().rotate();this.reset(),
e=this.bbox().toJson(),n=a.width/2,r=a.height/2,i=e.x+e.width/2,o=e.y+e.height/2,s.deg?this.translate(n,r).rotate(s.deg).commit():this.translate(n,r).commit()}},pathinfo:function(){var t=this.dimension();return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},toString:function(){return"Graph.svg.Text"},onTextRender:function(){var t=this;t.arrange()}}),Graph.svg.Text.toString=function(){return"function(x, y, text)"}}(),function(){Graph.svg.Image=Graph.extend(Graph.svg.Vector,{attrs:{preserveAspectRatio:"none"},constructor:function(t,e,n,r,i){var o=this;o.superclass.prototype.constructor.call(o,"image",{"xlink:href":t,x:_.defaultTo(e,0),y:_.defaultTo(n,0),width:_.defaultTo(r,0),height:_.defaultTo(i,0)})},align:function(t,e){if("none"==t)return this.attr("preserveAspectRatio","none"),this;var n=this.attrs.preserveAspectRatio,r="";switch(n=/(meet|slice)/.test(n)?n.replace(/(.*)\s*(meet|slice)/i,"$2"):"",e=_.defaultTo(e,n),t=t.replace(/s+/," ").toLowerCase()){
case"top left":case"left top":r="xMinYMin";break;case"top center":case"center top":r="xMidYMin";break;case"top right":case"right top":r="xMaxYMin";break;case"left":r="xMinYMid";break;case"center":r="xMidYMid";break;case"right":r="xMaxYMid";break;case"bottom left":case"left bottom":r="xMinYMax";break;case"bottom center":case"center bottom":r="xMidYMax";break;case"bottom right":case"right bottom":r="xMaxYMax"}return n=r+(e?" "+e:""),this.attr("preserveAspectRatio",n),this},pathinfo:function(){var t=this.attrs;return new Graph.lang.Path([["M",t.x,t.y],["l",t.width,0],["l",0,t.height],["l",-t.width,0],["z"]])},resize:function(t,e,n,r,i,o){var a=this.graph.matrix.clone().scale(t,e,n,r),s=this.graph.matrix.rotate();this.reset();var p=a.x(this.attrs.x,this.attrs.y),h=a.y(this.attrs.x,this.attrs.y),c=+this.attrs.width*t,l=+this.attrs.height*e;return this.attr({x:p,y:h,width:c,height:l}),this.rotate(s,p,h).commit(),{matrix:a,x:p,y:h}},toString:function(){return"Graph.svg.Image"}}),Graph.svg.Image.toString=function(){
return"function(src, x, y, width, height)"}}(),function(){Graph.svg.Line=Graph.extend(Graph.svg.Vector,{constructor:function(t,e,n,r){var i=_.toArray(arguments);if(1===i.length){var o=i[0].start().toJson(),a=i[0].end().toJson();t=o.x,e=o.y,n=a.x,r=a.y}else 2===i.length&&(Graph.isPoint(i[0])?(t=i[0].props.x,e=i[0].props.y,n=i[1].props.x,r=i[1].props.y):(t=i[0].x,e=i[0].y,n=i[1].x,r=i[1].y));this.superclass.prototype.constructor.call(this,"line",{x1:_.defaultTo(t,0),y1:_.defaultTo(e,0),x2:_.defaultTo(n,0),y2:_.defaultTo(r,0)})},toString:function(){return"Graph.svg.Line"}}),Graph.svg.Line.toString=function(){return"function(x1, y1, x2, y2)"}}(),function(){var t=Graph.svg.Paper=Graph.extend(Graph.svg.Vector,{attrs:{class:Graph.styles.PAPER},props:{id:null,guid:null,type:"paper",text:null,rotate:0,traversable:!1,selectable:!1,selected:!1,focusable:!1,rendered:!1,showOrigin:!0,zoomable:!0},components:{viewport:null},constructor:function(t,e,n){var r=this;r.superclass.prototype.constructor.call(r,"svg",{
xmlns:Graph.config.xmlns.svg,"xmlns:link":Graph.config.xmlns.xlink,version:Graph.config.svg.version}),_.assign(r.props,n||{}),r.style({overflow:"hidden",position:"relative"}),r.interactable(),r.initLayout(),r.plugins.collector=new Graph.plugin.Collector(r),r.plugins.toolmgr.register("collector","plugin"),r.plugins.linker=new Graph.plugin.Linker(r),r.plugins.toolmgr.register("linker","plugin"),r.plugins.pencil=new Graph.plugin.Pencil(r),r.plugins.definer=new Graph.plugin.Definer(r),r.plugins.snapper=new Graph.plugin.Snapper(r),r.plugins.toolpad=new Graph.plugin.Toolpad(r),r.on("pointerdown",_.bind(r.onPointerDown,r)),r.on("keynavdown",_.bind(r.onKeynavDown,r)),r.on("keynavup",_.bind(r.onKeynavUp,r)),Graph.topic.subscribe("link/update",_.bind(r.listenLinkUpdate,r)),Graph.topic.subscribe("link/remove",_.bind(r.listenLinkRemove,r)),Graph.topic.subscribe("shape/draw",_.bind(r.listenShapeDraw,r))},initLayout:function(){var t=(new Graph.svg.Group).addClass(Graph.styles.VIEWPORT).selectable(!1);
if(t.props.viewport=!0,this.components.viewport=t.guid(),this.props.showOrigin){var e=Graph.$('<g class="graph-origin"><rect class="x" rx="1" ry="1" x="-16" y="-1" height="1" width="30"></rect><rect class="y" rx="1" ry="1" x="-1" y="-16" height="30" width="1"></rect><text class="t" x="-40" y="-10">(0, 0)</text></g>');e.appendTo(t.elem),e=null}t.tree.paper=t.tree.parent=this.guid(),t.translate(.5,.5).commit(),this.elem.append(t.elem),this.children().push(t),t.on("render",function(){t.cascade(function(e){e===t||e.props.rendered||(e.props.rendered=!0,e.tree.paper=t.tree.paper,e.fire("render"))})}),this.layout("default")},layout:function(t){var e=this.viewport();return void 0===t?e.graph.layout:(e.layout(t),this)},shape:function(t,e){var n=Graph.shape(t,e);return n.render(this),n},render:function(t){var e=this,n=e.viewport();e.guid();if(!e.props.rendered){if(t=Graph.$(t),t.append(e.elem),e.tree.container=t,e.elem.css({width:"100%",height:"100%"}),e.props.rendered=!0,e.fire("render"),n.props.rendered=!0,
n.fire("render"),e.props.zoomable){e.zoomable();var r=_.debounce(function(){r.flush(),r=null,e.tool().activate("panzoom")},1e3);r()}return e}},container:function(){return this.tree.container},selections:function(){return this.plugins.collector.selections},removeSelection:function(){for(var t,e=this.plugins.collector.collection,n=e.length-1;n>=0;n--)t=e[n],e.splice(n,1),t.remove()},viewport:function(){return Graph.registry.vector.get(this.components.viewport)},scale:function(t,e,n,r){return void 0===t?this.viewport().matrix().scale():this.plugins.transformer.scale(t,e,n,r)},width:function(){return this.elem.width()},height:function(){return this.elem.height()},connect:function(t,e,n,r,i){var o,a,s;return n&&(Graph.isPoint(n)||(i=n,n=null,r=null)),t=Graph.isShape(t)?t.provider("network"):t,e=Graph.isShape(e)?e.provider("network"):e,o=this.layout(),a=o.createRouter(t,e,i),s=o.createLink(a),s.connect(n,r),s.render(this),s},addPallet:function(t){t.bindPaper(this)},removePallet:function(t){t.unbindPaper(this);
},parse:function(t){var e=this,n={};_.forEach(t.shapes,function(t){!function(t){var r=Graph.shape(t.type,t.data);r.render(e),n[t.data.id]=r}(t)}),_.forEach(t.links,function(t){!function(t){e.connect(n[t.source],n[t.target])}(t)})},save:function(){alert("save")},diagram:function(t){},toString:function(){return"Graph.svg.Paper"},onPointerDown:function(t){},onKeynavDown:function(t){var e=this,n=t.keyCode;switch(n){case Graph.event.DELETE:e.removeSelection(),t.preventDefault();break;case Graph.event.SHIFT:break;case Graph.event.ESC:}},onKeynavUp:function(t){var e=t.keyCode;switch(e){case Graph.event.SHIFT:}},saveAsImage:function(t){var e=new Graph.data.Exporter(this);e.exportPNG(t),e=null},saveAsBlob:function(t){var e=new Graph.data.Exporter(this);return e.exportBlob(t)},save:function(){},listenLinkUpdate:_.debounce(function(){this.layout().arrangeLinks()},300),listenLinkRemove:_.debounce(function(){this.layout().arrangeLinks()},10),listenShapeDraw:_.debounce(function(){this.layout().arrangeShapes();
},1)});t.toString=function(){return"function( width, height )"};var e={ellipse:"Ellipse",circle:"Circle",rect:"Rect",path:"Path",polyline:"Polyline",polygon:"Polygon",group:"Group",text:"Text",image:"Image",line:"Line"};_.forOwn(e,function(e,n){!function(e,n){t.prototype[n]=function(){var t=[e].concat(_.toArray(arguments)),n=Graph.svg.apply(null,t);return n.tree.paper=this.guid(),n.render(this),t=null,n}}(e,n)})}(),function(){var t={},e={},n=Graph.extend({context:{},constructor:function(){this.context=e},register:function(e){var n=e.guid();this.get(n);t[n]=e},unregister:function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},setContext:function(n,r){t[n]&&(e[n]=r)},count:function(){return _.keys(t).length},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},get:function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_VECTOR)):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_VECTOR)),
t[e])},collect:function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},wipe:function(e){var n=e.guid();for(var r in t)t.hasOwnProperty(r)&&t[r].tree.paper==n&&delete t[r];t[n]&&delete t[n]},toString:function(){return"Graph.registry.Vector"}});Graph.registry.vector=new n}(),function(){var t={},e={},n=Graph.extend({context:{},constructor:function(){this.context=e},register:function(e){var n=e.guid();t[n]=e},unregister:function(n){var r=n.guid();t[r]&&delete t[r],e[r]&&delete e[r]},setContext:function(n,r){t[n]&&(e[n]=r)},count:function(){return _.keys(t).length},has:function(e){return void 0!==t[e]},get:function(e){return void 0===e?this.toArray():(e instanceof SVGElement?e=Graph.$(e).data(Graph.string.ID_LINK):e instanceof Graph.dom.Element&&(e=e.data(Graph.string.ID_LINK)),t[e])},collect:function(n){var r=[];for(var i in e)e[i]==n&&t[i]&&r.push(t[i]);return r},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},toString:function(){return"Graph.registry.Link";
}});Graph.registry.link=new n}(),function(){var t={},e=Graph.extend({storage:{},constructor:function(){this.storage=t},register:function(e){var n=e.guid();t[n]=e},unregister:function(e){var n=e.guid();t[n]&&(t[n]=null,delete t[n])},count:function(){return _.keys(t).length},toArray:function(){var e=_.keys(t);return _.map(e,function(e){return t[e]})},get:function(e){return _.isUndefined(e)?this.toArray():(e instanceof SVGElement?("tspan"==e.tagName&&(e=e.parentNode),e=Graph.$(e).data(Graph.string.ID_SHAPE)):e instanceof Graph.dom.Element?e=e.data(Graph.string.ID_SHAPE):e instanceof Graph.svg.Vector&&(e=e.elem.data(Graph.string.ID_SHAPE)),t[e])},toString:function(){return"Graph.registry.Shape"}});Graph.registry.shape=new e}(),function(){Graph.layout.Layout=Graph.extend({props:{fit:!0,view:null,width:0,height:0,router:{type:"orthogonal"},link:{smooth:!0,smootness:6}},view:null,cached:{offset:null},constructor:function(t,e){_.assign(this.props,e||{}),this.props.view=t.guid()},view:function(){
return Graph.registry.vector.get(this.props.view)},paper:function(){return this.view().paper()},offset:function(){var t,e,n=this.cached.offset;return n||(t=this.view(),e=t.isViewport()?t.parent().node():t.node(),n=e.getBoundingClientRect(),this.cached.offset=n),n},center:function(){var t=this.cached.center;if(!t){var e=this.offset();t={x:e.width/2,y:e.height/2},this.cached.center=_.extend({},t)}return t},scale:function(){return this.view().matrix().scale()},width:function(){var t,e,n;return t=this.view(),t.isViewport()?n=this.paper().width():(e=t.bbox(),n=e.width()),t=e=null,n},height:function(){var t,e,n;return t=this.view(),t.isViewport()?n=this.paper().height():(e=t.bbox(),n=e.height()),t=e=null,n},invalidate:function(){this.cached.offset=null,this.cached.center=null},grabVector:function(t){return Graph.registry.vector.get(t.target)},grabLink:function(t){return Graph.registry.link.get(t.target)},grabLocation:function(t){var e=t.clientX,n=t.clientY,r=this.offset(),i=this.view().matrix(),o=i.clone().invert(),a=i.scale(),s={
x:o.x(e,n),y:o.y(e,n)};return s.x-=r.left/a.x,s.y-=r.top/a.y,i=o=null,s},dragSnapping:function(){return{mode:"anchor",x:1,y:1}},createRouter:function(t,e,n){var r,i;return r=Graph.router[_.capitalize(this.props.router.type)],n=_.extend({},this.props.router,n||{}),i=Graph.factory(r,[this.view(),t,e,n])},createLink:function(t,e){var n,r;return n=Graph.link[_.capitalize(this.props.router.type)],e=_.extend({},this.props.link,e||{}),r=Graph.factory(n,[t,e])},refresh:function(t){this.fire("refresh")},arrangeLinks:function(){var t=this.view().paper().guid(),e=Graph.registry.link.collect(t);if(e.length){var n=[];_.forEach(e,function(t){t.cached.convex&&n.push(t.guid())});var r,i,o,a=new Graph.util.Sweeplink(e),s=a.findConvex();for(r in s)i=Graph.registry.link.get(r),i.updateConvex(s[r]),i.refresh(!0),o=_.indexOf(n,r),o>-1&&n.splice(o,1);n.length&&_.forEach(n,function(t){var e=Graph.registry.link.get(t);e.removeConvex(),e.refresh(!0)}),a.destroy(),a=null}},arrangeShapes:function(){}})}(),function(){
var t=Graph.router.Router=Graph.extend({props:{domain:null,source:null,target:null},values:{start:null,end:null,waypoints:null},cached:{command:null,segments:null,pathinfo:null,bendpoints:null,bending:null,connect:null},constructor:function(t,e,n,r){_.assign(this.props,r||{}),this.props.domain=t.guid(),this.props.source=e.guid(),this.props.target=n.guid(),this.values.waypoints=[]},invalidate:function(){this.cached.command=null,this.cached.segments=null,this.cached.pathinfo=null,this.cached.bendpoints=null},domain:function(){return Graph.registry.vector.get(this.props.domain)},source:function(t){return void 0===t?Graph.registry.vector.get(this.props.source):(this.props.source=t.guid(),this)},target:function(t){return void 0===t?Graph.registry.vector.get(this.props.target):(this.props.target=t.guid(),this)},layout:function(){return this.domain().layout()},tail:function(){var t=_.first(this.values.waypoints);return t?_.extend({},t):null},head:function(){var t=_.last(this.values.waypoints);return t?_.extend({},t):null;
},center:function(){var t=this.pathinfo(),e=t.pointAt(t.length()/2,!0);return t=null,e},command:function(t){var e,n;return void 0===t?(t=this.cached.command,t||(e=this.segments(),t=Graph.util.segments2path(e),this.cached.command=t),t):(e=Graph.util.path2segments(t),n=_.map(e,function(t){return{x:t[1],y:t[2]}}),this.values.waypoints=n,this.invalidate(),e=n=null,this)},segments:function(){var t=this.cached.segments;return t||(t=[],_.forEach(this.values.waypoints,function(e,n){var r=0===n?"M":"L";t.push([r,e.x,e.y])}),this.cached.segments=t),t},waypoints:function(){return this.values.waypoints},bendpoints:function(){var t=this.cached.bendpoints;return t||(t=(this.values.waypoints||[]).slice(),this.cached.bendpoints=t),t},pathinfo:function(){var t=this.cached.pathinfo;return t||(t=Graph.path(this.command()),this.cached.pathinfo=t),t},modify:function(t,e,n){return this.values.waypoints[t].x=e,this.values.waypoints[t].y=n,this},commit:function(){return this.invalidate(),this},route:function(){
return this},repair:function(t,e){},reset:function(){this.invalidate(),this.values.waypoints=null},relocate:function(t,e){return _.forEach(this.values.waypoints,function(n){n.x+=t,n.y+=e}),this.commit(),this},initTrans:function(t){},updateTrans:function(t){},bending:function(){},connecting:function(){},stopTrans:function(t){},destroy:function(){this.reset()}});t.toString=function(){return"function(domain, source, target, options)"},t.portCentering=function(t,e,n){return"x"==n&&(t.y=e.y),"y"==n&&(t.x=e.x),t},t.porting=function(e,n,r){var i,o,a=r?0:e.length-1,s=Graph.path(Graph.util.points2path(e)),p=n.intersection(s,!0);return i=e[a],p.length&&(p=t.sortIntersection(p),o=r?p[0]:p[p.length-1]),{index:a,point:i,port:o||i}},t.isRepairable=function(t){var e=t.length;return!(e<3)&&(e>4||!_.find(t,function(e,n){var r=t[n-1];return r&&Graph.util.pointDistance(e,r)<=5}))},t.getSegmentIndex=function(t,e){var n=0;return _.forEach(t,function(r,i){if(Graph.util.isPointOnLine(r,t[i+1],e))return n=i,!1;
}),n},t.sortIntersection=function(t){return _.sortBy(t,function(t){var e=Math.floor(100*t.t2)||1;return e=100-e,e=(e<10?"0":"")+e,t.segment2+"#"+e})},t.getClosestIntersect=function(e,n,r){var i,o=Graph.path(Graph.util.points2path(e)),a=n.intersection(o,!0),s=1/0;return a.length&&(a=t.sortIntersection(a),_.forEach(a,function(t){var e=Graph.util.taxicab(t,r);e<=s&&(s=e,i=t)})),i},t.repairBendpoint=function(t,e,n){var r=Graph.util.pointAlign(e,t);switch(r){case"v":return{x:t.x,y:n.y};case"h":return{x:n.x,y:t.y}}return{x:t.x,y:t.y}},t.repairRoutes=function(e,n,r,i){var o=i[0],a=i.slice();return a[0]=r,a[1]=t.repairBendpoint(a[1],o,r),a},t.tidyRoutes=function(t){return _.filter(t,function(e,n){return!Graph.util.isPointOnLine(t[n-1],t[n+1],e)})}}(),function(){var t=Graph.router.Router;Graph.router.Directed=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,a,s=this.pathinfo().curve().segments;t=[];for(var p=0,h=s.length;p<h;p++)e=s[p],0===p?(o=e[1],a=e[2],
n=Graph.curve([["M",o,a],["C",o,a,o,a,o,a]]),i=n.pointAt(n.t(0),!0),i.index=p,i.range=[0,0],i.space=0,t.push(i)):(n=Graph.curve([["M",o,a],e]),o=e[5],a=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=p,i.range=[p-1,p],i.space=0,t.push(i),i=n.pointAt(n.t(r),!0),i.index=p,i.range=[p-1,p+1],i.space=1,t.push(i));this.cached.bendpoints=t}return t},route:function(t,e){var n=this.source(),r=n.connectable(),i=r.bbox(),o=i.toJson(),a=this.target(),s=a.connectable(),p=s.bbox(),h=p.toJson(),c=r.orientation(s),l=r.direction(s),u=!1,d=[];t||(t=i.center(!0)),e||(e=p.center(!0));var f,g;if(l){if("h:h"==l){switch(c){case"top-right":case"right":case"bottom-right":f={x:o.x,y:t.y},g={x:h.x+h.width,y:e.y};break;case"top-left":case"left":case"bottom-left":f={x:o.x+o.width,y:t.y},g={x:h.x,y:e.y}}u=!0}if("v:v"==l){switch(c){case"top-left":case"top":case"top-right":f={x:t.x,y:o.y+o.height},g={x:e.x,y:h.y};break;case"bottom-left":case"bottom":case"bottom-right":f={x:t.x,y:o.y},g={x:e.x,y:h.y+h.height}}u=!0}}
d=u?[f,g]:[t,e];var v,y=Graph.path(Graph.util.points2path(d));return v=r.pathinfo().intersection(y,!0),v.length&&(d[0]=v[0]),v=s.pathinfo().intersection(y,!0),v.length&&(d[1]=v[v.length-1]),this.values.waypoints=d,this.commit(),this.fire("route",{command:this.command()}),this},repair:function(e,n){var r=this.source(),i=r.connectable(),o=i.bbox(),a=this.target(),s=a.connectable(),p=s.bbox(),h=this.values.waypoints,c=h.length-1;e===r?h[0]=n:e===a&&(h[c]=n);var l;l=t.getClosestIntersect(h,i.pathinfo(),p.center(!0)),l&&(h[0]=l),l=t.getClosestIntersect(h,s.pathinfo(),o.center(!0)),l&&(h[c]=l),this.commit(),this.fire("route",{command:this.command()})},initTrans:function(t){var e=this.source(),n=this.target(),r=e.connectable(),i=n.connectable(),o=r.pathinfo(),a=i.pathinfo(),s=this.waypoints(),p=t.range.start,h=t.range.end,c=s[p],l=s[h],u=[];"BENDING"==t.trans&&(u=[s[p],s[h]]);var d=this.layout().offset();t.snap.hor=[],t.snap.ver=[],_.forEach(u,function(e){e&&(t.snap.hor.push(e.y+d.top),t.snap.ver.push(e.x+d.left));
}),"BENDING"==t.trans?this.cached.bending={source:e,target:n,rangeStart:p,rangeEnd:p,segmentStart:c,segmentEnd:l,original:s.slice(),sourcePath:o,targetPath:a}:this.cached.connect={valid:!1,source:null,target:null,sourcePath:null,targetPath:null,original:s.slice()}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.connectable().pathinfo()):!r&&n.source&&(n.sourcePath=n.source.connectable().pathinfo()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.connectable().pathinfo()):!i&&n.target&&(n.targetPath=n.target.connectable().pathinfo())}},bending:function(t,e){var n=this.cached.bending,r=n.original.slice(),i=n.rangeStart,o=(n.rangeEnd,n.segmentStart),a=n.segmentEnd,s={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},p=Graph.util.pointAlign(o,s,10),h=Graph.util.pointAlign(a,s,10);"h"==p&&"v"==h?(s.x=o.x,s.y=a.y):"v"==p&&"h"==h?(s.y=o.y,s.x=a.x):"h"==p?s.x=o.x:"v"==p?s.y=o.y:"h"==h?s.x=a.x:"v"==h&&(s.y=a.y),
t.event.x=s.x,t.event.y=s.y,r.splice(i+1,t.space,s),n.routes=r,this.cropBinding(t,e)},cropBinding:_.debounce(function(e,n){var r,i=this.cached.bending,o=i.routes,a=t.porting(o,i.sourcePath,!0),s=t.porting(o,i.targetPath),p=o.slice(a.index+1,s.index);p.unshift(a.port),p.push(s.port),i.waypoints=p,n&&(r=Graph.util.points2path(p),n({command:r}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice();n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},i[t.index]=n,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n,r,i,o,a=this.cached.connect,s=a.routes;0===t.index?a.source&&(r=a.sourcePath):a.target&&(r=a.targetPath),r&&(i=Graph.path(Graph.util.points2path(s)),o=r.intersection(i,!0),o.length&&(s[t.index]=o[0])),a.waypoints=s,e&&(n=Graph.util.points2path(s),e({command:n}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,this.source(n.source),this.target(n.target),
this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,this.commit(),this.cached.connect=null,this.cached.bending=null},toString:function(){return"Graph.router.Directed"}}),Graph.router.Directed.toString=function(){return"function(domain, source, target, options)"}}(),function(){var t=Graph.router.Router;Graph.router.Orthogonal=Graph.extend(t,{bendpoints:function(){var t=this.cached.bendpoints;if(!t){var e,n,r,i,o,a,s=this.pathinfo().curve().segments,p=s.length-1;t=[];for(var h=0,c=s.length;h<c;h++)e=s[h],0===h?(o=e[1],a=e[2],n=Graph.curve([["M",o,a],["C",o,a,o,a,o,a]]),i=n.pointAt(n.t(0),!0),i.index=h,i.range=[h,h+1],i.space=0,t.push(i)):(n=Graph.curve([["M",o,a],e]),o=e[5],a=e[6],r=n.length(),i=n.pointAt(n.t(r/2),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i),h===p&&(i=n.pointAt(n.t(r),!0),i.index=h,i.range=[h-1,h],i.space=0,t.push(i)));
this.cached.bendpoints=t}return t},route:function(e,n){var r=this.source(),i=this.target(),o=r.connectable(),a=i.connectable(),s=o.bbox(),p=s.toJson(),h=a.bbox(),c=h.toJson(),l=o.orientation(a),u=o.direction(a),d=!1;e||(e=s.center(!0)),n||(n=h.center(!0));var f,g;if(u){if("h:h"==u){switch(l){case"top-right":case"right":case"bottom-right":f={x:p.x+1,y:e.y},g={x:c.x+c.width-1,y:n.y};break;case"top-left":case"left":case"bottom-left":f={x:p.x+p.width-1,y:e.y},g={x:c.x+1,y:n.y}}d=!0}if("v:v"==u){switch(l){case"top-left":case"top":case"top-right":f={x:e.x,y:p.y+p.height-1},g={x:n.x,y:c.y+1};break;case"bottom-left":case"bottom":case"bottom-right":f={x:e.x,y:p.y+1},g={x:n.x,y:c.y+c.height-1}}d=!0}}var v,y,m,x,b;return d?(m=o.pathinfo(),x=Graph.path(Graph.util.points2path([f,g])),b=m.intersection(x,!0),b.length&&(b=b[0],Graph.util.isPointEquals(b,f)||(f=b)),m=a.pathinfo(),b=m.intersection(x,!0),b.length&&(b=b[b.length-1],Graph.util.isPointEquals(b,g)||(g=b)),y=Graph.util.lineBendpoints(f,g,u),v=[f].concat(y).concat([g]),
this.values.waypoints=t.tidyRoutes(v)):(f=e,g=n,y=Graph.util.lineBendpoints(f,g,u),x=Graph.path(Graph.util.points2path([f].concat(y).concat([g]))),m=o.pathinfo(),b=m.intersection(x,!0),b.length&&(f=b[0]),m=a.pathinfo(),b=m.intersection(x,!0),b.length&&(g=b[b.length-1]),v=[f].concat(y).concat([g]),this.values.waypoints=t.tidyRoutes(v)),this.commit(),this.fire("route",{command:this.command()}),this},repair:function(e,n){var r=this.values.waypoints.slice();if(!t.isRepairable(r))return this.route();var i,o,a,s,p,h,c=this.target(),l=c.connectable(),u=l.bbox(),d=this.source(),f=d.connectable(),g=f.bbox();e===d?(i=g.toJson(),o=u.toJson(),a=g.center(!0),s=r):(i=u.toJson(),o=g.toJson(),a=u.center(!0),s=r.slice(),s.reverse()),p="h"==Graph.util.pointAlign(s[0],s[1])?"x":"y",t.portCentering(n,a,p),h=t.repairRoutes(i,o,n,s);var v,y,m,x;if(h){if(e===c&&h.reverse(),v=h.slice(),y=t.getClosestIntersect(h,f.pathinfo(),u.center(!0)),y&&(m=t.getSegmentIndex(h,y),v=v.slice(m+1),v.unshift(y)),y=t.getClosestIntersect(v,l.pathinfo(),g.center(!0)),
y&&(x=t.getSegmentIndex(v,y),v=v.slice(0,x+1),v.push(y),2===v.length)){var b=Graph.util.pointAlign(v[0],v[1]);"h"==b?v[1].x=v[0].x:"v"==b&&(v[1].y=v[0].y)}return this.values.waypoints=v,this.commit(),this.fire("route",{command:this.command()}),this}return this.route()},initTrans:function(e){var n=this.waypoints(),r=this.source(),i=this.target(),o=e.ranges.start,a=e.ranges.end,s=r.connectable(),p=i.connectable(),h=s.bbox(),c=p.bbox(),l=n[o],u=n[a],d=[];"BENDING"==e.trans&&(0===o&&t.portCentering(l,h.center(!0),e.axis),a===n.length-1&&t.portCentering(u,c.center(!0),e.axis),d=[n[o-1],l,u,n[a+1]],o<2&&d.unshift(h.center(!0)),a>n.length-3&&d.unshift(c.center(!0)));var f=this.layout().offset(),g=[],v=[];if(e.snap.hor=[],e.snap.ver=[],_.forEach(d,function(t){t&&("y"==e.axis&&(g.push(t.y),e.snap.hor.push(t.y+f.top)),"x"==e.axis&&(v.push(t.x),e.snap.ver.push(t.x+f.left)))}),this.cached.connect=null,this.cached.bending=null,"BENDING"==e.trans)this.cached.bending={source:r,target:i,original:n,rangeStart:o,
rangeEnd:a,segmentStart:l,segmentEnd:u,sourceBound:h.toJson(),targetBound:c.toJson(),sourcePath:s.pathinfo(),targetPath:p.pathinfo(),snapH:g,snapV:v};else{var y=n.slice(),m=Graph.util.pointAlign(l,u,10);if(2===y.length){var x,b;x={x:(l.x+u.x)/2,y:(l.y+u.y)/2},b={x:x.x,y:x.y},y.splice(1,0,x,b),0!==e.index?(o+=2,a+=2,l=y[o],u=y[a],e.index+=2,e.point=_.extend({},u),e.event=_.extend({},u)):u=y[a]}this.cached.connect={valid:!1,source:null,target:null,sourcePath:null,targetPath:null,rangeStart:o,rangeEnd:a,segmentStart:l,segmentEnd:u,segmentAlign:m,original:y}}},updateTrans:function(t,e){if("CONNECT"==t){var n=this.cached.connect,r=n.source,i=n.target;_.assign(n,e),r&&n.source?r.guid()!=n.source.guid()&&(n.sourcePath=n.source.connectable().pathinfo()):!r&&n.source&&(n.sourcePath=n.source.connectable().pathinfo()),i&&n.target?i.guid()!=n.target.guid()&&(n.targetPath=n.target.connectable().pathinfo()):!i&&n.target&&(n.targetPath=n.target.connectable().pathinfo())}},bending:function(t,e){var n,r,i=this.cached.bending,o=i.original.slice(),a=i.segmentStart,s=i.segmentEnd,p=i.rangeStart,h=i.rangeEnd;
n={x:a.x+t.delta.x,y:a.y+t.delta.y},r={x:s.x+t.delta.x,y:s.y+t.delta.y},"x"==t.axis&&(t.event.x=(n.x+r.x)/2),"y"==t.axis&&(t.event.y=(n.y+r.y)/2);var c=Graph.util.snapValue(t.event.x,i.snapV),l=Graph.util.snapValue(t.event.y,i.snapH);t.event.x=c,t.event.y=l,"x"==t.axis&&(n.x=c,r.x=c),"y"==t.axis&&(n.y=l,r.y=l),o[p]=n,o[h]=r;var u,d,f=o.length,g=0;p<2&&(u=Graph.util.boxOrientation(i.sourceBound,Graph.util.pointbox(n)),1===p?"intersect"==u&&(o.shift(),o[0]=n,g--):"intersect"!=u&&(o.unshift(a),g++)),h>f-3&&(d=Graph.util.boxOrientation(i.targetBound,Graph.util.pointbox(r)),h===f-2?"intersect"==d&&(o.pop(),o[o.length-1]=r):"intersect"!=d&&o.push(s)),i.routes=o,i.newRangeStart=p+g,this.cropBending(e)},cropBending:_.debounce(function(e){var n,r=this.cached.bending,i=r.routes,o=t.porting(i,r.sourcePath,!0),a=t.porting(i,r.targetPath),s=i.slice(o.index+1,a.index);s.unshift(o.port),s.push(a.port),r.waypoints=s,e&&(n=Graph.util.points2path(s),e({command:n}))},0),connecting:function(t,e){var n,r=this.cached.connect,i=r.original.slice(),o=r.segmentAlign,a=r.segmentStart,s=r.segmentEnd,p=r.rangeStart,h=r.rangeEnd;
n={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y};var c,l;0===t.index?(c={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},l="v"==o?{x:s.x,y:c.y}:{x:c.x,y:s.y}):(l={x:t.point.x+t.delta.x,y:t.point.y+t.delta.y},c="h"==o?{x:l.x,y:a.y}:{x:a.x,y:l.y}),i[p]=c,i[h]=l,t.event.x=n.x,t.event.y=n.y,r.routes=i,this.cropConnect(t,e)},cropConnect:_.debounce(function(t,e){var n=this.cached.connect,r=n.routes;if(n.valid){var i,o,a,s;0===t.index?n.source&&(o=n.sourcePath):n.target&&(o=n.targetPath),o&&(a=Graph.path(Graph.util.points2path(r)),s=o.intersection(a,!0),s.length&&(r[t.index]=s[0]))}n.waypoints=r,e&&(i=Graph.util.points2path(r),e({command:i}))},0),stopTrans:function(e){var n,r,i,o;"CONNECT"==e.trans?(n=this.cached.connect,i=n.waypoints,this.cached.connect.valid?(o=!0,this.source(n.source),this.target(n.target),this.fire("reroute",{source:n.source,target:n.target})):(i=n.original.slice(),o=!1)):"BENDING"==e.trans&&(r=this.cached.bending,i=r.waypoints,o=!0),o?this.values.waypoints=t.tidyRoutes(i):this.values.waypoints=i,
this.commit()},toString:function(){return"Graph.router.Orthogonal"}}),Graph.router.Orthogonal.toString=function(){return"function(domain, source, target, options)"}}(),function(){function t(t,e,n){var r="on"+_.capitalize(e)+_.capitalize(n),i=t[r];return r=null,i}var e=Graph.link.Link=Graph.extend({props:{id:null,guid:null,rendered:!1,selected:!1,label:"",labelDistance:null,labelX:null,labelY:null,source:null,target:null,connected:!1},components:{block:null,coat:null,path:null,label:null,editor:null},cached:{bendpoints:null,controls:null,convex:null},handlers:{source:null,target:null},router:null,metadata:{icon:Graph.icons.SHAPE_LINK},constructor:function(t,n){n=_.extend({id:"graph-link-"+ ++e.guid},n||{}),_.assign(this.props,n),this.props.guid=this.props.id,this.router=t,this.initComponent(),this.initMetadata(),this.bindResource("source",t.source()),this.bindResource("target",t.target()),this.router.on("route",_.bind(this.onRouterRoute,this)),this.router.on("reroute",_.bind(this.onRouterReroute,this)),
Graph.registry.link.register(this)},initComponent:function(){var t,e,n,r,i,o=this.components;t=(new Graph.svg.Group).addClass("graph-link").selectable(!1),t.elem.data(Graph.string.ID_LINK,this.props.guid),e=(new Graph.svg.Path).addClass("graph-link-coat").render(t),e.data("text",this.props.label),e.elem.data(Graph.string.ID_LINK,this.props.guid),e.draggable({ghost:!0,manual:!0,batchSync:!1}),e.editable({width:150,height:80,offset:"pointer"}),e.on("pointerdown.link",_.bind(this.onCoatClick,this)),e.on("select.link",_.bind(this.onCoatSelect,this)),e.on("deselect.link",_.bind(this.onCoatDeselect,this)),e.on("dragstart.link",_.bind(this.onCoatDragStart,this)),e.on("dragend.link",_.bind(this.onCoatDragEnd,this)),e.on("edit.link",_.bind(this.onCoatEdit,this)),e.on("beforeedit.link",_.bind(this.onCoatBeforeEdit,this)),e.on("remove.link",_.bind(this.onCoatRemove,this)),n=(new Graph.svg.Path).addClass("graph-link-path").selectable(!1).clickable(!1).attr("marker-end","url(#marker-arrow)").render(t),
n.elem.data(Graph.string.ID_LINK,this.props.guid),i=new Graph.svg.Text(0,0,"").addClass("graph-link-label").selectable(!1).render(t),i.draggable({ghost:!0}),i.on("render.link",_.bind(this.onLabelRender,this)),i.on("dragend.link",_.bind(this.onLabelDragend,this));var a=i.interactable().vendor();a.on("doubletap",_.bind(this.onLabelDoubletap,this)),r=(new Graph.svg.Group).selectable(!1).render(t),o.block=t.guid(),o.coat=e.guid(),o.path=n.guid(),o.label=i.guid(),o.editor=r.guid()},initMetadata:function(){this.metadata.tools=[{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove link"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},unbindResource:function(t){var e=this.props[t],n=this.handlers[t];if(e&&n&&(e=Graph.registry.vector.get(e))){
var r,i;for(r in n)i=r+".link",e.off(i,n[r]),i=null}return n=null,this},bindResource:function(e,n){var r=(this.router,this.handlers[e]);return this.unbindResource(e,n),r={},r.resize=_.bind(t(this,e,"resize"),this),r.rotate=_.bind(t(this,e,"rotate"),this),r.dragstart=_.bind(t(this,e,"dragstart"),this,_,n),r.dragmove=_.bind(t(this,e,"dragmove"),this),r.dragend=_.bind(t(this,e,"dragend"),this),this.handlers[e]=r,this.props[e]=n.guid(),n.on("resize.link",r.resize),n.on("rotate.link",r.rotate),n.isDraggable()&&(n.on("dragstart.link",r.dragstart),n.draggable().ghost()?n.on("dragend.link",r.dragend):n.on("dragmove.link",r.dragmove)),this},bindSource:function(t){return this.bindResource("source",t)},bindTarget:function(t){return this.bindResource("target",t)},unbindSource:function(t){return this.unbindResource("source")},unbindTarget:function(t){return this.unbindResource("target")},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t]);
},invalidate:function(){this.cached.bendpoints=null},render:function(t){var e;this.component().render(t),e=t.paper(),e&&Graph.registry.link.setContext(this.guid(),e.guid())},id:function(){return this.props.id},guid:function(){return this.props.guid},connect:function(){if(!this.props.connected){this.router.route();var t=this.router.source(),e=this.router.target();t.connectable().addLink(this,"outgoing",e),e.connectable().addLink(this,"incoming",t),this.props.connected=!0}},disconnect:function(){this.props.connected&&(this.props.connected=!1,this.router.reset(),this.update(this.router.command()))},update:function(t,e){e=_.defaultTo(e,!1),this.component("coat").attr("d",t).dirty(!0),this.component("path").attr("d",t),this.invalidate(),e||(this.redraw(),this.fire("update"),Graph.topic.publish("link/update"))},refresh:function(t){var e=this.router.command();this.update(e,t)},updateConvex:function(t){this.cached.convex=t},removeConvex:function(){this.cached.convex=null},redraw:function(){if(this.props.label){
var t=this.component("label"),e=t.bbox().toJson(),n=this.props.labelDistance||.5,r=this.router.layout().scale(),i=this.router.pathinfo(),o=i.pointAt(n*i.length(),!0),a=Graph.util.pointAlign(o.start,o.end,10);"h"==a?o.x+=(10+e.width/2)/r.x:o.y-=(10+e.height/2)/r.y,t.attr({x:o.x,y:o.y}),i=null,o=null,t.dirty(!0)}},label:function(t,e,n){var r,i,o;return void 0===t?this.props.label:(this.props.label=t,void 0!==e&&void 0!==n?(r=this.router.pathinfo(),o=r.nearest({x:e,y:n}),i=o.distance/r.length()):_.isNull(this.props.labelDistance)&&(r=this.router.pathinfo(),i=.5,o=r.pointAt(r.length()/2,!0)),o&&(this.props.labelDistance=i,r=o=null),this.component("label").write(t),this.component("coat").data("text",t),this.redraw(),this)},select:function(t){this.props.selected=!0,this.component("block").addClass("selected"),t||(this.resumeControl(),Graph.topic.publish("link/select",{link:this}))},deselect:function(t){this.props.selected=!1,this.component("block").removeClass("selected"),t||(this.suspendControl(),
Graph.topic.publish("link/deselect",{link:this}))},renderControl:function(){},resumeControl:function(){var t=this,e=t.component("editor");t.cached.bendpoints||(t.cached.bendpoints=t.router.bendpoints(),t.renderControl()),e.elem.appendTo(this.component("block").elem)},suspendControl:function(){this.component("editor").elem.detach()},sendToFront:function(){var t=this.component().parent();this.component().elem.appendTo(t.elem)},remove:function(){var t,e=this;this.disconnect();var n=this.router.source(),r=this.router.target();n.connectable().removeLink(this),r.connectable().removeLink(this),e.component("label").remove(),e.cached.controls&&(_.forEach(e.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e.remove()}),e.cached.controls=null),e.component("editor").remove(),e.component("path").remove(),e.component("block").remove();for(t in e.components)e.components[t]=null;this.unbindSource(),this.unbindTarget();for(t in e.cached)e.cached[t]=null;e.router.destroy(),e.router=null,Graph.registry.link.unregister(e),
Graph.topic.publish("link/remove")},toString:function(){return"Graph.link.Link"},onRouterRoute:function(t){var e=t.command;this.update(e)},onRouterReroute:function(t){var e=t.source,n=t.target;this.bindResource("source",e),this.bindResource("target",n),this.sendToFront()},onLabelRender:function(t){this.props.label&&this.label(this.props.label)},onLabelDragend:function(t){var e=this.component("label"),n=e.matrix(),r=e.attrs.x,i=e.attrs.y,o={x:n.x(r,i),y:n.y(r,i)};e.attr({x:o.x,y:o.y});var a=this.router.pathinfo(),s=a.nearest(o);this.props.labelDistance=s.distance/a.length(),e.reset(),n=a=null},onLabelDoubletap:function(t){var e=this.component("coat");e.editable().startEdit(t)},onCoatBeforeEdit:function(t){this.component("label").hide(),this.component().addClass("editing")},onCoatEdit:function(t){this.component().removeClass("editing"),this.component("label").show(),this.label(t.text,t.left,t.top)},onCoatClick:function(t){var e=this.component("coat").paper();"linking"==e.state()&&e.tool().activate("panzoom");
},onCoatSelect:function(t){this.select(t.batch)},onCoatDeselect:function(t){this.deselect(t.batch)},onCoatDragStart:function(t){this.suspendControl()},onCoatDragEnd:function(t){var e=t.dx,n=t.dy;this.router.relocate(e,n),this.update(this.router.command())},onCoatRemove:function(t){this.remove()},onSourceRotate:function(){},onSourceDragstart:function(t,e){var n=this.component("coat").lasso;e.lasso||n&&n.decollect(this.component("coat")),this.cached.convex=null},onSourceDragmove:function(){this.router.repair("source")},onSourceDragend:function(t){var e=this.component("coat").lasso;if(!e){var n=this.router.tail();n&&(n.x+=t.dx,n.y+=t.dy,this.router.repair(this.router.source(),n))}},onSourceResize:function(t){var e=this.router.tail();e&&(e.x+=t.translate.dx,e.y+=t.translate.dy,this.router.repair(this.router.source(),e))},onTargetRotate:function(){},onTargetDragstart:function(t,e){var n=this.component("coat").lasso;e.lasso||n&&n.decollect(this.component("coat")),this.cached.convex=null},onTargetDragmove:function(){
this.router.repair("target")},onTargetDragend:function(t){var e=this.component("coat").lasso;if(!e){var n=this.router.head();n&&(n.x+=t.dx,n.y+=t.dy,this.router.repair(this.router.target(),n))}},onTargetResize:function(t){var e=this.router.head();e&&(e.x+=t.translate.dx,e.y+=t.translate.dy,this.router.repair(this.router.target(),e))},onTrashToolClick:function(t){this.component("coat").remove()},onFrontToolClick:function(t){this.sendToFront()},onBackToolClick:function(t){},destroy:function(){}});e.guid=0,e.toString=function(){return"function(router, options)"}}(),function(){var t=Graph.link.Link;Graph.link.Directed=Graph.extend(t,{renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=n.length-1,i=t.guid(),o=[];_.forEach(n,function(n,a){var s=new Graph.svg.Image(Graph.config.base+"img/resize-control.png",n.x-8.5,n.y-8.5,17,17);
s.selectable(!1),s.removeClass(Graph.styles.VECTOR),0===a?(s.addClass(Graph.styles.LINK_TAIL),s.elem.data("pole","tail")):a===r&&(s.addClass(Graph.styles.LINK_HEAD),s.elem.data("pole","head")),s.elem.group("graph-link"),s.elem.data(Graph.string.ID_LINK,i);var p={trans:0===a||a===r?"CONNECT":"BENDING",index:n.index,space:n.space,point:{x:n.x,y:n.y},event:{x:n.x,y:n.y},range:{start:n.range[0],end:n.range[1]},delta:{x:0,y:0},snap:{hor:[],ver:[]}};s.draggable(),s.cursor("default"),s.on("dragstart",_.bind(t.onControlStart,t,_,p,s)),s.on("dragmove",_.bind(t.onControlMove,t,_,p,s)),s.on("dragend",_.bind(t.onControlEnd,t,_,p,s)),s.render(e),o.push(s.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){if(this.router.initTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.addClass("linking")}var i=e.snap.hor,o=e.snap.ver;n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,o),r=Graph.util.snapValue(e,i);return{x:n,y:r,range:10}}]),_.forEach(this.cached.controls,function(t){
var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show()},onControlMove:function(t,e,n){var r=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var i,o,a,s;i=e.event.x,o=e.event.y,"BENDING"==e.trans?r.router.bending(e,function(t){r.update(t.command,!0)}):r.router.connecting(e,function(t){r.update(t.command,!0)}),a=e.event.x,s=e.event.y,t.originalData.dx=a-i,t.originalData.dy=s-o},onControlEnd:function(t,e,n){if(this.router.stopTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.removeClass("linking")}this.update(this.router.command()),this.invalidate(),this.resumeControl()}}),Graph.link.Directed.toString=function(){return"function(router, options)"}}(),function(){Graph.link.Orthogonal=Graph.extend(Graph.link.Link,{update:function(t,e){var n,r,i,o,a,s;if(e=_.defaultTo(e,!1),n=this.cached.convex,r=this.props.smooth,n){var p=this.router.waypoints();if(!p)return;o=p.slice(),a=o.length-1,s=[],_.forEach(o,function(t,e){var r,i=t,a=o[e+1];r=0===e?["M",t.x,t.y]:["L",t.x,t.y],s.push(r),n[e]&&_.forEach(n[e],function(t){
var e=Graph.util.convexSegment(t,i,a);e&&s.push(e[0],e[1])})}),t=Graph.util.segments2path(s)}if(r){i=this.props.smootness||6,s=s||Graph.util.path2segments(t).slice();var h,c,l,u,d,f;for(d=0;d<s.length;d++)if(h=s[d],l=s[d+1],f=!("L"!=h[0]||!l||"Q"==l[0]),f&&(u={x:h[h.length-2],y:h[h.length-1]},c=s[d-1],c&&l)){var g=Graph.util.smoothSegment(u,{x:c[c.length-2],y:c[c.length-1]},{x:l[l.length-2],y:l[l.length-1]},i);g&&(s.splice(d,1,g[0],g[1]),d++)}t=Graph.util.segments2path(s)}t&&(this.component("coat").attr("d",t).dirty(!0),this.component("path").attr("d",t),this.invalidate(),e||(this.redraw(),this.fire("update"),Graph.topic.publish("link/update")))},renderControl:function(){var t=this,e=t.component("editor");t.cached.controls&&(_.forEach(t.cached.controls,function(t){t=Graph.registry.vector.get(t),t.remove()}),t.cached.controls=null);var n=this.cached.bendpoints,r=t.guid(),i=n.length-1,o=[];_.forEach(n,function(n,a){var s,p,h,c,l;s=new Graph.svg.Image(Graph.config.base+"img/resize-control.png",n.x-8.5,n.y-8.5,17,17),
s.selectable(!1),s.removeClass(Graph.styles.VECTOR),s.elem.group("graph-link"),s.elem.data(Graph.string.ID_LINK,r),l={},c=null,p="default",0===a?(s.addClass(Graph.styles.LINK_TAIL),s.elem.data("pole","tail")):a===i?(s.addClass(Graph.styles.LINK_HEAD),s.elem.data("pole","head")):(h=Graph.util.pointAlign(n.start,n.end),c="v"==h?"y":"x",p="x"==c?"ew-resize":"ns-resize",l={axis:c});var u={trans:0===a||a===i?"CONNECT":"BENDING",index:n.index,axis:c,cursor:p,point:{x:n.x,y:n.y},ranges:{start:n.range[0],end:n.range[1]},event:{x:n.x,y:n.y},snap:{hor:[],ver:[]},delta:{x:0,y:0}};s.draggable(l),s.cursor(p),s.on("dragstart",_.bind(t.onControlStart,t,_,u,s)),s.on("dragmove",_.bind(t.onControlMove,t,_,u)),s.on("dragend",_.bind(t.onControlEnd,t,_,u,s)),s.render(e),o.push(s.guid())}),t.cached.controls=o,o=null},onControlStart:function(t,e,n){if(this.component("coat").cursor(e.cursor),this.router.initTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.addClass("linking")}var i=e.snap.hor,o=e.snap.ver;
n.draggable().snap([function(t,e){var n=Graph.util.snapValue(t,o),r=Graph.util.snapValue(e,i);return{x:n,y:r,range:10}}]),_.forEach(this.cached.controls,function(t){var e=Graph.registry.vector.get(t);e&&e!==n&&e.hide()}),n.show(),this.removeConvex()},onControlMove:function(t,e){var n=this;e.delta.x+=t.dx,e.delta.y+=t.dy;var r,i,o,a,s,p;r=e.event.x,i=e.event.y,"BENDING"==e.trans?n.router.bending(e,function(t){n.update(t.command,!0)}):n.router.connecting(e,function(t){n.update(t.command,!0)}),o=e.event.x,a=e.event.y,s=o-r,p=a-i,t.originalData.dx=s,t.originalData.dy=p},onControlEnd:function(t,e,n){if(this.component("coat").cursor("pointer"),this.router.stopTrans(e),"CONNECT"==e.trans){var r=this.component().paper();r&&r.removeClass("linking")}this.update(this.router.command()),this.invalidate(),this.resumeControl()},toString:function(){return"Graph.link.Orthogonal"}}),Graph.link.Orthogonal.toString=function(){return"function(router, options)"}}(),function(){function t(t){var e=function(t){
return t},n=_.bisector(function(t){return e(t)}).left;return t.insert=function(n){var r=t.findIndex(n),i=e(n);if(!t[r]||i!=e(t[r]))return t.splice(r,0,n),r},t.remove=function(e){var n=t.findIndex(e);return t.splice(n,1),n},t.findIndex=function(r){return n(t,e(r))},t.key=function(n){return e=n,t},t.swap=function(){},t.order=function(){return t.sort(_.ascendingKey(e)),t},t}var e=1e-9,n=.1,r=Graph.util.Sweeplink=function(t){var e=this;e.points=[],e.queue=[],e.lines=[],e.found=[],e.process=[],_.forEach(t,function(t){var n=e.extract(t);Array.prototype.push.apply(e.points,n)}),_.forEach(e.points,function(t,n){n%2&&e.lines.push(_.sortBy([t,e.points[n-1]],"y"))}),_.forEach(e.lines,function(t,e){t[0].x==t[1].x&&(t[0].x+=n,t[1].x-=n),t[0].y==t[1].y&&(t[0].y-=n,t[1].y+=n),t[0].line=t,t[1].line=t})};r.prototype.constructor=r,r.prototype.extract=function(t){var e=t.router.pathinfo().curve().segments,n=[];return _.forEach(e,function(r,i){var o=0===i?{x:r[1],y:r[2]}:{x:r[5],y:r[6]},a=e[i+1];a&&(a={x:a[5],
y:a[6]},Graph.util.movepoint(o,a,-20),Graph.util.movepoint(a,o,-20),o.x=Math.round(o.x,3),o.y=Math.round(o.y,3),a.x=Math.round(a.x,3),a.y=Math.round(a.y,3),o.link=t,a.link=t,o.range=i,a.range=i+1,n.push(o,a))}),n},r.prototype.findConvex=function(){var n=this;n.queue=t(n.points.slice()).key(function(t){return t.y+e*t.x}).order(),n.found=[],n.process=t([]);for(var r=0;r<n.queue.length&&r<1e3;r++){var i,o,a,s,p=n.queue[r];p.line&&p.line[0]==p?(p.type="insert",i=n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}).insert(p.line),n.validate(p.line,n.process[i+1]),n.validate(p.line,n.process[i-1])):p.line?(p.type="removal",i=n.process.findIndex(p.line),n.process.remove(p.line),n.validate(n.process[i-1],n.process[i])):p.lineA&&p.lineB&&(n.process.key(function(t){return n.intercept(t,p.y-e/1e3)}),o=n.process.findIndex(p.lineA),a=n.process.findIndex(p.lineB),o==a&&(o+=1),n.process[o]=p.lineB,n.process[a]=p.lineA,s=o<a?o:a,n.validate(n.process[s-1],n.process[s]),n.validate(n.process[s+1],n.process[s+2]));
}var h={};return _.forEach(this.found,function(e){var n,r,i,o,a,s,p,c,l,u,d;p=Graph.util.pointAlign(e.lineA[0],e.lineA[1],10),c=Graph.util.pointAlign(e.lineB[0],e.lineB[1],10),p!=c&&(o="v"==p?p:c,l="v"==p?e.lineA:e.lineB,u=l[0].link,d=u.guid(),n=u.router.waypoints(),r=Math.min(l[0].range,l[1].range),i=Math.max(l[0].range,l[1].range),a=n[r],s=n[i],h[d]||(h[d]={}),h[d][r]||(h[d][r]=t([]).key(function(t){return"v"==t.segmentAlign?t.segmentStart.x<t.segmentEnd.x?t.x+t.segmentStart.x:t.segmentStart.x-t.x:t.segmentStart.y<t.segmentEnd.y?t.y+t.segmentStart.y:t.segmentStart.y-t.y})),h[d][r].insert({x:e.x,y:e.y,link:u.guid(),rangeStart:r,rangeEnd:i,segmentAlign:o,segmentStart:a,segmentEnd:s}))}),h},r.prototype.intersect=function(t,e,n,r){var i=(t.x-e.x)*(n.y-r.y)-(t.y-e.y)*(n.x-r.x),o=t.x*e.y-t.y*e.x,a=n.x*r.y-n.y*r.x,s=(o*(n.x-r.x)-a*(t.x-e.x))/i,p=(o*(n.y-r.y)-a*(t.y-e.y))/i,h={x:s,y:p};return h.isOverlap=s==t.x&&p==t.y||s==e.x&&p==e.y,h.isIntersection=!(t.x<s^s<e.x)&&!(n.x<s^s<r.x)&&!h.isOverlap&&i,
h},r.prototype.validate=function(t,e){if(t&&e){var n=this.intersect(t[0],t[1],e[0],e[1]);n.lineA=t,n.lineB=e,n.isIntersection&&this.found.push(n)&&this.queue.insert(n)}},r.prototype.intercept=function(t,e){var n=t[0],r=t[1],i=(n.y-r.y)/(n.x-r.x);return(e-n.y+i*n.x)/i},r.prototype.destroy=function(){this.points=null,this.lines=null,this.found=null,this.queue=null,this.process=null}}(),function(){Graph.plugin.Plugin=Graph.extend({props:{context:null,vector:null,activator:"tool"},cached:{path:null,bbox:null},options:function(t){t=t||{};var e=_.defaultTo(t.context,this.vector()),n=e.guid();n!=this.props.context&&(this.props.context=n,this.cached.bbox=null,this.cached.path=null)},vector:function(){return Graph.registry.vector.get(this.props.vector)},context:function(){return this.props.context==this.props.vector?this.vector():Graph.registry.vector.get(this.props.context)},invalidate:function(){this.cached.path=null,this.cached.bbox=null},bbox:function(){var t=this.cached.bbox;if(!t){var e,n,r=this.vector(),i=r.pathinfo();
this.props.context==this.props.vector?e=r.matrix():(e=Graph.matrix(),n=this.props.context,r.bubble(function(t){return t.guid()!=n&&void e.multiply(t.matrix())})),i=i.transform(e),t=i.bbox(),this.cached.bbox=t,e=i=null}return t.clone()},pathinfo:function(){var t=this.cached.path;if(!t){var e,n,r=this.vector(),t=r.pathinfo();this.props.context==this.props.vector?e=r.matrix():(e=Graph.matrix(),n=this.props.context,r.bubble(function(t){return t.guid()!=n&&void e.multiply(t.matrix())})),t=t.transform(e),this.cached.path=t,e=null}return t.clone()},enable:function(t){},disable:function(){},destroy:function(){}})}(),function(){Graph.plugin.Definer=Graph.extend(Graph.plugin.Plugin,{props:{vector:null},definitions:{},components:{holder:null},constructor:function(t){this.props.vector=t.guid(),this.components.holder=Graph.$("<defs/>"),this.components.holder.prependTo(t.elem),t.isPaper()&&this.defineArrowMarker("marker-arrow")},defineArrowMarker:function(t){if(this.definitions[t])return this.definitions[t];
var e=Graph.$(_.format('<marker id="{0}" refX="{1}" refY="{2}" viewBox="{3}" markerWidth="{4}" markerHeight="{5}" orient="{6}"><path d="{7}" fill="{8}" stroke-width="{9}" stroke-linecap="{10}" stroke-dasharray="{11}"></path></marker>',t,"11","10","0 0 20 20","10","10","auto","M 1 5 L 11 10 L 1 15 Z","#000000","1","round","10000, 1"));return this.definitions[t]=e,this.components.holder.append(e),e},toString:function(){return"Graph.plugin.Definer"}})}(),function(){var t={},e=Graph.plugin.Reactor=Graph.extend(Graph.plugin.Plugin,{props:{vector:null},navigationKeys:[Graph.event.ENTER,Graph.event.DELETE,Graph.event.SHIFT,Graph.event.CTRL,Graph.event.ESC],constructor:function(e,n){var r,i=this,o=e.node(),a=e.guid();if(i.props.vector=a,i.listeners=n||{},r=t[a]=interact(o),r.on("down",function(t){t.target===o&&(t.originalType="pointerdown",e.fire(t))},!0),e.elem.on({contextmenu:function(t){t.currentTarget===o&&e.fire(t)}}),e.isPaper()){var s=Graph.$(document);s.on("keydown",function(t){i.isNavigation(t)&&Graph.cached.paper==a&&(t.originalType="keynavdown",
e.fire(t))}),s.on("keyup",function(t){i.isNavigation(t)&&Graph.cached.paper==a&&(t.originalType="keynavup",e.fire(t))}),s=null}r=null},isNavigation:function(t){var e=t.keyCode;return _.indexOf(this.navigationKeys,e)>-1},vendor:function(){return t[this.props.vector]},draggable:function(t){return this.vendor().draggable(t)},dropzone:function(t){return this.vendor().dropzone(t)},gesturable:function(t){return this.vendor().gesturable(t)},destroy:function(){var e=this.props.vector,n=t[e];n&&n.unset(),delete t[e]},toString:function(){return"Graph.plugin.Reactor"}}),n=e.prototype.on,r=e.prototype.off;e.prototype.on=function(t,e){var r=this.vector();return n.apply(r,[t,e])},e.prototype.off=function(t,e){var n=this.vector();return r.apply(n,[t,e])}}(),function(){Graph.plugin.Transformer=Graph.extend(Graph.plugin.Plugin,{props:{scale:1,rotate:0},constructor:function(t){this.actions=[],this.props.vector=t.guid()},transform:function(t){var e=this,n=Graph.util.transform2segments(t);return _.forEach(n,function(t){
var n=t.shift();e[n]&&_.isFunction(e[n])&&!function(){e[n].apply(e,t)}(n,t)}),this},queue:function(){var t=_.toArray(arguments);return this.actions.push({name:t.shift(),args:t,sort:this.actions.length}),this},translate:function(t,e){return t=_.defaultTo(t,0),e=_.defaultTo(e,0),this.queue("translate",t,e),this},rotate:function(t,e,n){return _.isUndefined(e)||_.isUndefined(n)?this.queue("rotate",t):this.queue("rotate",t,e,n),this},scale:function(t,e,n,r){return e=_.defaultTo(e,t),_.isUndefined(n)||_.isUndefined(r)?this.queue("scale",t,e):this.queue("scale",t,e,n,r),this},matrix:function(t,e,n,r,i,o){return this.queue("matrix",t,e,n,r,i,o),this},commit:function(t,e){var n=this,r=n.actions,i=n.vector(),o={translate:!1,rotate:!1,scale:!1};if(r.length){t=_.defaultTo(t,!1),e=_.defaultTo(e,!1);var a=0,s=1,p=1,h=i.matrix().clone();if(_.forEach(r,function(e){var n=e.args,r=e.name,c=n.length,l=!1;t&&(l=h.invert(!0));var u,d,f,g,v;"translate"==r&&2===c?(t?(u=l.x(0,0),d=l.y(0,0),f=l.x(n[0],n[1]),g=l.y(n[0],n[1]),
h.translate(f-u,g-d)):h.translate(n[0],n[1]),o.translate=!0):"rotate"==r?(1==c?(v=v||i.bbox(!0).toJson(),h.rotate(n[0],v.x+v.width/2,v.y+v.height/2),a+=n[0]):3==c&&(t?(f=l.x(n[1],n[2]),g=l.y(n[1],n[2]),h.rotate(n[0],f,g)):h.rotate(n[0],n[1],n[2]),a+=n[0]),o.rotate=!0):"scale"==r?(1===c||2===c?(v=v||i.bbox(!0).toJson(),h.scale(n[0],n[c-1],v.x+v.width/2,v.y+v.height/2),s*=n[0],p*=n[c-1]):4===c&&(t?(f=l.x(n[2],n[3]),g=l.y(n[2],n[3]),h.scale(n[0],n[1],f,g)):h.scale(n[0],n[1],n[2],n[3]),s*=n[0],p*=n[1]),o.scale=!0):"matrix"==r&&h.multiply(n[0],n[1],n[2],n[3],n[4],n[5])}),e)return this.actions=[],h;i.graph.matrix=h,i.attr("transform",h.toValue()),o.translate&&(o.translate={dx:h.e,dy:h.f},this.fire("translate",o.translate)),o.rotate&&(o.rotate={deg:a},this.fire("rotate",o.rotate)),o.scale&&(o.scale={sx:s,sy:p},this.fire("scale",o.scale)),this.actions=[]}},toString:function(){return"Graph.plugin.Transformer"}})}(),function(){function t(t,n){n=_.toString(n).replace(/\.{3}|\u2026/g,t),t=Graph.util.transform2segments(t)||[],
n=Graph.util.transform2segments(n)||[];for(var r,i,o,a,s=Math.max(t.length,n.length),p=[],h=[],c=0;c<s;c++){if(o=t[c]||e(n[c]),a=n[c]||e(o),o[0]!=a[0]||"rotate"==o[0].toLowerCase()&&(o[2]!=a[2]||o[3]!=a[3])||"scale"==o[0].toLowerCase()&&(o[3]!=a[3]||o[4]!=a[4]))return{equal:!1,from:o,to:a};for(p[c]=[],h[c]=[],r=0,i=Math.max(o.length,a.length);r<i;r++)r in o&&(p[c][r]=o[r]),r in a&&(h[c][r]=a[r])}return{equal:!0,from:p,to:h}}function e(t){var e=t[0];switch(e.toLowerCase()){case"translate":return[e,0,0];case"matrix":return[e,1,0,0,1,0,0];case"rotate":return 4==t.length?[e,0,t[2],t[3]]:[e,0];case"scale":return 5==t.length?[e,1,1,t[3],t[4]]:3==t.length?[e,1,1]:[e,1]}}var n=this,r=Graph.plugin.Animator=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,duration:1e3,easing:"linier"},stacks:[],constructor:function(t){this.props.vector=t.guid()},create:function(t,e,n,r){return new i(t,e,n,r)},animate:function(t,e,n,r){var o,a,s=this.vector(),p=_.extend({},s.attrs);return t instanceof i?a=t:(e=_.defaultTo(e,this.props.duration),
_.isFunction(n)&&(r=n,n=this.props.easing),n||(n=this.props.easing),o={100:t},a=new i(o,e,n,r)),a.count()?(p.transform=s.attrs.transform,p.matrix=s.matrix().clone(),this.start(a,a.frame(0),p,null),a=null,this):void(a=null)},resume:function(){},pause:function(){},stop:function(){},start:function(e,n,o,a){var s=e.count();if(!s)return void(e=null);var p,h,c,l,u,d,f,g,v=this.vector(),y=this.stacks.length,m={},x={},b={};if(a){for(g=0;g<y;g++)if(f=this.stacks[g],f.animation==e){f.frame!=n?(this.stacks.splice(g,1),d=1):u=f,v.attr(f.reset);break}}else a=+b;for(h={animation:e,vector:v},l=e.duration(),c=e.at(s-1).frame,g=0;g<s;g++){if(p=e.at(g),p.frame==n||p.frame>a*c){h.prev=e.at(g-1),h.prev=h.prev?h.prev.frame:0,h.frame=p.frame,h.duration=l/c*(h.frame-h.prev),h.next=e.at(g+1),h.next=h.next?h.next.frame:void 0,h.last=c;break}a&&v.attr(p.params)}if(u)u.initstatus=a,u.start=new Date-u.duration*a;else{l=h.duration,_.forOwn(p.params,function(e,n){var r,o,a,s,p,h,c,u,d=i.animable[n];if(d)switch(x[n]=v.attrs[n],
x[n]=_.defaultTo(x[n],d.defaults),b[n]=e,d.type){case"number":m[n]=(b[n]-x[n])/l;break;case"transform":var f=t(v.attrs[n],e);if(f.equal)for(x[n]=f.from,b[n]=f.to,m[n]=[],m[n].semantic=!0,p=0,c=x[n].length;p<c;p++)for(m[n][p]=[x[n][p][0]],h=1,u=x[n][p].length;h<u;h++)m[n][p][h]=(b[n][p][h]-x[n][p][h])/l;else r=v.plugins.transformer,s=Graph.util.transform2segments(b[n]),o=v.matrix(),x[n]=o.clone(),a=o.invert(!0),v.graph.matrix=o.multiply(a),_.forEach(s,function(t){var e=t[0],n=t.slice(1);r[e].apply(r,n)}),o=r.commit(!1,!0),b[n]=o.clone(),m[n]={a:(b[n].props.a-x[n].props.a)/l,b:(b[n].props.b-x[n].props.b)/l,c:(b[n].props.c-x[n].props.c)/l,d:(b[n].props.d-x[n].props.d)/l,e:(b[n].props.e-x[n].props.e)/l,f:(b[n].props.f-x[n].props.f)/l},s=null,r=null,o=null}});var G=+new Date;if(_.extend(h,{scene:p,timestamp:G,start:G+e.delay(),reset:o,from:x,to:b,delta:m,status:0,initstatus:a||0,stop:!1}),this.stacks.push(h),a&&!u&&!d&&(h.stop=!0,h.start=new Date-p.duration*a,1===this.stacks.length))return this.player();
d&&(h.start=new Date-p.duration*a),1===this.stacks.length&&r.play(_.bind(this.player,this))}this.fire("animstart")},player:function(){for(var t,e,n,o,a,s,p,h,c,l,u,d,u,f,g,c,v,y,m,x,b,G=+new Date,w=0;w<this.stacks.length;w++)if(e=this.stacks[w],!(e.paused||(o=G-e.start,s=e.duration,t=e.vector,l=e.scene,n=e.from,v=e.to,delta=e.delta,a=e.animation,e.initstatus?(o=(e.initstatus*e.last-e.prev)/(e.frame-e.prev)*s,e.status=e.initstatus,delete e.initstatus,e.stop&&this.stacks.splice(w--,1)):e.status=(e.prev+(e.frame-e.prev)*(o/s))/e.last,o<0)))if(o<s){ease=l.easing(o/s);for(c in n)switch(p=i.animable[c],p.type){case"number":h=+n[c]+ease*s*delta[c],t.attr(name,h);break;case"transform":if(delta[c].semantic){for(d=t.plugins.transformer,x=0,y=n[c].length;x<y;x++){for(f=n[c][x][0],g=[],b=1,m=n[c][x].length;b<m;b++)g.push(n[c][x][b]+ease*s*delta[c][x][b]);d[f].apply(d,g)}u=d.commit(!1,!0),t.attr("transform",u.toValue()),u=null,d=null}else u=Graph.matrix(n[c].props.a+ease*s*delta[c].a,n[c].props.b+ease*s*delta[c].b,n[c].props.c+ease*s*delta[c].c,n[c].props.d+ease*s*delta[c].d,n[c].props.e+ease*s*delta[c].e,n[c].props.f+ease*s*delta[c].f),
t.attr("transform",u.toValue()),u=null}}else{for(c in v)switch(p=i.animable[c],p.type){case"transform":delta[c].semantic?(d=t.plugins.transformer,_.forEach(v[c],function(t){var e=t[0],n=t.slice(1);d[e].apply(d,n)}),u=d.commit(!1,!0),t.graph.matrix=u,t.attr("transform",u.toValue()),u=null,d=null):(u=v[c].clone(),t.graph.matrix=u,t.attr("transform",u.toValue()),u=null);break;default:t.attr(c,v[c])}l.played++,this.stacks.splice(w--,1);var k=a.repeat(),C=l.played;k>1&&C<k&&!e.next&&(_.forOwn(a.scenes,function(n,r){for(var i in n.params)"transform"==i?(t.graph.matrix=e.reset.matrix,t.attr("transform",e.reset.transform)):t.attr(r,e.reset[r])}),this.start(a,a.frame(0),e.reset,null)),e.next&&!e.stop&&this.start(a,e.next,e.reset,null),C>=k&&(e=null)}this.stacks.length&&r.play(_.bind(this.player,this))},toString:function(){return"Graph.plugin.Animator"}});r.play=function(t){var e=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){
setTimeout(t,16)};return _.bind(e,t)}(n);var i=Graph.extend({props:{easing:"linier",duration:1e3,repeat:1,delay:0},scenes:{},frames:[],constructor:function(t,e,n,r){if(this.props.guid="graph-anim-"+ ++i.guid,this.props.duration=e=_.defaultTo(e,1e3),_.isFunction(n)&&(r?this.props.easing="function":(r=n,n=this.props.easing)),n||(n=this.props.easing),t){var n=_.isString(n)?i.easing[n]:n,o=(this.props.repeat,this.scenes),a=this.frames;_.forOwn(t,function(t,e){var s,p,h={};s=_.toNumber(e),h=_.pickBy(t,function(t,e){return!!i.animable[e]}),p={frame:s,params:h,easing:n,callback:r,played:0},a.push(s),o[s]=p}),a.sort(function(t,e){return t-e})}},guid:function(){return this.props.guid},duration:function(){return this.props.duration},easing:function(){return this.props.easing},delay:function(t){if(void 0===t)return this.props.delay;var e=new i;return e.frames=this.frames,e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.delay=t||0,e},repeat:function(t){if(void 0===t)return this.props.repeat;
var e=new i;return e.frames=this.frames.slice(),e.scenes=_.cloneDeep(this.scenes),e.props=_.cloneDeep(this.props),e.props.repeat=Math.floor(Math.max(t,0))||1,_.forOwn(e.scenes,function(t,e){t.played=0}),e},count:function(){return this.frames.length},at:function(t){var e=this.frame(t);return this.scene(e)},frame:function(t){return this.frames[t]},scene:function(t){return this.scenes[t]},destroy:function(){this.scenes=null,this.frames=null}});_.extend(i,{guid:0,animable:{x:{type:"number",defaults:0},y:{type:"number",defaults:0},cx:{type:"number",defaults:0},cy:{type:"number",defaults:0},transform:{type:"transform",defaults:""}},easing:{linier:function(t){return t},easeIn:function(t){return Math.pow(t,1.7)},easeOut:function(t){return Math.pow(t,.48)},easeInOut:function(t){var e=.48-t/1.04,n=Math.sqrt(.1734+e*e),r=n-e,i=Math.pow(Math.abs(r),1/3)*(r<0?-1:1),o=-n-e,a=Math.pow(Math.abs(o),1/3)*(o<0?-1:1),s=i+a+.5;return 3*(1-s)*s*s+s*s*s},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e);
},backOut:function(t){t-=1;var e=1.70158;return t*t*((e+1)*t+e)+1},elastic:function(t){return t==!!t?t:pow(2,-10*t)*math.sin((t-.075)*(2*PI)/.3)+1},bounce:function(t){var e,n=7.5625,r=2.75;return t<1/r?e=n*t*t:t<2/r?(t-=1.5/r,e=n*t*t+.75):t<2.5/r?(t-=2.25/r,e=n*t*t+.9375):(t-=2.625/r,e=n*t*t+.984375),e}}})}(),function(){Graph.plugin.Resizer=Graph.extend(Graph.plugin.Plugin,{props:{context:null,vector:null,enabled:!0,suspended:!0,handleImage:Graph.config.base+"img/resize-control.png",handleSize:17,rendered:!1},components:{holder:null,helper:null,handle:null},trans:{ox:0,oy:0,ow:0,oh:0,cw:0,ch:0,dx:0,dy:0},constructor:function(t,e){var n=this,r=t.guid();e=e||{},e.context?e.context=e.context.guid():e.context=r,_.assign(n.props,e),t.addClass("graph-resizable"),n.props.handleImage=Graph.config.base+"img/resize-control.png",n.props.vector=r,n.cached.snapping=null,n.cached.vertices=null,n.initComponent()},holder:function(){return Graph.registry.vector.get(this.components.holder)},helper:function(){
return Graph.registry.vector.get(this.components.helper)},handle:function(t){return Graph.registry.vector.get(this.components.handle[t])},initComponent:function(){var t,e,n=this,r=n.components;t=(new Graph.svg.Group).addClass("graph-resizer").removeClass("graph-elem graph-elem-group"),t.elem.group("graph-resizer"),t.on({render:_.bind(n.onHolderRender,n)}),e=new Graph.svg.Rect(0,0,0,0,0).addClass("graph-resizer-helper").removeClass("graph-elem graph-elem-rect").selectable(!1).clickable(!1).render(t),e.elem.group("graph-resizer"),r.handle={};var i={ne:{cursor:"nesw-resize"},se:{cursor:"nwse-resize"},sw:{cursor:"nesw-resize"},nw:{cursor:"nwse-resize"},n:{cursor:"ns-resize",axis:"y"},e:{cursor:"ew-resize",axis:"x"},s:{cursor:"ns-resize",axis:"y"},w:{cursor:"ew-resize",axis:"x"}};_.forOwn(i,function(e,i){!function(i){var o=new Graph.svg.Image(n.props.handleImage,0,0,n.props.handleSize,n.props.handleSize).selectable(!1).removeClass("graph-elem graph-elem-image").addClass("graph-resizer-handle handle-"+i);
o.elem.group("graph-resizer"),o.props.dir=i,o.draggable(e),o.on("dragstart",_.bind(n.onHandleMoveStart,n)),o.on("dragmove",_.bind(n.onHandleMove,n)),o.on("dragend",_.bind(n.onHandleMoveEnd,n)),o.render(t),r.handle[i]=o.guid(),o=null}(i)}),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null,i=null},invalidate:function(){this.superclass.prototype.invalidate.call(this),this.cached.vertices=null},render:function(){var t=this;return t.props.rendered?void t.redraw():(t.holder().render(t.vector().parent()),t.props.rendered=!0,void t.redraw())},snap:function(t){this.cached.snapping=t},vertices:function(){var t=this,e=t.vector(),n=t.cached.vertices;if(!n){var r,i,o,a,s,p,h,c,l=e.pathinfo(),u=l.bbox().toJson(),d=e.globalMatrix().rotate();if(r=d.deg,i=0,o=0,a=u.x,s=u.y,p=t.props.handleSize/2,r){var f=Graph.matrix(),l=t.pathinfo();i=u.x+u.width/2,o=u.y+u.height/2,f.rotate(-r,i,o),l=l.transform(f),u=l.bbox().toJson()}else this.props.context!=this.props.vector&&(l=t.pathinfo(),u=l.bbox().toJson());h=u.width/2,
c=u.height/2,n={ne:{x:u.x+u.width-p,y:u.y-p},se:{x:u.x+u.width-p,y:u.y+u.height-p},sw:{x:u.x-p,y:u.y+u.height-p},nw:{x:u.x-p,y:u.y-p},n:{x:u.x+h-p,y:u.y-p},e:{x:u.x+u.width-p,y:u.y+c-p},s:{x:u.x+h-p,y:u.y+u.height-p},w:{x:u.x-p,y:u.y+c-p},rotate:{deg:r,cx:i,cy:o},box:{x:u.x,y:u.y,width:u.width,height:u.height},offset:{x:a,y:s}},this.cached.vertices=n}return n},redraw:function(){var t,e=this,n=e.helper(),r=e.holder();r&&(t=this.vertices(),t&&(n.reset(),n.attr({x:t.box.x,y:t.box.y,width:t.box.width,height:t.box.height}),n.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit(),_.forOwn(e.components.handle,function(n,r){!function(n,r){var i=e.handle(r);i.show(),i.reset(),i.attr(t[r]),i.rotate(t.rotate.deg,t.rotate.cx,t.rotate.cy).commit()}(n,r)}),e.trans.ox=t.offset.x,e.trans.oy=t.offset.y,e.trans.ow=this.trans.cw=t.box.width,e.trans.oh=this.trans.ch=t.box.height,e.trans.dx=0,e.trans.dy=0))},suspend:function(){this.props.suspended=!0,this.holder().elem.detach()},resume:function(){this.props.enabled&&this.props.suspended&&(this.props.suspended=!1,
this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render())},onHolderRender:function(t){},onHandleMoveStart:function(t){var e=this,n=t.publisher;_.forOwn(e.components.handle,function(t,r){var i=e.handle(r);i!==n&&i.hide()});var r=this.cached.snapping;r&&n.draggable().snap()!==r&&n.draggable().snap(r),n.show(),n.removeClass("dragging")},onHandleMove:function(t){var e=this,n=e.helper(),r=t.publisher,i=this.trans,o=t.dx,a=t.dy;switch(r.props.dir){case"ne":i.cw+=o,i.ch-=a,e.trans.dy+=a,n.translate(0,a).commit();break;case"se":i.cw+=o,i.ch+=a;break;case"sw":i.cw-=o,i.ch+=a,e.trans.dx+=o,n.translate(o,0).commit();break;case"nw":i.cw-=o,i.ch-=a,e.trans.dx+=o,e.trans.dy+=a,n.translate(o,a).commit();break;case"n":i.cw+=0,i.ch-=a,e.trans.dy+=a,n.translate(0,a).commit();break;case"e":i.cw+=o,i.ch+=0;break;case"s":i.cw+=0,i.ch+=a;break;case"w":i.cw-=o,i.ch+=0,e.trans.dx+=o,n.translate(o,0).commit()}n.attr({width:i.cw,height:i.ch})},onHandleMoveEnd:function(t){
var e,n,r,i,o,a,s=this,p=this.trans,h=t.publisher;switch(e=p.ow>0?p.cw/p.ow:1,n=p.oh>0?p.ch/p.oh:1,o=p.dx,a=p.dy,h.props.dir){case"ne":r=p.ox,i=p.oy+p.oh;break;case"se":r=p.ox,i=p.oy;break;case"sw":r=p.ox+p.ow,i=p.oy;break;case"nw":r=p.ox+p.ow,i=p.oy+p.oh;break;case"n":r=p.ox+p.ow/2,i=p.oy+p.oh;break;case"e":r=p.ox,i=p.oy+p.oh/2;break;case"s":r=p.ox+p.ow/2,i=p.oy;break;case"w":r=p.ox+p.ow,i=p.oy+p.oh/2}var c=s.vector(),l=c.bbox().center().toJson(),u=c.resize(e,n,r,i,o,a),d=c.bbox().center().toJson(),f=d.x-l.x,g=d.y-l.y;u.translate.dx=f,u.translate.dy=g,s.redraw(),s.fire("resize",u)},destroy:function(){var t=this;_.forOwn(t.components.handle,function(e,n){var r=t.handle(n);r.remove()}),t.components.handle=null,t.helper().remove(),t.components.helper=null,t.holder().remove(),t.components.holder=null,t.listeners=null}})}(),function(){Graph.plugin.Collector=Graph.extend(Graph.plugin.Plugin,{props:{enabled:!1,suspended:!0,rendered:!1,activator:"tool",ready:!1},paper:null,collection:[],components:{
rubber:null},collecting:{},constructor:function(t){var e=this;if(!t.isPaper())throw Graph.error("Lasso tool only available for paper !");e.paper=t,e.components.rubber=Graph.$('<div class="graph-rubberband">'),t.on("keynavdown",_.bind(e.onKeynavDown,e)),t.on("keynavup",_.bind(e.onKeynavUp,e)),e.paper.props.rendered?e.setup():e.paper.on("render",function(){e.setup()})},enable:function(t){this.props.enabled=!0,this.props.activator=t,this.paper.cursor("crosshair"),this.paper.state("collecting")},disable:function(){this.props.enabled=!1,this.paper.cursor("default")},setup:function(){var t=this;if(!t.props.ready){t.props.ready=!0;var e=t.collecting,n=t.paper,r=n.layout(),i=r.offset(),o=t.components.rubber,a=n.interactable().vendor();a.styleCursor(!1),a.draggable({manualStart:!0,onstart:function(t){_.assign(e,{start:{x:t.clientX,y:t.clientY},end:{x:t.clientX,y:t.clientY},bounds:{}}),o.query.css({width:0,height:0,transform:"translate("+(e.start.x-i.left)+"px, "+(e.start.y-i.top)+"px)"})},onmove:function(t){
var n,r=e.start,a={x:t.clientX,y:t.clientY};n=r.x<=a.x&&r.y<a.y||r.x<a.x&&r.y<=a.y?{x:r.x,y:r.y,width:a.x-r.x,height:a.y-r.y}:r.x>=a.x&&r.y<a.y||r.x>a.x&&r.y<=a.y?{x:a.x,y:r.y,width:r.x-a.x,height:a.y-r.y}:r.x<=a.x&&r.y>a.y||r.x<a.x&&r.y>=a.y?{x:r.x,y:a.y,width:a.x-r.x,height:r.y-a.y}:r.x>=a.x&&r.y>a.y||r.x>a.x&&r.y>=a.y?{x:a.x,y:a.y,width:r.x-a.x,height:r.y-a.y}:{x:a.x,y:a.y,width:0,height:0},e.bounds=n,o.query.css({width:n.width,height:n.height,transform:"translate("+(n.x-i.left)+"px,"+(n.y-i.top)+"px)"})},onend:function(){var i=n.guid(),o=Graph.registry.vector.collect(i),a=e.bounds,s=(r.scale(),r.grabLocation({clientX:a.x,clientY:a.y})),p=r.grabLocation({clientX:a.x+a.width,clientY:a.y+a.height}),h=new Graph.lang.BBox({x:s.x,y:s.y,x2:p.x,y2:p.y,width:p.x-s.x,height:p.y-s.y});h.transform(n.viewport().matrix()),_.forEach(o,function(e){e.guid()!=i&&e.isSelectable()&&!e.isGroup()&&h.contains(e)&&t.collect(e,!0)}),"tool"==t.props.activator&&n.tool().activate("panzoom"),h=null,t.suspend()}
}).on("down",function(e){var n=!(e.ctrlKey||e.shiftKey),r=Graph.registry.vector.get(e.target);r&&(r.isSelectable()||r.elem.belong("graph-resizer")||r.elem.belong("graph-link")||n&&t.clearCollection())}).on("tap",function(e){var n=Graph.registry.vector.get(e.target),r=!(e.ctrlKey||e.shiftKey);if(n&&n.isSelectable()){if("linking"==n.paper().state())return void t.clearCollection();r&&t.clearCollection(),t.collect(n,!r)}},!0).on("move",function(e){var r=e.interaction;if(t.props.enabled&&r.pointerIsDown&&!r.interacting()){var i={name:"drag"};r.prepared.name=i.name,r.setEventXY(r.startCoords,r.pointers),e.currentTarget===n.node()&&(t.props.suspended&&t.resume(),r.start(i,e.interactable,o.node()))}})}},render:function(){var t=this;t.props.rendered||(t.paper.container().append(t.components.rubber),t.props.rendered=!0)},collect:function(t,e){var n,r=this;t.lasso=this,t.batch=e,t.select(e),n=_.indexOf(this.collection,t),n===-1&&this.collection.push(t),Graph.cached.paper=r.paper.guid()},decollect:function(t){
var e,n;e=t.batch,delete t.lasso,delete t.batch,t.deselect(e),n=_.indexOf(this.collection,t),n>-1&&this.collection.splice(n,1)},clearCollection:function(t){var e=this,n=e.collection.slice();_.forEach(n,function(n){n!==t&&e.decollect(n)}),n=null},suspend:function(){this.props.suspended=!0,this.components.rubber.detach()},resume:function(){this.props.suspended&&(this.props.suspended=!1,this.props.rendered?this.paper.container().append(this.components.rubber):this.render())},syncDragStart:function(t,e){var n=this;_.forEach(n.collection,function(n){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(){var t=n.graph.matrix.data(),r=t.sin,i=t.cos;n.plugins.resizer&&!n.plugins.resizer.suspended&&n.plugins.resizer.suspend(),n.plugins.dragger.props.ghost&&n.plugins.dragger.resume(),n.syncdrag={sin:r,cos:i,tdx:0,tdy:0},n.addClass("dragging"),n.fire("dragstart",{dx:e.dx*i+e.dy*r,dy:e.dx*-r+e.dy*i,batch:!0})}()}),n.fire("beforedrag")},syncDragMove:function(t,e){var n=this;_.forEach(n.collection,function(n){
n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){var n=e.ox*t.syncdrag.cos+e.oy*t.syncdrag.sin,r=e.ox*-t.syncdrag.sin+e.oy*t.syncdrag.cos;t.plugins.dragger.props.ghost?t.plugins.dragger.helper().translate(e.ox,e.oy).commit():t.translate(n,r).commit(),t.syncdrag.tdx+=n,t.syncdrag.tdy+=r,t.fire("dragmove",{dx:n,dy:r,batch:!0})}(n,e)})},syncDragEnd:function(t,e){var n=this;_.forEach(n.collection,function(n,r){n.plugins.dragger&&n.plugins.dragger.props.enabled&&n!==t&&!function(t,e){var n=t.plugins.dragger.props.batchSync,r=t.plugins.dragger.props.ghost;r&&(n&&t.translate(t.syncdrag.tdx,t.syncdrag.tdy).commit(),t.plugins.dragger.suspend()),n||t.dirty(!0),t.fire("dragend",{dx:t.syncdrag.tdx,dy:t.syncdrag.tdy,batch:!0}),t.removeClass("dragging"),delete t.syncdrag}(n,e)}),e.origin=t,e.type="afterdrag",n.fire(e)},toString:function(){return"Graph.plugin.Collector"},onKeynavDown:function(t){if(t.keyCode==Graph.event.SHIFT&&"key"!=this.props.activator){var e=this.paper.tool(),n=e.current();
"collector"!=n&&e.activate("collector","key")}},onKeynavUp:function(t){if(t.keyCode==Graph.event.SHIFT){var e=this.paper.tool(),n=e.current();"collector"==n&&(this.props.activator="tool",e.activate("panzoom"))}}})}(),function(){Graph.plugin.Dragger=Graph.extend(Graph.plugin.Plugin,{props:{ready:!1,manual:!1,ghost:!1,vector:null,enabled:!0,rendered:!1,suspended:!0,inertia:!1,bound:!1,grid:null,axis:!1,cursor:"move",dragClass:"",batchSync:!0},rotation:{deg:0,rad:0,sin:0,cos:1},scaling:{x:1,y:1},trans:{vector:null,paper:null,helper:null,dx:0,dy:0},components:{holder:null,helper:null},constructor:function(t,e){var n=this;t.addClass("graph-draggable"),n.props.vector=t.guid(),e=_.extend({inertia:!1},e||{}),_.forEach(["axis","grid","bbox","ghost"],function(t){void 0!==e[t]&&(n.props[t]=e[t])}),_.assign(n.props,e),n.cached.snapping=null,n.cached.origin=null,n.initComponent(),t.on("render.dragger",_.bind(n.onVectorRender,n)),t.props.rendered&&n.setup()},holder:function(){return Graph.registry.vector.get(this.components.holder);
},helper:function(){return Graph.registry.vector.get(this.components.helper)},initComponent:function(){var t,e,n=this,r=n.components;if(n.props.ghost){t=(new Graph.svg.Group).addClass("graph-dragger").removeClass("graph-elem graph-elem-group").traversable(!1).selectable(!1);var i="graph-dragger-helper"+(n.props.dragClass?" "+n.props.dragClass:"");e=new Graph.svg.Rect(0,0,0,0,0).addClass(i).removeClass("graph-elem graph-elem-rect").traversable(!1).selectable(!1).clickable(!1).render(t),i=null,e.elem.data(Graph.string.ID_VECTOR,this.vector().guid()),r.holder=t.guid(),r.helper=e.guid(),t=null,e=null}},setup:function(){var t,e,n,r,i;if(!this.props.ready){t=this,e=t.vector(),r=e.paper(),i={},_.extend(i,{manualStart:!0,onstart:_.bind(t.onDragStart,t),onmove:_.bind(t.onDragMove,t),onend:_.bind(t.onDragEnd,t)}),n=e.interactable().vendor(),n.draggable(i),n.styleCursor(!1),t.cached.origin=n.origin(),t.cached.snapping=[],n.on("down",function(t){t.preventDefault()}),t.props.manual||n.on("move",_.bind(t.onPointerMove,t,_,e));
var o=e.globalMatrix(),a=o.rotate(),s=o.scale();t.rotate(a.deg),t.scale(s.x,s.y),t.props.grid&&t.snap({mode:"grid",x:t.props.grid[0],y:t.props.grid[1]}),t.props.ready=!0}},enable:function(){this.props.enabled=!0},disable:function(){this.props.enabled=!1},ghost:function(t){return void 0===t?this.props.ghost:(this.props.ghost=t,this)},render:function(){var t=this,e=t.vector();t.props.rendered||(t.props.rendered=!0,t.holder().render(e.parent())),t.props.ghost&&t.redraw()},suspend:function(){this.props.suspended=!0,this.holder().elem.detach()},resume:function(){this.props.suspended=!1,this.props.rendered?(this.vector().parent().elem.append(this.holder().elem),this.redraw()):this.render()},redraw:function(){var t=this.vector(),e=this.helper();if(e){var n=t.bbox().toJson(),r=e.bbox().toJson(),i=n.x-r.x,o=n.y-r.y;e.translate(i,o).commit(),e.attr({width:n.width,height:n.height})}},rotate:function(t){var e=Graph.util.rad(t);this.rotation.deg=t,this.rotation.rad=e,this.rotation.sin=Math.sin(e),this.rotation.cos=Math.cos(e);
},scale:function(t,e){e=_.defaultTo(e,t),this.scaling.x=t,this.scaling.y=e},origin:function(t){if(void 0===t)return this.cached.origin;this.cached.origin=t;var e=this.vector().interactable().vendor();e&&e.origin(t)},snap:function(t,e){function n(t){return _.isFunction(t)?t:(t.mode=_.defaultTo(t.mode,"anchor"),"grid"==t.mode?("x"==r.props.axis?t.y=0:"y"==r.props.axis&&(t.x=0),t=interact.createSnapGrid({x:t.x,y:t.y})):t.range=_.defaultTo(t.range,20),t)}if(void 0===t)return this.cached.snapping;void 0===e&&(e=!1);var r=this,i=[];this.cached.snapping=t,_.isArray(t)?_.forEach(t,function(t){i.push(n(t))}):i.push(n(t));var o=this.vector().interactable().vendor();o&&o.setOptions("snap",{targets:i,endOnly:e})},resetSnap:function(){this.snaps=[],this.snap({mode:"grid",x:this.props.grid[0],y:this.props.grid[1]})},bound:function(t){},onVectorRender:function(){this.setup()},onPointerMove:function(t,e){var n=t.interaction;if(this.props.enabled&&n.pointerIsDown&&!n.interacting()){var r=e.paper(),i=e.node(),o={
name:"drag"};if(n.prepared.name=o.name,n.setEventXY(n.startCoords,n.pointers),t.currentTarget===i){if(r){var a=r.state();if("collecting"==a){if(!e.elem.belong("graph-resizer"))return;r.tool().activate("panzoom")}else if("linking"==a)return}this.props.ghost?(this.props.suspended&&this.resume(),n.start(o,t.interactable,this.helper().node())):n.start(o,t.interactable,i)}}t.preventDefault()},onDragStart:function(t){var e=this.vector(),n=e.paper(),r=this.helper();e.addClass("dragging"),n.cursor(this.props.cursor),this.trans.vector=e,this.trans.paper=n,this.trans.helper=r,this.trans.dx=0,this.trans.dy=0,this.trans.hx=0,this.trans.hy=0;var i={x:t.clientX,y:t.clientY,dx:0,dy:0,ghost:this.props.ghost,batch:!1};this.fire("dragstart",i)},onDragMove:function(t){var e=this.trans,n=(e.paper,e.vector),r=e.helper,i=this.props.axis,o=(this.rotation.deg,this.rotation.sin),a=this.rotation.cos,s=this.scaling.x,p=this.scaling.y,h=n.globalMatrix().scale();h.x===s&&h.y===p||(this.scale(h.x,h.y),s=h.x,p=h.y);var c,l,u,d,f,g,v=_.defaultTo(t.dx,0),y=_.defaultTo(t.dy,0);
c=l=u=d=f=g=0,v/=s,y/=p,"x"==i?(c=u=v,l=d=0,f=v*a+0*o,g=v*-o+0*a):"y"==i?(c=u=0,l=d=y,f=0*a+y*o,g=0*-o+y*a):(u=v,d=y,c=f=v*a+y*o,l=g=v*-o+y*a),this.trans.dx+=f,this.trans.dy+=g,this.trans.hx+=u,this.trans.hy+=d;var m=_.defaultTo(t.pageX,t.x0),m=_.defaultTo(t.pageY,t.y0);m/=s,m/=p;var x={pageX:m,pageY:m,ex:v,ey:y,dx:c,dy:l,hx:u,hy:d,ox:u,oy:d,ghost:this.props.ghost,batch:!1};this.fire("dragmove",x),r?r.translate(x.hx,x.hy).commit():n.translate(x.dx,x.dy).commit()},onDragEnd:function(t){var e=this.trans,n=e.paper,r=e.vector,i=e.helper,o=e.dx,a=e.dy;e.hx,e.hy;i&&(r.translate(o,a).commit(),this.redraw(),this.suspend()),r.removeClass("dragging"),n.cursor("default");var s={dx:o,dy:a,ghost:this.props.ghost,batch:!1};this.fire("dragend",s),this.trans.vector=null,this.trans.paper=null,this.trans.helper=null,this.trans.dx=0,this.trans.dy=0,this.trans.hx=0,this.trans.hy=0},destroy:function(){var t=this;t.components.helper&&t.helper().remove(),t.components.helper=null,t.components.holder&&t.holder().remove(),
t.components.holder=null,t.listeners={}}})}(),function(){Graph.plugin.Dropper=Graph.extend(Graph.plugin.Plugin,{props:{overlap:"center",accept:".graph-draggable"},constructor:function(t,e){var n=this;_.assign(n.props,e||{}),t.addClass("graph-dropzone").removeClass("graph-draggable"),n.props.vector=t.guid(),t.on({render:_.bind(n.onVectorRender,n)}),t.props.rendered&&n.setup()},setup:function(){var t=this;if(!t.plugin){var e=_.extend({},t.props,{checker:_.bind(t.onDropValidate,t),ondropactivate:_.bind(t.onDropActivate,t),ondropdeactivate:_.bind(t.onDropDeactivate,t),ondragenter:_.bind(t.onDragEnter,t),ondragleave:_.bind(t.onDragLeave,t),ondrop:_.bind(t.onDrop,t)});t.plugin=t.vector.interactable().dropzone(e)}},onDropValidate:function(t,e,n,r,i,o,a){return n},onVectorRender:function(){this.setup()},onDropActivate:function(t){this.vector().addClass("drop-activate")},onDropDeactivate:function(t){this.vector().removeClass("drop-activate")},onDragEnter:function(t){this.vector().removeClass("drop-activate").addClass("drop-enter"),
t.type="dropenter",this.fire(t)},onDragLeave:function(t){this.vector().removeClass("drop-enter").addClass("drop-activate"),t.type="dropleave",this.fire(t)},onDrop:function(t){this.vector().removeClass("drop-activate drop-enter")}})}(),function(){Graph.plugin.Sorter=Graph.extend(Graph.plugin.Plugin,{props:{height:0,width:0,suspended:!0,enabled:!0,offsetTop:0,offsetLeft:0},sortables:[],origins:[],guests:[],batch:[],trans:{sorting:!1,valid:!1,drag:null,drop:null},components:{helper:null},constructor:function(t){var e=this;e.vector=t,e.vector.addClass("graph-sorter"),e.components.helper=new Graph.svg.Rect(0,0,0,0),e.components.helper.addClass("graph-sorter-helper"),e.components.helper.removeClass("graph-elem graph-elem-rect"),e.components.helper.props.selectable=!1,e.components.helper.render(e.vector),e.components.helper.$sorter=e,e.sortables.push(e.components.helper),e.vector.on({render:_.bind(e.onVectorRender,e),appendchild:_.bind(e.onItemAdded,e),prependchild:_.bind(e.onItemAdded,e)}),e.vector.props.rendered&&e.setup();
},setup:function(){var t=this,e=t.vector,n=e.paper(),r=e.node();t.plugin||(t.plugin=interact(".graph-sortable",{context:r}).dropzone({accept:".graph-sortable",overlap:.1,ondropactivate:_.bind(t.onSortActivate,t),ondropdeactivate:_.bind(t.onSortDeactivate,t),ondragenter:_.bind(t.onSortEnter,t),ondragleave:_.bind(t.onSortLeave,t),ondrop:_.bind(t.onSort,t)}),t.plugin.styleCursor(!1),n.plugins.collector&&n.plugins.collector.on({afterdrag:function(e){var n=e.origin;_.indexOf(t.sortables,n)>-1&&(t.props.offsetTop+=e.dy)}}))},snapping:function(t,e,n,r,i,o,a){return n},suspend:function(){this.props.suspended=!0,this.components.helper&&(this.components.helper.focus(!1),this.components.helper.removeClass("visible"))},resume:function(){var t=this;t.props.suspended=!1,t.components.helper&&t.components.helper.addClass("visible")},redraw:function(){var t=this;t.trans.valid&&(t.props.suspended&&t.resume(),t.swap(t.components.helper,t.trans.drop),t.components.helper.focus())},commit:function(){var t=this;
_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$master=!1,t.$sorter=null,t.$sorting=!1}),t.components.helper.attr("height",0),t.batch.length?t.permute():t.swap(t.trans.drag,t.components.helper),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.reset(),t.suspend(),t.resumeBatch(t.batch)},revert:function(){var t=this;_.forEach(t.guests,function(e){t.vector.elem.append(e.node())}),_.forEach(t.sortables,function(t){t.$sorting=!1,t.$sorter=null,t.$master=!1}),_.forEach(t.origins,function(t){t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend()}),t.components.helper.attr("height",0),t.reset(),t.arrange(),t.suspend(),t.resumeBatch(t.batch)},permute:function(){var t=this,e=_.indexOf(t.sortables,t.components.helper),n=_.map(t.sortables,function(t,e){return e});t.batch.sort(function(t,e){var n=t.offset().top,r=e.offset().top;return n===r?0:n<r?-1:1}),orders=_.map(t.batch,function(e){
return _.indexOf(t.sortables,e)});var r=_.difference(n,orders),i=_.indexOf(r,e);_.insert(r,i,orders),t.sortables=_.permute(t.sortables,r),t.arrange()},swap:function(t,e){var n=this,r=_.indexOf(n.sortables,t),i=_.indexOf(n.sortables,e);_.move(n.sortables,r,i),n.arrange()},arrange:function(){var t=this;t.props.height=0,t.props.width=0,_.forEach(t.sortables,function(e){if(!e.$sorting){var n=e.bbox().toJson(),r=t.props.height-n.y+t.props.offsetTop;e.translate(0,r).commit(),t.props.height+=n.height,n.width>t.props.width&&(t.props.width=n.width)}})},suspendBatch:function(t,e){_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.suspend()}),e&&e.call(t,t)})},resumeBatch:function(t){var e;e=_.delay(function(){clearTimeout(e),_.forEach(t,function(t){t.cascade(function(t){t.props.selected&&t.resizer&&t.resizer.resume()})})},0)},reset:function(){this.guests=[],this.origins=[],this.trans.drag=null,this.trans.sorting=!1,this.trans.valid=!1,this.trans.drop=null},enroll:function(t){
var e,n=this;_.indexOf(n.sortables,t)===-1&&(e=t.$sorter,e.release(t),_.indexOf(n.origins,e)===-1&&n.origins.push(e),t.$sorter=n,t.$master&&(n.trans.drag=t),t.off(".sorter"),t.tree.parent=n.vector,n.vector.children().push(t),n.guests.push(t))},release:function(t){var e,n=this,r=t.$sorter||n;t.off(".sorter"),t.$sorter=null,t.tree.parent=null,t.$master&&(r.trans.drag=null),r.vector.children().pull(t),(e=_.indexOf(r.sortables,t))>-1&&r.sortables.splice(e,1),(e=_.indexOf(r.batch,t))>-1&&r.batch.splice(e,1),(e=_.indexOf(r.guests,t))>-1&&r.guests.splice(e,1)},onVectorRender:function(){this.setup()},onItemAdded:function(t){var e,n=this;_.indexOf(n.sortables,t)>-1||t.hasClass("graph-sorter-helper")||(t.$sorter=this,t.addClass("graph-sortable"),t.off(".sorter"),t.on("render.sorter",_.bind(n.onItemRender,n)),t.on("resize.sorter",_.bind(n.onItemResize,n)),t.on("dragstart.sorter",_.bind(n.onItemDragStart,n)),t.on("dragend.sorter",_.bind(n.onItemDragEnd,n)),t.on("collect.sorter",_.bind(n.onItemCollect,n)),
t.on("decollect.sorter",_.bind(n.onItemDecollect,n)),n.sortables.push(t),t.props.rendered&&!t.$sorting&&(e=_.delay(function(){clearTimeout(e),n.arrange()},0)))},onItemRender:function(t){var e,n=this;e=_.delay(function(){clearTimeout(e),n.arrange()},0)},onItemResize:function(t){function e(t,e){t.cascade(function(t){if(t.props.selected&&t.resizer){var n=e?"suspend":"resume";t.resizer[n].call(t.resizer)}})}var n,r=t.publisher,i=r.$sorter||this;e(r,!0),_.forEach(i.sortables,function(e){e!==r&&(t.type="resize.sortable",e.fire(t))}),n=_.defer(function(t){clearTimeout(n),i.arrange(),e(t,!1)},r)},onItemDragStart:function(t){var e,n=this,r=t.publisher,i=n.batch.length;n.props.enabled=!i||i+1!==n.sortables.length,n.props.enabled&&(r.$sorter=n,r.$master=!0,r.$sorting=!0,n.trans.drag=r,n.trans.sorting=!0,e=r.bbox().toJson(),width=n.props.width,height=e.height,i&&(r.lasso?(height=0,n.suspendBatch(n.batch,function(t){var e=t.bbox().toJson();height+=e.height,t.$sorter=n,t.$sorting=!0})):(n.batch.pop().lasso.clearCollection(),
n.batch=[])),n.components.helper.attr({width:width,height:height}))},onItemDragEnd:function(t){var e=this;e.props.enabled&&(e.trans.sorting?e.trans.valid||e.revert():e.revert())},onItemCollect:function(t){var e=t.publisher,n=e.$sorter||this;n.batch.push(e)},onItemDecollect:function(t,e){var n,e=t.publisher,r=e.$sorter||this;n=_.indexOf(r.batch,e),n>-1&&r.batch.splice(n,1)},onSortActivate:function(){},onSortDeactivate:function(){},onSortEnter:function(t){var e,n,r,i,o,a=this;a.props.enabled&&(e=Graph.registry.vector.get(t.relatedTarget),n=Graph.registry.vector.get(t.target),e.lasso?(o=0,i=a.props.width,_.forEach(e.lasso.collection,function(t){var e;t.$sorter&&(t.$sorter!==a&&(a.enroll(t),a.batch.push(t)),e=t.bbox().toJson(),o+=e.height,e.width>i&&(i=e.width))}),a.components.helper.attr({width:i,height:o})):e.$sorter&&e.$sorter!==a&&(a.batch.length&&a.suspendBatch(a.batch),a.enroll(e),r=e.bbox().toJson(),o=r.height,i=a.props.width,a.components.helper.attr({width:i,height:o})),a.trans.drop=n,
a.trans.valid=!0,a.redraw())},onSortLeave:function(){var t=this;t.props.enabled&&(t.trans.drop=null,t.trans.valid=!1,t.suspend())},onSort:function(){var t=this;t.props.enabled&&t.commit()}})}(),function(){var t="connect-valid",e="connect-invalid",n="connect-valid connect-invalid",r="connect-valid connect-invalid connect-hover",i="connect-hover";Graph.plugin.Network=Graph.extend(Graph.plugin.Plugin,{props:{context:null,vector:null,wiring:"h:h"},linking:{valid:!1,router:null,source:null,target:null,link:null,pole:null},constructor:function(o,a){var s=this,p=o.guid();a=a||{},a.context?a.context=a.context.guid():a.context=p,_.assign(s.props,a),s.props.vector=p,s.cached.cables={},s.cached.pairs={},o.addClass("graph-connectable");var h=o.interactable().vendor();h.dropzone({accept:_.format(".{0}, .{1}",Graph.styles.LINK_HEAD,Graph.styles.LINK_TAIL),overlap:.2}).on("dropdeactivate",function(t){var e=Graph.registry.vector.get(t.target);e&&e.removeClass(r),s.invalidateTrans()}).on("dropactivate",function(t){
var e=Graph.registry.vector.get(t.target);e&&e.addClass(i),s.invalidateTrans()}).on("dragenter",function(n){var r=Graph.registry.link.get(n.relatedTarget);if(r){var i,a,p,h=Graph.$(n.relatedTarget).data("pole");"head"==h?(a=r.router.source(),p=o):(a=o,p=r.router.target()),i=a.connectable().canConnect(p.connectable(),r),i?(o.removeClass(e),o.addClass(t)):(o.removeClass(t),o.addClass(e)),_.assign(s.linking,{valid:i,router:r.router,source:a,target:p,pole:h}),r.router.updateTrans("CONNECT",{valid:i,source:a,target:p})}}).on("dragleave",function(t){var e=Graph.registry.vector.get(t.target);e&&e.removeClass(n),s.linking.valid=!1,"head"==s.linking.pole?s.linking.router.updateTrans("CONNECT",{valid:!1,target:null}):s.linking.router.updateTrans("CONNECT",{valid:!1,source:null})}).on("drop",function(t){s.linking.valid&&("head"==s.linking.pole?s.linking.router.updateTrans("CONNECT",{target:o}):s.linking.router.updateTrans("CONNECT",{source:o}))})},invalidateTrans:function(){for(var t in this.linking)this.linking[t]=null;
},wiring:function(){return this.props.wiring},treshold:function(){var t=this.props.wiring;switch(t){case"h:h":case"v:v":return 20;case"h:v":case"v:h":return-10}return 0},direction:function(t){var e=this.orientation(t);switch(e){case"intersect":return null;case"top":case"bottom":return"v:v";case"left":case"right":return"h:h";default:return this.props.wiring}},orientation:function(t){var e=this.bbox().toJson(),n=t.bbox().toJson(),r=Graph.util.boxOrientation(e,n,this.treshold());return e=n=null,r},isSource:function(t){return t.source().guid()==this.vector().guid()},isTarget:function(t){return t.target().guid()==this.vector().guid()},addLink:function(t,e,n){var r=t.guid(),i=this.cached.cables,o=this.cached.pairs;n=n.guid(),o=o||{},o[n]=o[n]||[],_.indexOf(o[n],r)===-1&&o[n].push(r),i[r]={type:e,pair:n}},removeLink:function(t){var e;e=_.isString(t)?t:t.guid();var n=this.cached.cables[e];if(n&&this.cached.pairs[n.pair]){var r=_.indexOf(this.cached.pairs[n.pair],e);r>-1&&this.cached.pairs[n.pair].splice(r,1),
this.cached.pairs[n.pair].length||delete this.cached.pairs[n.pair]}delete this.cached.cables[e],n=null},hasConnection:function(t){var e=this.getConnection();return!!e.length&&e},connections:function(t){var e=this,n=Graph.registry.link,r=this.props.vector,i=[];if(void 0!==t){var o=t.vector().guid();return this.cached.pairs[o]&&_.forEach(e.cached.pairs[o],function(t){var a=n.get(t),s=e.cached.cables[t];a&&s&&i.push({link:a,type:s.type,source:"outgoing"==s.type?r:o,target:"outgoing"==s.type?o:r})}),i}var a=e.cached.cables;return _.forOwn(a,function(t,e){var o=n.get(e);o&&i.push({link:o,type:t.type,source:"outgoing"==t.type?r:t.pair,target:"outgoing"==t.type?t.pair:r})}),i},canConnect:function(t,e){var n=this.vector().guid(),r=t.vector().guid();return n!=r},destroy:function(){var t=this.connections();_.forEach(t,function(t){t.link.remove()}),this.cached.cables=null,this.cached.pairs=null}})}(),function(){Graph.plugin.History=Graph.extend(Graph.plugin.Plugin,{props:{limit:1,index:0},items:{},
constructor:function(t){this.props.vector=t.guid()},save:function(t,e){var n,r=this.props.limit;n>r&&_.drop(this.items,n-r),this.items[t]=this.items[t]||[],(n=this.items[t].length)>r-1&&this.items[t].splice(0,n-r),this.items[t].push(e),console.log(this)},last:function(t){},go:function(){},back:function(){},next:function(){},clear:function(){}})}(),function(){function t(t,e){return Math.max(t.min,Math.min(t.max,e))}Graph.plugin.Panzoom=Graph.extend(Graph.plugin.Plugin,{props:{panEnabled:!1,zoomEnabled:!0,showToolbox:!0,vector:null},caching:{offset:{x:0,y:0}},scrolling:{steps:10},zooming:{scale:1,zoom:1,origin:null,range:{min:.2,max:4}},components:{toolbox:null},panning:{start:{x:0,y:0},moveHandler:null,stopHandler:null},constructor:function(t){var e,n,r,i=this;if(!t.isPaper())throw Graph.error("Panzoom only available for paper !");n=t.viewport(),r=Math.round(n.matrix().scale().x,1e3),e=t.interactable().vendor(),_.assign(i.props,{vector:t.guid()}),_.assign(i.zooming,{scale:r,zoom:r}),i.initComponent(t),
e.on("wheel",_.bind(i.onMouseWheel,i,_,t,n)),e.on("down",_.bind(i.onPointerDown,i,_,t,n)),t.props.rendered?(i.revalidate(t),i.props.showToolbox&&i.components.toolbox.appendTo(t.container())):t.on("render",function(){i.revalidate(t),i.props.showToolbox&&i.components.toolbox.appendTo(t.container())}),e=null,t=null},initComponent:function(t){var e,n,r=this;r.props.showToolbox&&(e=t.container(),n=r.components.toolbox=Graph.$('<div class="graph-zoom-toolbox">'),n.html('<div><a data-tool="zoom-reset" href="javascript:void(0)" title="'+Graph._("Reset zoom")+'"><i class="'+Graph.icons.ZOOM_RESET+'"></i></a><div class="splitter"></div><a data-tool="zoom-in" href="javascript:void(0)" title="'+Graph._("Zoom in")+'"><i class="'+Graph.icons.ZOOM_IN+'"></i></a><div class="splitter"></div><a data-tool="zoom-out" href="javascript:void(0)" title="'+Graph._("Zoom out")+'"><i class="'+Graph.icons.ZOOM_OUT+'"></i></a></div>'),n.on("click","[data-tool]",function(t){t.preventDefault();var e=Graph.$(this).data("tool");
switch(e){case"zoom-reset":r.zoomReset();break;case"zoom-in":r.zoomIn();break;case"zoom-out":r.zoomOut()}}))},revalidate:function(t){var e=t.node().getBoundingClientRect();this.caching.offset={x:e.left,y:e.top}},enable:function(){var t=this.vector();this.props.panEnabled=!0,this.props.zoomEnabled=!0,t.cursor("default"),t.state("panning")},disable:function(){this.props.panEnabled=!1},zoomReset:function(){var t,e=this.vector().viewport();this.zooming.zoom=1,this.zooming.scale=1,e.reset(),t=Graph.matrix(),t.translate(.5,.5),e.attr("transform",t.toValue()),e.graph.matrix=t},zoomIn:function(){var t=this.vector().paper(),e=t.viewport(),n=t.layout().center(),r=.1;this.zoom(t,e,r,n)},zoomOut:function(){var t=this.vector().paper(),e=t.viewport(),n=t.layout().center(),r=-.1;this.zoom(t,e,r,n)},zoom:function(e,n,r,i){var o=this.zooming.range,a=this.zooming.zoom,s=r>0?"in":"out",p=Math.pow(1+Math.abs(r),"in"==s?1:-1),h=t(o,a*p),c=n.matrix(),l=c.props.a,u=1/l*h,d=c.clone();this.onBeforeZoom(e),d.scale(u,u,i.x,i.y),
n.attr("transform",d.toValue()),n.graph.matrix=d,this.zooming.zoom=h,this.zooming.scale=d.props.a,"panning"==e.state()&&e.cursor("in"==s?"zoom-in":"zoom-out"),this.onZoom(e)},scroll:function(t,e,n,r){var i=e.matrix().clone(),o=this.zooming.scale;this.onBeforeScroll(t),n/=o,r/=o,i.translate(n,r),e.attr("transform",i.toValue()),e.graph.matrix=i,this.zooming.origin&&(this.zooming.origin.x+=n,this.zooming.origin.y+=r),this.onScroll()},onMouseWheel:function(t,e,n){t=Graph.event.fix(t),t.preventDefault();var r,i,o,a,s=Graph.event.hasPrimaryModifier(t),p=Graph.event.hasSecondaryModifier(t),h=Graph.event.original(t);s||p?(r=Graph.isMac()?0===h.deltaMode?1.25:50:0===h.deltaMode?1:20,i={},p?(i.dx=r*(h.deltaX||h.deltaY),i.dy=0):(i.dx=0,i.dy=r*h.deltaY),this.scroll(e,n,i.dx,i.dy)):(r=0===h.deltaMode?.025:.5,a=this.caching.offset,o={x:h.clientX-a.x,y:h.clientY-a.y},this.zooming.origin=o,this.zoom(e,n,h.deltaY*r/-8,o))},onPointerDown:function(t,e,n,r){var i,o=Graph.$(t.target),a=Graph.registry.vector.get(o),r=e.interactable().vendor(),s=e.tool().current();
if(this.panning.moveHandler&&(r.off("move",this.panning.moveHandler),this.panning.moveHandler=null),this.panning.stopHandler&&(r.off("up",this.panning.stopHandler),this.panning.stopHandler=null),"collector"!=s&&a){if(a.isDraggable())return;if(t.button||t.ctrlKey||t.shiftKey||t.altKey)return;this.revalidate(e),i=this.caching.offset,this.panning.start={x:t.clientX-i.x,y:t.clientY-i.y},this.panning.moveHandler=_.bind(this.onPointerMove,this,_,e,n),this.panning.stopHandler=_.bind(this.onPointerStop,this,_,e,n),r.on("move",this.panning.moveHandler),r.on("up",this.panning.stopHandler)}},onPointerMove:function(t,e,n){var r=this.caching.offset,i=this.panning.start,o={x:t.clientX-r.x,y:t.clientY-r.y},a=o.x-i.x,s=o.y-i.y;Graph.util.hypo(a,s);this.scroll(e,n,a,s),this.panning.start={x:t.clientX-r.x,y:t.clientY-r.y},e.cursor("move"),t.preventDefault()},onPointerStop:function(t,e){var n,r=this,i=e.interactable().vendor();n=_.delay(function(){clearTimeout(n),n=null,i.off("move",r.panning.moveHandler),
i.off("up",r.panning.stopHandler),r.panning.moveHandler=null,r.panning.stopHandler=null},0),e.cursor("default")},onBeforeZoom:_.debounce(function(t){Graph.topic.publish("paper/beforezoom",null,t)},300,{leading:!0,trailing:!1}),onZoom:_.debounce(function(t){var e=t.state();"panning"==e&&t.cursor("default")},300),onBeforeScroll:_.debounce(function(t){Graph.topic.publish("paper/beforescroll",null,t)},300,{leading:!0,trailing:!1}),onScroll:_.debounce(function(){},300)})}(),function(){var t="connect-valid",e="connect-invalid",n="connect-valid connect-invalid";Graph.plugin.Linker=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,context:null,enabled:!1,suspended:!0,rendered:!1},components:{block:null,pointer:null,path:null},linking:{treshold:10,enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,target:null,end:null,visits:[]},constructor:function(t){var e,n=this;if(!t.isPaper())throw Graph.error("Linker plugin is only available for paper !");e=t.interactable().vendor(),e.on("down",_.bind(n.onPointerDown,n,_,t)),
t.on("keynavdown",function(e){e.keyCode===Graph.event.ESC&&(n.invalidate(),t.tool().activate("panzoom"))}),n.props.vector=t.guid(),n.initComponent()},initComponent:function(){var t,e,n,r=this,i=r.components;t=(new Graph.svg.Group).addClass("graph-linker-path").selectable(!1),e=(new Graph.svg.Circle).addClass("graph-linker-pointer").removeClass(Graph.styles.VECTOR).selectable(!1).render(t),n=(new Graph.svg.Path).addClass("graph-linker-path").removeClass(Graph.styles.VECTOR).selectable(!1).render(t).attr("marker-end","url(#marker-arrow)"),i.block=t.guid(),i.pointer=e.guid(),i.path=n.guid()},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},render:function(){var t;this.props.rendered||(t=this.vector(),this.component().render(t),this.props.rendered=!0,this.props.context=t.viewport().guid())},invalidate:function(){var t,e;this.linking.enabled&&(t=this.vector(),e=t.interactable().vendor(),this.linking.moveHandler&&(e.off("move",this.linking.moveHandler),
this.linking.moveHandler=null),this.linking.source&&this.linking.source.removeClass("disallowed"),this.linking.target&&this.linking.target.removeClass("allowed"),_.assign(this.linking,{enabled:!1,moveHandler:null,stopHandler:null,source:null,start:null,target:null,end:null}),this.linking.visits&&_.forEach(this.linking.visits,function(t){t.removeClass("connect-valid connect-invalid")}),this.linking.visits=null)},enable:function(){var t=this.vector();this.props.enabled=!0,t.state("linking"),t.addClass("linking")},disable:function(){var t=this.vector();this.props.enabled=!1,this.invalidate(),this.suspend(),t.removeClass("linking")},suspend:function(){this.props.suspended=!0,this.component().elem.detach()},resume:function(){var t;this.props.suspended&&(t=this.vector(),this.props.suspended=!1,this.props.rendered?this.component().elem.appendTo(t.viewport().elem):this.render())},start:function(t,e){var n=this.vector(),r=n.layout();r.offset();if("linker"==n.tool().current()){if(this.linking.enabled)return void(this.linking.source&&this.linking.target?this.build():(this.invalidate(),
this.suspend()));this.linking.visits=[];var i,o,a;if(t.isConnectable()){this.props.suspended&&this.resume();var s=this.component("path"),p=this.context();this.linking.moveHandler=_.bind(this.onPointerMove,this,_,n,s,p),i=n.interactable().vendor(),i.on("move",this.linking.moveHandler),this.linking.visits.push(t),t.isConnectable()&&(this.linking.source||(t.connectable({context:p}),o=t.connectable().bbox(),a=o.center(!0),this.linking.source=t,this.linking.start=a,e?s.moveTo(a.x,a.y).lineTo(e.x,e.y,!1):s.moveTo(a.x,a.y).lineTo(a.x,a.y,!1),o=a=null)),this.linking.enabled=!0}}},cropping:function(t,e){var n,r,i,o,a=this.linking.source,s=this.linking.target,p=new Graph.lang.Path([["M",t.x,t.y],["L",e.x,e.y]]);return a&&(n=a.connectable().pathinfo(),r=n.intersection(p,!0)),s&&(i=s.connectable().pathinfo(),o=i.intersection(p,!0)),p=n=i=null,{start:r?r[0]:null,end:o?o[0]:null}},build:function(){var t=this.component("path"),e=t.tail(),n=t.head();if(e&&n){var r=this.vector();r.connect(this.linking.source,this.linking.target,e,n);
}this.invalidate(),this.suspend()},onPointerDown:function(t,e){var n=e.layout(),r=n.grabVector(t);r&&this.start(r),n=r=null},onPointerMove:function(r,i,o,a){if(this.linking.enabled){var s=i.layout(),p=s.grabVector(r);if(!p)return;var h=this.linking.source,c=!1;if(h){this.linking.visits.indexOf(p.guid())===-1&&this.linking.visits.push(p);var l=this.linking.start,u=s.grabLocation(r),d=u.x,f=u.y,g=Graph.util.rad(Graph.util.theta(l,{x:d,y:f})),v=Math.sin(g),y=Math.cos(g),m=this.linking.treshold*-y,x=this.linking.treshold*v;if(d+=m,f+=x,p.isConnectable()){var b,G,_;h.connectable().canConnect(p.connectable())?(c=!0,p.removeClass(e),p.addClass(t),p.connectable({context:a}),G=p.connectable().bbox(),_=G.center(!0),this.linking.target=p,this.linking.end=_,b=this.cropping(l,_),b.start&&o.moveTo(b.start.x,b.start.y),b.end?o.lineTo(b.end.x,b.end.y,!1):o.lineTo(d,f,!1),G=_=null):(p.removeClass(t),p.addClass(e))}else p.addClass(e);c||(this.linking.target&&this.linking.target.removeClass(n),this.linking.target=null,
this.linking.end=null,b=this.cropping(l,{x:d,y:f}),b.start&&o.moveTo(b.start.x,b.start.y),b.end?o.lineTo(b.end.x,b.end.y,!1):o.lineTo(d,f,!1))}}r.preventDefault()}})}(),function(){Graph.plugin.ToolManager=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,current:null},tools:{},constructor:function(t){var e=this;e.props.vector=t.guid()},has:function(t){return!!this.tools[t]},get:function(t){var e=this.tools[t],n=this.vector();if(e)switch(e.type){case"plugin":return n.plugins[t];case"util":return n.utils[t]}return null},current:function(){return this.props.current},register:function(t,e){e=_.defaultTo(e,"plugin"),this.tools[t]={name:t,type:e,enabled:!1}},unregister:function(t){this.tools[t]&&delete this.tools[t]},activate:function(t,e){if(this.props.current!=t){var n,r=this.get(t);r&&(this.deactivateAll(t),this.props.current=t,n=this.tools[t],n.enabled=!0,e=_.defaultTo(e,"tool"),r.enable(e),this.fire("activate",{name:n.name,enabled:n.enabled}))}},deactivate:function(t){var e,n=this.get(t);
n&&(e=this.tools[t],e.enabled=!1,this.props.current=null,n.disable(),this.fire("deactivate",{name:e.name,enabled:e.enabled}))},deactivateAll:function(t){this.vector();for(var e in this.tools)e!=t&&this.deactivate(e)},toggle:function(t){var e=this.tools[t];e&&(e.enabled?this.deactivate(t):this.activate(t))}})}(),function(){Graph.plugin.Pencil=Graph.extend(Graph.plugin.Plugin,{paper:null,drawing:{offset:{x:0,y:0},moveHandler:null,stopHandler:null},constructor:function(t){this.paper=t},draw:function(){var t,e;return this.paper.tool().activate("panzoom"),t=Graph.shape.apply(null,arguments),t&&(t.render(this.paper),t.move(-500,-500),this.refresh(t),this.paper.state("drawing"),e=this.paper.interactable().vendor(),this.drawing.offset=this.paper.layout().offset(),this.drawing.moveHandler=_.bind(this.onPointerMove,this,_,t),this.drawing.stopHandler=_.bind(this.onPointerStop,this,_,t),e.on("move",this.drawing.moveHandler),e.on("up",this.drawing.stopHandler)),t},refresh:function(t){var e=this.paper.layout().dragSnapping();
t.component().cascade(function(t){t.isDraggable()&&t.draggable().snap(e),t.isResizable()&&t.resizable().snap(e)})},onPointerMove:function(t,e){var n=this.drawing.offset,r=this.paper.viewport(),i=Graph.event.relative(t,r),o=r.scale(),a=i.x-n.left/o.x,s=i.y-n.top/o.y;e.move(a,s)},onPointerStop:function(t,e){var n,r=this.paper.interactable().vendor();n=_.delay(_.bind(function(){this.drawing.moveHandler&&(r.off("move",this.drawing.moveHandler),this.drawing.moveHandler=null),this.drawing.stopHandler&&(r.off("up",this.drawing.stopHandler),this.drawing.stopHandler=null)},this),0)}})}(),function(){var t=150,e=50,n=10;Graph.plugin.Editor=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,rendered:!1,suspended:!0,width:"auto",height:"auto",offset:"auto"},editing:{commitHandler:null},components:{editor:null},constructor:function(t,e){var n;_.assign(this.props,e||{}),this.props.vector=t.guid(),_.assign(this.cached,{left:0,top:0,width:0,height:0}),n=t.interactable().vendor(),n.on("doubletap",_.bind(this.onDoubleTap,this)),
this.initComponent()},initComponent:function(){var t=this,e=this.components;e.editor=Graph.$('<div class="graph-editor" contenteditable="true"></div>'),e.editor.on("keypress",function(e){e.keyCode===Graph.event.ENTER&&t.commit()})},commit:function(){var t=this.components.editor.text();this.suspend(),this.vector().props.text=t,this.fire("edit",{text:t,left:this.cached.left,top:this.cached.top})},render:function(){return this.props.rendered?void this.redraw():(this.vector().paper().container().append(this.components.editor),this.props.rendered=!0,void this.redraw())},suspend:function(){this.props.suspended=!0,this.components.editor.detach(),this.editing.commitHandler&&(Graph.topic.unsubscribe("paper/beforezoom",this.editing.commitHandler),Graph.topic.unsubscribe("paper/beforescroll",this.editing.commitHandler),this.vector().paper().off("pointerdown",this.editing.commitHandler),this.editing.commitHandler=null)},resume:function(){var t;this.props.rendered?(this.props.suspended&&(this.props.suspended=!1,
t=this.vector().paper().container(),t.append(this.components.editor)),this.redraw()):this.render()},redraw:function(){var n,r,i,o,a=this.components.editor,s=this.vector(),p=s.globalMatrix(),h=p.scale(),c=s.bbox().clone().transform(p).toJson();i=c.width,o=c.height,n=c.x,r=c.y,"auto"!=this.props.width&&(i=Math.max(Math.min(this.props.width,i),t),n=c.x+(c.width-i)/2),"auto"!=this.props.height&&(o=Math.max(Math.min(this.props.height,o),e),r=c.y+(c.height-o)/2),n+=4*h.x,r+=4*h.y,i-=8*h.x,o-=8*h.y,a.css({left:n,top:r,width:i,height:o}),_.assign(this.cached,{left:n,top:r,width:i,height:o}),a.text(s.props.text||""),a.focus(),c=null},startEdit:function(t){var e=this,r=e.vector();if(r.lasso&&r.lasso.decollect(r),"linker"==r.paper().tool().current()&&r.paper().tool().activate("panzoom"),e.fire("beforeedit"),e.resume(),t&&"pointer"==this.props.offset){var i,o,a,s,p=e.components.editor,h=r.paper(),c=h.layout().scale();h&&(i=h.offset(),o=h.layout().grabLocation(t),a=t.clientX-i.left+n*c.x,s=t.clientY-i.top+n*c.y,
p.css({left:a,top:s}),e.cached.left=o.x,e.cached.top=o.y)}e.editing.commitHandler=function(){e.commit()},Graph.topic.subscribe("paper/beforezoom",e.editing.commitHandler),Graph.topic.subscribe("paper/beforescroll",e.editing.commitHandler),r.paper().on("pointerdown",e.editing.commitHandler),r=null},onDoubleTap:function(t){this.startEdit(t),t.preventDefault()},destroy:function(){}})}(),function(){function t(t,e,n){n=_.defaultTo(n,10);for(var r,i=e.length;i--;)if(r=Math.abs(e[i]-t),r<=n)return{snapped:!0,value:e[i]};return{snapped:!1,value:t}}Graph.plugin.Snapper=Graph.extend(Graph.plugin.Plugin,{props:{enabled:!0,suspended:!0,rendered:!1,vector:null,context:null},clients:{},components:{block:null,stubx:null,stuby:null},snapping:{coords:null,vector:null,offset:null,stubx:null,stuby:null},constructor:function(t,e){if(e=e||{},!t.isPaper())throw Graph.error("Snapper plugin only available for paper");_.assign(this.props,e),this.props.vector=t.guid(),this.props.context=t.viewport().guid(),this.initComponent(t),
this.snapping.coords={}},initComponent:function(t){var e,n,r;e=(new Graph.svg.Group).selectable(!1).clickable(!1).addClass("graph-snapper"),n=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.styles.VECTOR).selectable(!1).clickable(!1).render(e),r=new Graph.svg.Path("M 0 0 L 0 0").removeClass(Graph.styles.VECTOR).clickable(!1).selectable(!1).render(e),this.components.block=e.guid(),this.components.stuby=r.guid(),this.components.stubx=n.guid()},component:function(t){return void 0===t?Graph.registry.vector.get(this.components.block):Graph.registry.vector.get(this.components[t])},render:function(){this.props.rendered||(this.component().render(this.vector()),this.props.rendered=!0)},suspend:function(){this.props.suspended=!0,this.component().elem.detach()},resume:function(){if(this.props.suspended)if(this.props.suspended=!1,this.props.rendered){var t=this.component(),e=this.vector().viewport();t.elem.appendTo(e.elem)}else this.render()},setup:function(t,e){if(this.props.enabled){var n,r=this,i=(this.props.context,
t.guid());if(r.clients[i]&&(t.off("dragstart",r.clients[i].dragStartHandler),t.off("dragend",r.clients[i].dragEndHandler),t.off("remove",r.clients[i].removeHandler),r.clients[i].coords&&delete r.snapping.coords[r.clients[i].coords],delete r.clients[i]),e.enabled){var o=t.draggable();r.clients[i]={coords:null,osnaps:o.snap(),dragStartHandler:_.bind(r.onClientDragStart,r,_,t),dragEndHandler:_.bind(r.onClientDragEnd,r,_,t),removeHandler:_.bind(r.onClientRemove,r,_,t)},t.on("dragstart",r.clients[i].dragStartHandler),t.on("dragend",r.clients[i].dragEndHandler),t.on("remove",r.clients[i].removeHandler);var a=r.getClientCenter(t),s=this.snapping.coords;n=a.x+"_"+a.y,s[n]||(s[n]=a,r.clients[i].coords=n),n=null}}},getClientCenter:function(t){var e,n,r=(t.guid(),this.props.context),i=Graph.matrix(),o=t.pathinfo();return t.bubble(function(t){return t.guid()!=r&&void i.multiply(t.matrix())}),o=o.transform(i),n=o.bbox(),e=n.center().toJson(),i=o=n=null,e},showStub:function(t,e){var n,r=this.snapping;
"x"==t&&(n="M "+e+" -100000 L "+e+" 100000",r.stubx.attr("d",n),r.stubx.addClass("visible")),"y"==t&&(n="M -100000 "+e+" L 100000 "+e,r.stuby.attr("d",n),r.stuby.addClass("visible")),n=null},hideStub:function(t){var e="x"==t?"stubx":"stuby";this.snapping[e].removeClass("visible")},onClientDragStart:function(e,n){var r=this,i=r.vector(),o=i.layout(),a=o.offset(),s=r.getClientCenter(n),p=this.snapping,h=p.coords;p.stubx=this.component("stubx"),p.stuby=this.component("stuby");var c=a.left,l=a.top,u=this.context().matrix(),d=(u.props.e,u.props.f,o.grabLocation({clientX:e.x,clientY:e.y})),f=s.x-d.x,g=s.y-d.y,v=[],y=[];_.forOwn(h,function(t){var e,n,r,i;e=u.x(t.x-f,t.y-g),n=u.y(t.x-f,t.y-g),r=e+c,_.indexOf(v,r)===-1&&v.push(r),i=n+l,_.indexOf(y,i)===-1&&y.push(i)}),n.draggable().snap([function(e,n){var i,a,s,p,h;return i=t(e,v),a=t(n,y),s=i.value,p=a.value,h=o.grabLocation({clientX:s,clientY:p}),i.snapped?r.showStub("x",h.x+f):r.hideStub("x"),a.snapped?r.showStub("y",h.y+g):r.hideStub("y"),{x:s,
y:p}}]),r.resume()},onClientDragEnd:function(t,e){var n=this.snapping,r=this.clients[e.guid()];if(r){var i=e.draggable();r.osnaps&&i.snap(r.osnaps);var o,a;r.coords&&delete n.coords[r.coords],a=this.getClientCenter(e),o=a.x+"_"+a.y,n.coords[o]||(n.coords[o]=a,r.coords=o),o=null,a=null}this.suspend(),_.assign(this.snapping,{stubx:null,stuby:null})},onClientRemove:function(t,e){var n=e.guid(),r=this.clients[n],i=this.snapping;r&&(r.coords&&i.coords[r.coords]&&delete i.coords[r.coords],delete this.clients[n])}})}(),function(){Graph.plugin.Toolpad=Graph.extend(Graph.plugin.Plugin,{props:{vector:null,rendered:!1,suspended:!0},components:{pad:null},constructor:function(t){this.props.vector=t.guid(),this.initComponent(t),this.cached.tools=null,Graph.topic.subscribe("shape/select",_.bind(this.onShapeSelect,this)),Graph.topic.subscribe("shape/deselect",_.bind(this.onShapeDeselect,this)),Graph.topic.subscribe("link/select",_.bind(this.onLinkSelect,this)),Graph.topic.subscribe("link/deselect",_.bind(this.onLinkDeselect,this));
},initComponent:function(t){var e='<div class="graph-toolpad"><div class="pad-header"></div><div class="pad-splitter"></div><div class="pad-body">x</div></div>';e=Graph.$(e),e.on("click","[data-shape-tool]",_.bind(this.onToolClick,this)),this.components.pad=e},render:function(){this.props.rendered||(this.components.pad.appendTo(this.vector().container()),this.props.rendered=!0)},suspend:function(){this.props.suspended=!0,this.components.pad.detach()},resume:function(){this.props.suspended&&(this.props.suspended=!1,this.props.rendered?this.components.pad.appendTo(this.vector().container()):this.render())},onShapeSelect:function(t){var e=t.shape,n=e.metadata,r=this.components.pad;r.find(".pad-header").html('<a><i class="'+n.icon+'"></i></a>');var i="";_.forEach(n.tools,function(t){t.enabled&&(i+='<div class="splitter"></div>',i+='<a data-shape-tool="'+t.name+'" href="javascript:void(0)" title="'+t.title+'"><i class="'+t.icon+'"></i></a>')}),r.find(".pad-body").html(i),this.cached.tools=n.tools,
this.resume()},onShapeDeselect:function(t){this.suspend()},onLinkSelect:function(t){var e=t.link,n=e.metadata,r=this.components.pad;r.find(".pad-header").html('<a><i class="'+n.icon+'"></i></a>');var i="";_.forEach(n.tools,function(t){t.enabled&&(i+='<div class="splitter"></div>',i+='<a data-shape-tool="'+t.name+'" href="#" title="'+t.title+'"><i class="'+t.icon+'"></i></a>')}),r.find(".pad-body").html(i),this.cached.tools=n.tools,this.resume()},onLinkDeselect:function(t){this.suspend()},onToolClick:function(t){var e=Graph.$(t.currentTarget),n=e.data("shapeTool"),r=_.find(this.cached.tools,function(t){return t.name==n});r&&r.handler&&r.handler(t),t.preventDefault()}})}(),function(){var t=Graph.shape.Shape=Graph.extend({props:{id:null,guid:null,width:0,height:0,label:""},components:{shape:null,block:null,label:null,child:null},tree:{paper:null,parent:null,children:null},metadata:{name:null,icon:Graph.icons.SHAPE,style:"graph-shape",tools:null},cached:{innerMatrix:null,outerMatrix:null,innerBBox:null,
outerBBox:null},constructor:function(e){var n;if(_.assign(this.props,e||{}),n="graph-shape-"+ ++t.guid,this.props.guid=n,this.tree.children=new Graph.collection.Shape,this.initComponent(),this.initMetadata(),this.components.shape){var r=Graph.styles.SHAPE;this.metadata.style&&(r+=" "+this.metadata.style),this.component().addClass(r),r=null}Graph.registry.shape.register(this),n=null},initMetadata:function(){this.metadata.tools=[{name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config shape"),enabled:!0,handler:_.bind(this.onConfigToolClick,this)},{name:"link",icon:Graph.icons.LINK,title:Graph._("Click to start shape linking"),enabled:!0,handler:_.bind(this.onLinkToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,
title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},initComponent:function(){var t=new Graph.svg.Group;this.components.shape=t.guid(),t=null},component:function(t){var e=Graph.registry.vector;return void 0===t?e.get(this.components.shape):e.get(this.components[t])},invalidate:function(){this.cached.innerMatrix=null,this.cached.outerMatrix=null,this.cached.innerBBox=null,this.cached.outerBBox=null},provider:function(t){var e;switch(t){case"network":case"resizer":case"dragger":case"snapper":e=this.components.block;break;default:e=this.components.block}return Graph.registry.vector.get(e)},paper:function(){return Graph.registry.vector.get(this.tree.paper)},parent:function(){return Graph.registry.shape.get(this.tree.parent)},children:function(){return this.tree.children},addChild:function(t){var e=t.parent();return e&&e.removeChild(t),this.children().push(t),t.tree.parent=this.guid(),this.components.child&&this.component("child").append(t.component()),
this},removeChild:function(t){this.children().pull(t),t.tree.parent=null;var e=t.paper();return e&&e.viewport().append(t.component()),this},addChild_:function(t,e){if(this.children().push(t),t.tree.parent=this.guid(),this.components.child){var n=this.component(),r=this.component("child"),i=t.component();if(r.children().push(i),i.tree.parent=r.guid(),e=_.defaultTo(e,!0)){r.elem.append(i.elem);var o=i.innerMatrix(n);i.graph.matrix=o,i.attr("transform",o.toValue()),i.dirty(!0),_.assign(t.props,{left:o.props.e,top:o.props.f}),o=null}}},removeChild_:function(t,e){this.children().pull(t),t.tree.parent=null;var n=t.paper();if(n){var r=t.component(),i=n.viewport();if(e=_.defaultTo(e,!0)){var o=this.component(),a=Graph.matrix();r.bubble(function(t){if(a.multiply(t.matrix()),t===o)return!1}),r.graph.matrix=a,r.attr("transform",a.toValue()),r.dirty(!0),_.assign(t.props,{left:a.props.e,top:a.props.f}),a=null,i.children().push(r),r.tree.parent=i.guid(),i.elem.append(r.elem)}else i.children().push(r),
r.tree.parent=i.guid()}},guid:function(){return this.props.guid},data:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.data(e,t)}),n):void 0===e?n.props[t]:(n.props[t]=e,n)},matrix:function(){return this.component().matrix()},innerMatrix:function(){var t,e=this.paper();if(e){if(t=this.cached.innerMatrix,!t){var n=e.viewport(),r=n.guid(),i=this.component(),o=i.guid(),a=this.component(),s=Graph.matrix();a.bubble(function(t){var e=t.guid();return e!=r&&void(e!=o&&s.multiply(t.matrix()))}),s.invert(),t=a.matrix().clone().multiply(s),this.cached.innerMatrix=t,s=null}}else t=this.matrix();return t.clone()},outerMatrix:function(){var t,e=this.paper();if(e){if(t=this.cached.outerMatrix,!t){var n=e.viewport(),r=n.guid(),i=this.component();t=Graph.matrix(),i.bubble(function(e){return e.guid()!=r&&void t.multiply(e.matrix())}),this.cached.outerMatrix=t,n=i=null}}else t=this.matrix();return t.clone()},bbox:function(){return Graph.bbox({x:this.props.left,y:this.props.top,
x2:this.props.left+this.props.width,y2:this.props.top+this.props.height,width:this.props.width,height:this.props.height})},innerBBox:function(){this.cached.innerBBox},outerBBox:function(){var t=this.cached.outerBBox;if(!t){var e=this.outerMatrix(),n=this.component().pathinfo().transform(e);t=n.bbox(),this.cached.outerBBox=t}return t.clone()},contains:function(t){var e,n;return e=this.outerBBox(),n=t.outerBBox(),e.contains(n)},render:function(t){var e=this.component();e&&e.render(t),this.tree.paper=t.guid()},remove:function(){this.component("block").remove()},redraw:_.debounce(function(){var t=this.component("label"),e=this.component("block"),n=e.bbox().toJson();t.attr({x:n.x+n.width/2,y:n.x+n.height/2}),t.wrap(n.width-10)},1),translate:function(t,e){var n=this.component();n.translate(t,e).commit();var r=n.matrix(),i=r.props.e,o=r.props.f;this.data({left:i,top:o})},sendToBack:function(){this.paper()},sendToFront:function(){var t=this.paper();t.viewport().elem.append(this.component().elem);
},attr:function(t,e){var n=this;return _.isPlainObject(t)?(_.forOwn(t,function(t,e){n.props[e]=t}),this):void 0===e?this.props[t]:(this.props[t]=e,this)},height:function(t){return void 0===t?this.props.height:this.attr("height",t)},left:function(t){return void 0===t?this.props.left:this.attr("left",t)},top:function(t){return void 0===t?this.props.top:this.attr("top",t)},onLabelEdit:function(t){var e=t.text;this.component("label").props.text=e,this.redraw()},onDragStart:function(t){var e=this.component();e.addClass("shape-dragging")},onDragEnd:function(t){var e=this.component("block"),n=this.component("shape"),r=e.matrix();e.reset(),n.matrix().multiply(r),n.attr("transform",n.matrix().toValue()),n.dirty(!0);var r=n.matrix();this.data({left:r.props.e,top:r.props.f}),this.fire(t),n.removeClass("shape-dragging")},onSelect:function(){this.component("shape").addClass("shape-selected"),Graph.topic.publish("shape/select",{shape:this})},onDeselect:function(){this.component("shape").removeClass("shape-selected"),
Graph.topic.publish("shape/deselect",{shape:this})},onResize:function(){this.redraw()},onRemove:function(){this.component("label").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this)},onConfigToolClick:function(t){},onTrashToolClick:function(t){this.remove()},onLinkToolClick:function(t){var e=this.paper();if(e){var n=e.layout(),r=e.plugins.linker,i=n.grabLocation(t);e.tool().activate("linker"),r.start(this.provider("network"),i)}},onFrontToolClick:function(t){this.sendToFront()},onBackToolClick:function(t){this.sendToBack()}});t.guid=0,t.toString=function(){return"function(options)"},Graph.isShape=function(t){return t instanceof Graph.shape.Shape}}(),function(){Graph.ns("Graph.shape.activity"),Graph.shape.activity.Start=Graph.extend(Graph.shape.Shape,{props:{label:"START",width:60,height:60,left:0,top:0},metadata:{name:"activity.start",style:"graph-shape-activity-start"},initComponent:function(){var t,e,n,r=this,i=r.components;
t=new Graph.svg.Group(r.props.left,r.props.top).selectable(!1);var o=r.props.width/2,a=r.props.height/2;e=new Graph.svg.Ellipse(o,a,o,a).addClass(Graph.styles.SHAPE_BLOCK).data("text",r.props.label).render(t),e.draggable({ghost:!0,dragClass:Graph.styles.SHAPE_DRAG}),e.connectable({wiring:"h:v"}),e.resizable(),e.editable(),e.snappable(),e.elem.data(Graph.string.ID_SHAPE,this.guid()),e.on("edit.shape",_.bind(r.onLabelEdit,r)),e.on("dragstart.shape",_.bind(r.onDragStart,r)),e.on("dragend.shape",_.bind(r.onDragEnd,r)),e.on("resize.shape",_.bind(r.onResize,r)),e.on("remove.shape",_.bind(r.onRemove,r)),e.on("select.shape",_.bind(r.onSelect,r)),e.on("deselect.shape",_.bind(r.onDeselect,r)),n=new Graph.svg.Text(o,a,r.props.label).addClass(Graph.styles.SHAPE_LABEL).selectable(!1).clickable(!1).render(t),i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),t=e=n=null},redraw:function(){var t,e,n,r,i=this.component("block"),o=this.component("shape"),a=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),
o.matrix().multiply(t),o.attr("transform",o.matrix().toValue()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),a.attr({x:n,y:r}),a.wrap(e.width-10),t=o.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null},toString:function(){return"Graph.shape.activity.Start"}}),Graph.shape.activity.Start.toString=function(){return"function(options)"}}(),function(){Graph.shape.activity.Final=Graph.extend(Graph.shape.Shape,{props:{label:"STOP",width:60,height:60,left:0,top:0},metadata:{name:"activity.final",style:"graph-shape-activity-final"},initComponent:function(){var t,e,n,r,i=this,o=i.components;t=new Graph.svg.Group(i.props.left,i.props.top).selectable(!1);var a=i.props.width/2,s=i.props.height/2;e=new Graph.svg.Ellipse(a,s,a,s).addClass("comp-block").data("text",i.props.label).render(t),e.draggable({ghost:!0}),e.connectable(),e.resizable(),e.editable(),e.on("edit",_.bind(i.onLabelEdit,i)),e.on("dragend",_.bind(i.onDragEnd,i)),
e.on("resize",_.bind(i.onResize,i)),e.on("remove",_.bind(i.onRemove,i)),n=new Graph.svg.Ellipse(a,s,a-6,s-6).addClass("comp-inner").clickable(!1).selectable(!1).render(t),r=new Graph.svg.Text(a,s,i.props.label).addClass("comp-label").selectable(!1).clickable(!1).render(t),o.shape=t.guid(),o.block=e.guid(),o.label=r.guid(),o.inner=n.guid(),t=e=r=null},redraw:function(){var t,e,n,r,i=this.component("block"),o=this.component("shape"),a=this.component("inner"),s=this.component("label");e=i.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),o.matrix().multiply(t),o.attr("transform",o.matrix().toValue()),n=e.width/2,r=e.height/2,i.attr({cx:n,cy:r}),i.dirty(!0),i.resizable().redraw(),s.attr({x:n,y:r}),s.wrap(e.width-10),a.attr({cx:n,cy:r,rx:n-6,ry:r-6}),t=o.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null},toString:function(){return"Graph.shape.activity.Final"},onRemove:function(){this.component("label").remove(),this.component("inner").remove(),this.component("shape").remove();
for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this)}}),Graph.shape.activity.Final.toString=function(){return"function(options)"}}(),function(){Graph.shape.activity.Action=Graph.extend(Graph.shape.Shape,{props:{label:"Action",width:140,height:60,left:0,top:0},metadata:{name:"activity.action",icon:Graph.icons.SHAPE_ACTION,style:"graph-shape-activity-action"},initComponent:function(){var t,e,n,r=this,i=this.components,o=r.props.width/2,a=r.props.height/2;t=new Graph.svg.Group(r.props.left,r.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,r.props.width,r.props.height).addClass(Graph.styles.SHAPE_BLOCK).data("text",r.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,r.guid()),e.draggable({ghost:!0,dragClass:Graph.styles.SHAPE_DRAG}),e.resizable(),e.editable(),e.connectable({wiring:"h:v"}),e.snappable(),e.on("edit.shape",_.bind(r.onLabelEdit,r)),e.on("dragstart.shape",_.bind(r.onDragStart,r)),e.on("dragend.shape",_.bind(r.onDragEnd,r)),e.on("resize.shape",_.bind(r.onResize,r)),
e.on("remove.shape",_.bind(r.onRemove,r)),e.on("select.shape",_.bind(r.onSelect,r)),e.on("deselect.shape",_.bind(r.onDeselect,r)),n=new Graph.svg.Text(o,a,r.props.label).addClass(Graph.styles.SHAPE_LABEL).clickable(!1).selectable(!1).render(t),i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),t=e=n=null},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue()),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),t=null,e=null},onResize:function(){this.redraw()},toString:function(){return"Graph.shape.activity.Action"}}),Graph.shape.activity.Action.toString=function(){return"function(options)"}}(),function(){Graph.shape.activity.Router=Graph.extend(Graph.shape.Shape,{props:{label:"Route",
width:100,height:100,left:0,top:0},metadata:{name:"activity.router",icon:Graph.icons.SHAPE_ROUTER,style:"graph-shape-activity-router"},initComponent:function(){var t,e,n,r=this,i=r.components,o=[r.props.width/2,0,r.props.width,r.props.height/2,r.props.width/2,r.props.height,0,r.props.height/2],a=o[0],s=o[3];t=new Graph.svg.Group(r.props.left,r.props.top).selectable(!1),e=new Graph.svg.Polygon(o).data("text",r.props.label).render(t),e.elem.data(Graph.string.ID_SHAPE,r.guid()),e.draggable({ghost:!0,dragClass:"shape-draggable"}),e.resizable(),e.editable(),e.connectable({wiring:"h:v"}),e.snappable(),e.on("edit",_.bind(r.onLabelEdit,r)),e.on("dragstart",_.bind(r.onDragStart,r)),e.on("dragend",_.bind(r.onDragEnd,r)),e.on("resize",_.bind(r.onResize,r)),e.on("remove",_.bind(r.onRemove,r)),e.on("select.shape",_.bind(r.onSelect,r)),e.on("deselect.shape",_.bind(r.onDeselect,r)),n=new Graph.svg.Text(a,s,r.props.label).clickable(!1).selectable(!1).render(t),i.shape=t.guid(),i.block=e.guid(),i.label=n.guid(),
t=e=n=null},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("label");t=n.bbox().toJson(),e=Graph.matrix().translate(t.x,t.y),r.matrix().multiply(e),r.attr("transform",r.matrix().toValue());var o=[t.width/2,0,t.width,t.height/2,t.width/2,t.height,0,t.height/2];n.attr({points:_.join(o,",")}),n.dirty(!0),n.resizable().redraw(),i.attr({x:t.width/2,y:t.height/2}),i.wrap(t.width-10),e=r.matrix(),this.data({left:e.props.e,top:e.props.f,width:t.width,height:t.height}),e=null,t=null}}),Graph.shape.activity.Router.toString=function(){return"function(options)"}}(),function(){Graph.shape.activity.Fork=Graph.extend(Graph.shape.Shape,{props:{width:100,height:50,left:0,top:0},metadata:{name:"activity.fork",style:"graph-shape-activity-fork"},initComponent:function(){var t,e=this,n=this.components;t=new Graph.svg.Group(e.props.left,e.props.top).selectable(!1),n.shape=t.guid()}}),Graph.shape.activity.Fork.toString=function(){return"function(options)"}}(),function(){
Graph.shape.activity.Join=Graph.extend(Graph.shape.Shape,{props:{width:140,height:12,left:0,top:0},metadata:{name:"activity.join",style:"graph-shape-activity-join"},initComponent:function(){var t,e,n=this,r=this.components;t=new Graph.svg.Group(n.props.left,n.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,n.props.width,n.props.height,0).addClass("block").render(t),e.draggable({ghost:!0}),e.connectable(),e.on("dragend",_.bind(n.onDragEnd,n)),r.shape=t.guid(),r.block=e.guid()}}),Graph.shape.activity.Join.toString=function(){return"function(options)"}}(),function(){var t="receive";Graph.shape.activity.Lane=Graph.extend(Graph.shape.Shape,{props:{label:"Participant Role",width:1e3,height:200,left:0,top:0},components:{header:null},tree:{pool:null},transfer:null,metadata:{name:"activity.lane",icon:Graph.icons.SHAPE_LANE,style:"graph-shape-activity-lane"},constructor:function(t){this.superclass.prototype.constructor.call(this,t),this.initDropzone()},initMetadata:function(){this.metadata.tools=[{
name:"config",icon:Graph.icons.CONFIG,title:Graph._("Click to config shape"),enabled:!0},{name:"above",icon:Graph.icons.LANE_ABOVE,title:Graph._("Add shape above"),enabled:!0,handler:_.bind(this.onAboveToolClick,this)},{name:"below",icon:Graph.icons.LANE_BELOW,title:Graph._("Add shape below"),enabled:!0,handler:_.bind(this.onBelowToolClick,this)},{name:"moveup",icon:Graph.icons.MOVE_UP,title:Graph._("Move up"),enabled:!0,handler:_.bind(this.onUpToolClick,this)},{name:"movedown",icon:Graph.icons.MOVE_DOWN,title:Graph._("Move down"),enabled:!0,handler:_.bind(this.onDownToolClick,this)},{name:"sendtofront",icon:Graph.icons.SEND_TO_FRONT,title:Graph._("Send to front"),enabled:!0,handler:_.bind(this.onFrontToolClick,this)},{name:"sendtoback",icon:Graph.icons.SEND_TO_BACK,title:Graph._("Send to back"),enabled:!0,handler:_.bind(this.onBackToolClick,this)},{name:"trash",icon:Graph.icons.TRASH,title:Graph._("Click to remove shape"),enabled:!0,handler:_.bind(this.onTrashToolClick,this)}]},initComponent:function(){
var t,e,n,r,i,o=this,a=o.components;t=new Graph.svg.Group(o.props.left,o.props.top).selectable(!1),e=new Graph.svg.Rect(0,0,o.props.width,o.props.height,0).addClass(Graph.styles.SHAPE_BLOCK).render(t),e.resizable(),e.draggable({ghost:!0,batchSync:!1}),e.on("dragend.shape",_.bind(o.onDragEnd,o)),e.on("resize.shape",_.bind(o.onResize,o)),e.on("remove.shape",_.bind(o.onRemove,o)),e.on("select.shape",_.bind(o.onSelect,o)),e.on("deselect.shape",_.bind(o.onDeselect,o)),n=new Graph.svg.Rect(0,0,30,o.props.height,0).addClass(Graph.styles.SHAPE_HEADER).selectable(!1).render(t),n.data("text",o.props.label),n.editable({width:200,height:100}),n.on("edit.shape",_.bind(o.onLabelEdit,o));var s=15,p=o.props.height/2;r=new Graph.svg.Text(s,p,o.props.label).addClass(Graph.styles.SHAPE_LABEL).selectable(!1).clickable(!1).render(t),r.rotate(270,s,p).commit(),i=(new Graph.svg.Group).addClass(Graph.styles.SHAPE_CHILD).selectable(!1).render(t),i.translate(50,0).commit(),a.shape=t.guid(),a.block=e.guid(),a.header=n.guid(),
a.label=r.guid(),a.child=i.guid(),o.tree.pool=new Graph.shape.activity.Pool,o.tree.pool.insert(o),t=e=n=r=null},initDropzone:function(){var e=this,n=e.component(),r=e.component("block"),i=e.children();r.interactable().dropzone({accept:".shape-draggable",overlap:.2}).on("dragenter",function(r){var o,a,s;e.transfer?e.transfer.trans==t&&n.addClass("receiving"):(o=Graph.registry.vector.get(r.relatedTarget),o&&(a=Graph.registry.shape.get(o),a&&(e.transfer={shape:a,batch:[],startHandler:_.bind(e.onTransferStart,e),stopHandler:_.bind(e.onTransferEnd,e)},a.on("dragend",e.transfer.stopHandler),o.lasso&&(s=o.lasso.collection.slice(),_.forEach(s,function(t){var n=Graph.registry.shape.get(t);n&&n!==a&&e.transfer.batch.push(n)}),s=null),i.has(a)||(e.transfer.trans=t,n.addClass("receiving")))))}).on("dragleave",function(t){e.transfer&&n.removeClass("receiving")}).on("drop",function(t){e.transfer&&n.removeClass("receiving")}),r=null},pool:function(){return this.tree.pool},render:function(t,e,n){var r=this.component();
e=_.defaultTo(e,"prepend"),r.render(t,e,n),this.tree.paper=t.guid()},sendToBack:function(){this.paper()},sendToFront:function(){this.pool().bringToFront(this)},redraw:function(){var t,e,n=this.component("block"),r=this.component("shape"),i=this.component("header"),o=this.component("label");e=n.bbox().toJson(),t=Graph.matrix().translate(e.x,e.y),r.matrix().multiply(t),r.attr("transform",r.matrix().toValue()),r.dirty(!0),n.attr({x:0,y:0}),n.dirty(!0),n.resizable().redraw(),i.attr({x:0,y:0,height:e.height}),i.dirty(!0);var a=15,s=e.height/2;o.graph.matrix=Graph.matrix(),o.attr("transform",""),o.attr({x:a,y:s}),o.wrap(e.height-10),o.rotate(270,a,s).commit(),t=r.matrix(),this.data({left:t.props.e,top:t.props.f,width:e.width,height:e.height}),e=null,t=null},attr:function(t,e){var n,r,i,o=this.superclass.prototype.attr.call(this,t,e),a={width:"width",height:"height",left:"x",top:"y"};if(_.isPlainObject(t)){n=this.component("block");for(r in t)a[r]&&(i=t[r],n.attr(a[r],i));this.redraw()}else void 0!==e&&(n=this.component("block"),
a[t]&&n.attr(a[t],e),this.redraw());return o},addSiblingAbove:function(){var t=new Graph.shape.activity.Lane,e=this.paper(),n=this.pool();n.createSpaceAbove(this,t.height());var r=this.top()-t.height();t.attr({width:this.props.width,left:this.props.left,top:r}),t.tree.pool=n;var i=n.insert(t);void 0!==i&&t.render(e,"before",this.component()),t=null},addSiblingBellow:function(){var t=new Graph.shape.activity.Lane,e=this.paper(),n=this.pool();n.createSpaceBellow(this,t.height());var r=this.top()+this.height();t.attr({width:this.props.width,left:this.props.left,top:r}),t.tree.pool=n;var i=n.insert(t);void 0!==i&&t.render(e,"after",this.component()),t=null},toString:function(){return"Graph.shape.activity.Lane"},onRemove:function(){this.component("label").remove(),this.component("header").remove(),this.component("shape").remove();for(var t in this.components)this.components[t]=null;Graph.registry.shape.unregister(this)},onDragEnd:function(t){this.superclass.prototype.onDragEnd.call(this,t),t.batch||this.pool().translateBy(this,t.dx,t.dy);
},onResize:function(t){this.superclass.prototype.onResize.call(this,t),this.pool().resizeBy(this)},onAboveToolClick:function(t){this.addSiblingAbove()},onBelowToolClick:function(t){this.addSiblingBellow()},onUpToolClick:function(t){this.pool().moveUp(this)},onDownToolClick:function(t){this.pool().moveDown(this)},onTransferStart:function(t){},onTransferEnd:function(t){var e;_.delay(function(t){clearTimeout(e),e=null;var n,r=t.children(),i=t.transfer;console.log(t.contains(i.shape)),t.contains(i.shape)?(n=i.shape.component(),r.has(i.shape)||t.addChild(i.shape),i.shape.invalidate()):(r.has(i.shape)&&t.removeChild(i.shape),i.shape.invalidate()),i.shape.off("dragend",i.stopHandler),t.transfer=i=null,console.log(t.children().items)},0,this)}}),Graph.shape.activity.Lane.toString=function(){return"function(options)"}}(),function(){var t=Graph.shape.activity.Pool=function(){this.guid="pool-"+ ++t.guid,this.lanes=new Graph.collection.Tree([]).keygen(function(t){return t.bbox.y}),this.cached={}};t.prototype.bbox=function(){
for(var t,e=this.lanes.toArray(),n=[],r=[],i=[],o=[],a=e.length-1;a>=0;a--)t=e[a].bbox,n.push(t.x),r.push(t.y),i.push(t.x+t.width),o.push(t.y+t.height);return n=_.min(n),r=_.min(r),i=_.max(i),o=_.max(o),e=null,Graph.bbox({x:n,y:r,x2:i,y2:o,width:i-n,height:o-r})},t.prototype.get=function(t){var e=this.lanes.get(t);return e?Graph.registry.shape.get(e.lane):null},t.prototype.prev=function(t){var e=this.index(t),n=this.lanes.get(e-1);return n?Graph.registry.shape.get(n.lane):null},t.prototype.last=function(){var t=this.count()-1,e=this.lanes.get(t);return e?Graph.registry.shape.get(e.lane):null},t.prototype.createSpaceAbove=function(t,e){var n=this.index(t),r=this.lanes.get(n-1);r&&this.lanes.bubble(r,function(t){var n=Graph.registry.shape.get(t.lane);n&&(n.translate(0,-e),t.bbox=n.bbox().toJson())})},t.prototype.createSpaceBellow=function(t,e){var n=this.index(t),r=this.lanes.get(n+1);r&&this.lanes.cascade(r,function(t){var n=Graph.registry.shape.get(t.lane);n&&(n.translate(0,e),t.bbox=n.bbox().toJson());
})},t.prototype.translateBy=function(t,e,n){var r=this.lanes.root(),i=t.guid();r&&this.lanes.cascade(r,function(r){if(r.lane==i)r.bbox=t.bbox().toJson();else{var o=Graph.registry.shape.get(r.lane);o&&(o.translate(e,n),r.bbox=o.bbox().toJson())}})},t.prototype.resizeBy=function(t){var e=t.guid(),n=t.bbox().toJson(),r=this.lanes.root(),i=this.index(t);if(r){var o,a,s,p,h,c;o=this.lanes.get(i-1),a=this.lanes.get(i+1),s=0,h=0,p=0,c=0,o&&(s=n.x-o.bbox.x,h=n.y-(o.bbox.y+o.bbox.height)),a&&(p=n.x-a.bbox.x,c=n.y+n.height-a.bbox.y),this.lanes.cascade(r,function(t,r){if(t.lane==e)t.bbox=n;else{var o=Graph.registry.shape.get(t.lane);if(o){var a=(o.component(),o.component("block"));i>r?o.translate(s,h):i<r&&o.translate(p,c),a.attr({width:n.width}),a.dirty(!0),o.redraw(),t.bbox=o.bbox().toJson()}}})}n=null},t.prototype.bringToFront=function(t){var e=Graph.$('[data-pool="'+this.guid+'"]'),n=e.last();n.length()&&n.node()!=t.component().node()&&n.after(t.component().elem)},t.prototype.moveUp=function(t){
var e=this.index(t),n=this.get(e-1),r=this.lanes.get(e),i=this.lanes.get(e-1);if(n){var o=t.bbox().toJson(),a=n.bbox().toJson(),s=0,p=a.y-o.y,h=0,c=o.y-a.y;r.bbox.y+=p,r.bbox.y2+=p,i.bbox.y+=c,i.bbox.y2+=c,t.translate(s,p),n.translate(h,c),this.lanes.order()}},t.prototype.moveDown=function(t){var e=this.index(t),n=this.get(e+1),r=this.lanes.get(e),i=this.lanes.get(e+1);if(n){var o=t.bbox().toJson(),a=n.bbox().toJson(),s=0,p=a.y-o.y,h=0,c=o.y-a.y;r.bbox.y+=p,r.bbox.y2+=p,i.bbox.y+=c,i.bbox.y2+=c,t.translate(s,p),n.translate(h,c),this.lanes.order()}},t.prototype.count=function(){return this.lanes.count()},t.prototype.insert=function(t){var e,n,r=t.guid();return e={lane:r,bbox:t.bbox().toJson()},n=this.lanes.insert(e),void 0!==n&&(this.cached[r]=e,t.component().elem.attr("data-pool",this.guid)),e=null,n},t.prototype.remove=function(t){var e=t.guid(),n=this.cached[e],r=this.lanes.remove(n);return void 0!==r&&delete this.cached[e],n=null,r},t.prototype.index=function(t){var e=t.guid(),n=this.cached[e],r=this.lanes.index(n);
return n=null,r},t.guid=0,t.toString=function(){return"function(options)"}}(),function(){function t(t){var e=encodeURIComponent(t);return e=e.replace(/%([0-9A-F]{2})/g,function(t,e){var n=String.fromCharCode("0x"+e);return"%"===n?"%25":n}),decodeURIComponent(e)}function e(t,e){if(navigator.msSaveOrOpenBlob){var r=n(e);navigator.msSaveOrOpenBlob(r,t),r=null}else{var i=Graph.dom("<a/>");"download"in i?(i.download=t,i.href=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)):window.open(e,"_download","menubar=no,toolbar=no,status=no"),i=null}}function n(t){for(var e=window.atob(t.split(",")[1]),n=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),i=new Uint8Array(r),o=0,a=e.length;o<a;o++)i[o]=e.charCodeAt(o);return new Blob([r],{type:n})}function r(t,e,n){var r=i(t,e),o=new Image;o.onload=function(){var t,r,i;t=document.createElement("canvas"),t.width=o.width,t.height=o.height,r=t.getContext("2d"),e.background&&(r.fillStyle=e.background,
r.fillRect(0,0,t.width,t.height)),r.drawImage(o,0,0);try{i=t.toDataURL(e.encoder,e.compression)}catch(t){i=!1}t=r=null,n(i)},o.onerror=function(){n(!1)},o.src=r}function i(e,n){var r,i,s,p,h,c=Graph.dom("<div/>"),l=e.cloneNode(!0);"svg"==l.tagName?(l.setAttribute("width",n.width),l.setAttribute("height",n.height)):(s=Graph.dom("<svg/>"),s.setAttribute("xmlns",Graph.config.xmlns.svg),s.setAttribute("xmlns:xlink",Graph.config.xmlns.xlink),s.setAttribute("version",Graph.config.svg.version),s.setAttribute("width",n.width),s.setAttribute("height",n.height),s.appendChild(l),l=s),c.appendChild(l),r=o(e),i=Graph.dom("<style/>"),i.setAttribute("type","text/css"),i.innerHTML="<![CDATA[\n"+r+"\n]]>";var u=l.childNodes[0];return u?l.insertBefore(i,u):l.appendChild(i),p=a+c.innerHTML,h="data:image/svg+xml;base64,"+window.btoa(t(p)),l=c=null,h}function o(t){for(var e,n,r,i=document.styleSheets,o="",a=0,s=i.length;a<s;a++)if(e=i[a].cssRules,null!=e)for(var p=0,h=e.length;p<h;p++,r=null)n=e[p],void 0!==n.style&&n.selectorText&&(r=t.querySelector(n.selectorText),
r?o+=n.selectorText+" { "+n.style.cssText+" }\n":n.cssText.match(/^@font-face/)&&(o+=n.cssText+"\n"));return o}var a='<?xml version="1.0" standalone="no"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd" [<!ENTITY nbsp "&#160;">]>',s=Graph.data.Exporter=function(t,e){this.options=_.extend({},s.defaults,e||{}),this.element=t.node();var n,r,i;if(t.isPaper())n=t.elem.width(),r=t.elem.height(),i=t.layout().scale();else{var o=t.bbox().toJson();n=o.width,r=o.height,i=t.globalMatrix().scale()}_.assign(this.options,{width:n,height:r,scaleX:i.x,scaleY:i.y})};s.defaults={width:0,height:0,scaleX:1,scaleY:1},s.prototype.exportDataURI=function(){},s.prototype.exportSVG=function(){},s.prototype.exportJPEG=function(t,e){var n=_.extend({},this.options);n.encoder="image/jpeg",n.compression=e||.8,t=_.defaultTo(t,"download.jpg"),r(this.element,n,function(e){e&&document(t,e)})},s.prototype.exportPNG=function(t,n){var i=_.extend({},this.options);t=_.defaultTo(t,"download.png"),
i.encoder="image/png",i.compression=n||.8,r(this.element,i,function(n){n&&e(t,n)})},s.prototype.exportBlob=function(t){var e=_.extend({},this.options);e.encoder="image/jpeg",e.compression=1,e.background="#ffffff",r(this.element,e,function(e){if(e){var r=n(e);t&&t(r)}else t&&t(!1)})}}(),function(){Graph.pallet.Activity=Graph.extend({props:{guid:null,paper:null},components:{pallet:null},cached:{},constructor:function(t){_.assign(this.props,t||{}),this.props.guid="pallet-"+ ++Graph.pallet.Activity.guid,this.initComponent()},guid:function(){return this.props.guid},paper:function(){return Graph.registry.vector.get(this.props.paper)},bindPaper:function(t){this.props.paper=t.guid()},unbindPaper:function(t){this.props.paper=null},initComponent:function(){var t,e;t=_.format('<svg class="graph-pallet" xmlns="{0}" xmlns:xlink="{1}" version="{2}" style="width: 100%; height: 100%"><defs><marker id="marker-arrow-pallet" refX="11" refY="10" viewBox="0 0 20 20" markerWidth="10" markerHeight="10" orient="auto"><path d="M 1 5 L 11 10 L 1 15 Z" fill="#30D0C6" stroke-linecap="round" stroke-dasharray="10000, 1"/></marker></defs><g class="graph-pallet-item" data-shape="activity.start" transform="matrix(1,0,0,1,40,0)"><circle cx="32" cy="32" r="30"/><text x="32" y="36">Start</text></g><g class="graph-pallet-item" data-shape="activity.final" transform="matrix(1,0,0,1,40,80)"><circle cx="32" cy="32" r="30"/><circle cx="32" cy="32" r="24" class="full"/><text x="32" y="36">Stop</text></g><g class="graph-pallet-item" data-shape="activity.action" transform="matrix(1,0,0,1,40,160)"><rect x="2" y="2" width="60" height="60" rx="7" ry="7"/><text x="32" y="34">Action</text></g><g class="graph-pallet-item" data-shape="activity.router" transform="matrix(1,0,0,1,40,250)"><rect x="4" y="4" width="54" height="54" transform="rotate(45,32,32)"/><text x="30" y="34">Route</text></g><g class="graph-pallet-item" data-shape="activity.join" transform="matrix(1,0,0,1,40,340)"><rect x="2" y="28" width="60" height="6" rx="0" ry="0" class="full"/><path d="M 10  0 L 10 28"></path><path d="M 54  0 L 54 28"></path><path d="M 32 34 L 32 60" marker-end="url(#marker-arrow-pallet)"></path><text x="32" y="20">Join</text></g><g class="graph-pallet-item" data-shape="activity.fork" transform="matrix(1,0,0,1,40,420)"><rect x="2" y="28" width="60" height="6" rx="0" ry="0" class="full"/><path d="M 10 34 L 10 60" marker-end="url(#marker-arrow-pallet)"></path><path d="M 54 34 L 54 60" marker-end="url(#marker-arrow-pallet)"></path><path d="M 32  0 L 32 28"></path><text x="32" y="50">Fork</text></g><g class="graph-pallet-item" data-shape="activity.lane" transform="matrix(1,0,0,1,40,500)"><rect x="2" y="2" width="60" height="60" rx="0" ry="0"/><rect x="2" y="2" width="10" height="60" rx="0" ry="0"/><text x="32" y="34">Role</text></g></svg>',Graph.config.xmlns.svg,Graph.config.xmlns.xlink,Graph.config.svg.version),
e=Graph.$(t),e.on("click","[data-shape]",_.bind(this.onShapeClick,this));var n=this,r=interact(".graph-pallet-item",e.node()).draggable({manualStart:!0,onstart:function(t){var e=Graph.$(t.target),r=Graph.util.transform2segments(e.attr("transform"));r=r[0].slice(1),n.cached.matrix=Graph.factory(Graph.lang.Matrix,r),e.addClass("grabbing");var i=n.paper();if(i){var o=i.diagram();console.log(o)}r=e=null},onmove:function(t){n.cached.matrix.translate(t.dx,t.dy),t.target.setAttribute("transform",n.cached.matrix.toValue())},onend:function(t){var r=Graph.$(t.target);r.removeClass("grabbing"),e.node().removeChild(n.cached.clone),n.cached.matrix=null,r=null}}).on("move",function(t){var r=t.interaction;if(r.pointerIsDown&&!r.interacting()){var i={name:"drag"};r.prepared.name=i.name,r.setEventXY(r.startCoords,r.pointers),n.cached.clone=t.currentTarget.cloneNode(!0),e.node().appendChild(n.cached.clone),r.start(i,t.interactable,n.cached.clone)}});r.styleCursor(!1),this.components.pallet=e},render:function(t){
t=Graph.$(t),t.prepend(this.components.pallet),t=null},onShapeClick:function(t){},toString:function(){return"Graph.pallet.Activity"}}),Graph.pallet.Activity.guid=0}(),function(){Graph.diagram.Diagram=Graph.extend({constructor:function(){}})}(),function(){Graph.popup.Dialog=Graph.extend({props:{opened:!1},components:{element:null,backdrop:null},handlers:{backdrop_click:null},constructor:function(t,e){var n=this,r=n.components,i=n.handlers;r.element=Graph.$(t),e.buttons&&_.forEach(e.buttons,function(t,e){var o=Graph.$(t.element,r.element);if(o.length()){var a="button"+e,s=a+"_click";r[a]=o,_.isFunction(t.onclick)&&(i[s]=_.bind(function(e){t.onclick.call(n,e)},n),o.on("click",i[s])),a=s=null}o=null})},element:function(){return this.components.element},open:function(){this.props.opened||(this.element().addClass("open"),this.props.opened=!0,this.center(),this.backdrop())},close:function(){var t=this.components,e=this.handlers,n=t.backdrop;if(this.element().removeClass("open"),this.props.opened=!1,
e.backdrop_click){n.off("click",e.backdrop_click),e.backdrop_click=null;var r=+n.data("user");r--,r<=0&&(r=0,n.detach()),n.data("user",r)}_.forOwn(e,function(n,r){var i=_.split(r,"_"),o=i[0],a=i[1];n&&t[o]&&a&&(t[o].off(a,n),e[r]=null),i=o=a=null}),this.fire("close")},center:_.debounce(function(){var t=this.element(),e=t.width(),n=t.height();t.css({top:"50%",left:"50%","margin-top":-n/2,"margin-left":-e/2})},0),backdrop:function(){var t=this,e=Graph.$(".graph-dialog-backdrop");e.length()||(e=Graph.$('<div class="graph-dialog-backdrop"/>'),e.data("user",0),e.on("click",function(t){t.stopPropagation()})),t.handlers.backdrop_click=function(){t.close()},e.on("click",t.handlers.backdrop_click);var n=+e.data("user");n++,e.data("user",n),t.components.element.before(e),t.components.backdrop=e},toString:function(){return"Graph.popup.Dialog"},destroy:function(){this.components.element=null}}),Graph.popup.Dialog.toString=function(){return"function(element, options)"},Graph.dialog=function(t,e){return new Graph.popup.Dialog(t,e);
}}();
//# sourceMappingURL=graph.min.js.map
